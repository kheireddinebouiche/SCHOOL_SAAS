{% extends 'tenant_folder/base.html' %}
{% load static %}
{% block title %} Liste des Focus Groups {% endblock title %}
{% block content %}
<div class="main-content">
    <div class="page-content">
        <div class="container-fluid">
            <!-- Header -->
            <div class="row">
                <div class="col-12">
                    <div class="page-title-box d-sm-flex align-items-center justify-content-between">
                        <h4 class="mb-sm-0">Gestion des Focus Groups</h4>
                        <div class="page-title-right">
                            <ol class="breadcrumb m-0">
                                <li class="breadcrumb-item"><a href="{% url 't_stage:stage_dashboard' %}">Stages</a></li>
                                <li class="breadcrumb-item active">Focus Groups</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-12">
                    <div class="alert alert-info border-0 rounded-top-0 m-0 d-flex align-items-center mb-4" role="alert">
                        <i class="ri-group-line me-2 fs-18"></i>
                        <div>
                            <strong>Concept des Focus Groups :</strong> Ces groupes permettent de regrouper les étudiants par thématique pour un suivi collectif. Cela facilite les échanges entre pairs et permet aux encadrants de donner des directives générales lors de séances mensuelles.
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-12">
                    <div class="card">
                        <div class="card-header border-0">
                            <div class="d-flex align-items-center">
                                <h5 class="card-title mb-0 flex-grow-1">Focus Groups</h5>
                                <div class="flex-shrink-0">
                                    <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#createFocusGroupModal">
                                        <i class="ri-add-line align-bottom me-1"></i> Créer un Groupe
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                {% for fg in focus_groups %}
                <div class="col-xxl-3 col-sm-6">
                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex mb-4 align-items-center">
                                <div class="flex-shrink-0">
                                    <div class="avatar-sm">
                                        <div class="avatar-title bg-warning-subtle text-warning rounded-3 fs-2">
                                            <i class="ri-group-line"></i>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex-grow-1 ms-3">
                                    <h5 class="card-title mb-1"><a href="{% url 't_stage:focus_group_detail' fg.id %}" class="text-reset">{{ fg.nom }}</a></h5>
                                    <p class="text-muted mb-0">{{ fg.thematique }}</p>
                                </div>
                            </div>
                            
                            <div class="d-flex justify-content-between align-items-center py-2 border-top border-top-dashed">
                                <div>
                                    <p class="mb-0 text-muted"><i class="ri-user-star-line align-middle text-success me-1"></i> {{ fg.encadrant }}</p>
                                </div>
                                <div>
                                    <span class="badge bg-secondary-subtle text-secondary">{{ fg.stages.count }} Stages</span>
                                </div>
                            </div>

                            <div class="mt-3">
                                <a href="{% url 't_stage:focus_group_detail' fg.id %}" class="btn btn-soft-primary w-100">Voir les détails</a>
                            </div>
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="col-12">
                    <div class="text-center py-5">
                        <div class="avatar-lg mx-auto">
                            <div class="avatar-title bg-light text-primary rounded-circle display-4">
                                <i class="ri-group-line"></i>
                            </div>
                        </div>
                        <h4 class="mt-4">Aucun Focus Group trouvé</h4>
                        <p class="text-muted">Créez des groupes pour organiser le suivi collectif des stages.</p>
                        <button type="button" class="btn btn-primary mt-3" data-bs-toggle="modal" data-bs-target="#createFocusGroupModal">
                            <i class="ri-add-line align-bottom me-1"></i> Créer un groupe
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<!-- Modal Creation Focus Group -->
<div class="modal fade" id="createFocusGroupModal" tabindex="-1" aria-labelledby="createFocusGroupModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createFocusGroupModalLabel">Nouveau Focus Group</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form action="{% url 't_stage:create_focus_group' %}" method="POST">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="nom" class="form-label">Nom du Focus Group <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="nom" name="nom" placeholder="Ex: Groupe IA & Finance" required>
                    </div>
                    <div class="mb-3">
                        <label for="thematique" class="form-label">Thématique <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="thematique" name="thematique" placeholder="Ex: Intelligence Artificielle" required>
                    </div>
                    <div class="mb-3">
                        <label for="encadrant" class="form-label">Enseignant Encadrant <span class="text-danger">*</span></label>
                        <select class="form-select" id="encadrant" name="encadrant" required>
                            <option value="">Sélectionner l'encadrant...</option>
                            {% for enc in encadrants %}
                            <option value="{{ enc.id }}">{{ enc }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="hstack gap-2 justify-content-end">
                        <button type="button" class="btn btn-light" data-bs-dismiss="modal">Annuler</button>
                        <button type="submit" class="btn btn-primary">Créer le groupe</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock content %}
