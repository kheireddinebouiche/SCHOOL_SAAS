<div class="modal-header bg-primary text-white">
  <h5 class="modal-title" style="font-size: 1.1rem;">Résultats de délibération - {{ groupe.libelle }}</h5>
  <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
</div>
<div class="modal-body p-0">
  <!-- Table for Normal Exam Session -->
  <div class="table-responsive">
    <h5 class="p-2 bg-light m-0" style="font-size: 0.9rem;">Session d'examen normale</h5>
    <table class="table table-hover table-bordered m-0" style="font-size: 0.8rem;">
      <thead class="table-light">
        <tr>
          <th rowspan="2" class="align-middle" style="vertical-align: middle; height: 40px; font-size: 0.75rem;">Étudiant</th>
          <th rowspan="2" class="align-middle" style="vertical-align: middle; height: 40px; font-size: 0.75rem;">Matricule</th>
          {% for module_data in grouped_modules %}
            {% if module_data.normal_exam %}
            <th colspan="{{ module_data.normal_note_count }}" class="text-center" style="vertical-align: middle; height: 40px; font-size: 0.75rem;">{{ module_data.module.label }}</th>
            {% endif %}
          {% endfor %}
        </tr>
        <tr>
          {% for module_data in grouped_modules %}
            {% if module_data.normal_exam %}
              {% for type_note in module_data.normal_exam.pv.exam_types_notes.all %}
          <th style="vertical-align: middle; height: 30px; font-size: 0.7rem;">{{ type_note.libelle }}</th>
              {% endfor %}
            {% endif %}
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for student_data in results_data %}
        <tr style="height: 35px;">
          <td style="vertical-align: middle; font-size: 0.75rem;">{{ student_data.student.nom }} {{ student_data.student.prenom }}</td>
          <td style="vertical-align: middle; font-size: 0.75rem;">{{ student_data.student.matricule }}</td>
          {% for result in student_data.results %}
            {% if result.normal_result %}
              {% for structured_note in result.normal_result.structured_notes %}
          <td class="text-center" style="vertical-align: middle; font-size: 0.75rem; font-weight: bold;">{% if structured_note.valeur != None %}{{ structured_note.valeur }}{% else %}-{% endif %}</td>
              {% endfor %}
            {% endif %}
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Table for Rachat de Crédit -->
  {% if has_rachat %}
  <div class="table-responsive mt-4">
    <h5 class="p-2 bg-light m-0" style="font-size: 0.9rem;">Rachat de crédit</h5>
    <table class="table table-hover table-bordered m-0" style="font-size: 0.8rem;">
      <thead class="table-light">
        <tr>
          <th rowspan="2" class="align-middle" style="vertical-align: middle; height: 40px; font-size: 0.75rem;">Étudiant</th>
          <th rowspan="2" class="align-middle" style="vertical-align: middle; height: 40px; font-size: 0.75rem;">Matricule</th>
          {% for module_data in grouped_modules %}
            {% if module_data.rachat_exam %}
            <th colspan="{{ module_data.rachat_note_count }}" class="text-center" style="vertical-align: middle; height: 40px; font-size: 0.75rem;">{{ module_data.module.label }}</th>
            {% endif %}
          {% endfor %}
        </tr>
        <tr>
          {% for module_data in grouped_modules %}
            {% if module_data.rachat_exam %}
              {% for type_note in module_data.rachat_exam.pv.exam_types_notes.all %}
          <th style="vertical-align: middle; height: 30px; font-size: 0.7rem;">{{ type_note.libelle }}</th>
              {% endfor %}
            {% endif %}
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for student_data in results_data %}
        <tr style="height: 35px;">
          <td style="vertical-align: middle; font-size: 0.75rem;">{{ student_data.student.nom }} {{ student_data.student.prenom }}</td>
          <td style="vertical-align: middle; font-size: 0.75rem;">{{ student_data.student.matricule }}</td>
          {% for result in student_data.results %}
            {% if result.rachat_result %}
              {% for structured_note in result.rachat_result.structured_notes %}
          <td class="text-center" style="vertical-align: middle; font-size: 0.75rem; font-weight: bold;">{% if structured_note.valeur != None %}{{ structured_note.valeur }}{% else %}-{% endif %}</td>
              {% endfor %}
            {% endif %}
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% endif %}

  <!-- Table for Rattrapage -->
  {% if has_rattrapage %}
  <div class="table-responsive mt-4">
    <h5 class="p-2 bg-light m-0" style="font-size: 0.9rem;">Rattrapage</h5>
    <table class="table table-hover table-bordered m-0" style="font-size: 0.8rem;">
      <thead class="table-light">
        <tr>
          <th rowspan="2" class="align-middle" style="vertical-align: middle; height: 40px; font-size: 0.75rem;">Étudiant</th>
          <th rowspan="2" class="align-middle" style="vertical-align: middle; height: 40px; font-size: 0.75rem;">Matricule</th>
          {% for module_data in grouped_modules %}
            {% if module_data.rattrapage_exam %}
            <th colspan="{{ module_data.rattrapage_note_count }}" class="text-center" style="vertical-align: middle; height: 40px; font-size: 0.75rem;">{{ module_data.module.label }}</th>
            {% endif %}
          {% endfor %}
        </tr>
        <tr>
          {% for module_data in grouped_modules %}
            {% if module_data.rattrapage_exam %}
              {% for type_note in module_data.rattrapage_exam.pv.exam_types_notes.all %}
          <th style="vertical-align: middle; height: 30px; font-size: 0.7rem;">{{ type_note.libelle }}</th>
              {% endfor %}
            {% endif %}
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for student_data in results_data %}
        <tr style="height: 35px;">
          <td style="vertical-align: middle; font-size: 0.75rem;">{{ student_data.student.nom }} {{ student_data.student.prenom }}</td>
          <td style="vertical-align: middle; font-size: 0.75rem;">{{ student_data.student.matricule }}</td>
          {% for result in student_data.results %}
            {% if result.rattrapage_result %}
              {% for structured_note in result.rattrapage_result.structured_notes %}
          <td class="text-center" style="vertical-align: middle; font-size: 0.75rem; font-weight: bold;">{% if structured_note.valeur != None %}{{ structured_note.valeur }}{% else %}-{% endif %}</td>
              {% endfor %}
            {% endif %}
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% endif %}
</div>
<div class="modal-footer">
  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
  <button type="button" class="btn btn-primary">Imprimer</button>
</div>