<div class="modal-header bg-primary text-white">
  <h5 class="modal-title">Résultats de délibération - {{ groupe.libelle }}</h5>
  <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
</div>
<div class="modal-body p-0">
  <!-- Table for Normal Exam Session -->
  <div class="table-responsive">
    <h5 class="p-3 bg-light m-0">Session d'examen normale</h5>
    <table class="table table-hover table-bordered m-0" style="font-size: 0.9rem;">
      <thead class="table-light">
        <tr>
          <th rowspan="2" class="align-middle" style="vertical-align: middle; height: 60px;">Étudiant</th>
          <th rowspan="2" class="align-middle" style="vertical-align: middle; height: 60px;">Matricule</th>
          {% for module_data in grouped_modules %}
            {% if module_data.normal_exam %}
            <th colspan="{{ module_data.normal_note_count }}" class="text-center" style="vertical-align: middle; height: 60px;">{{ module_data.module.label }}</th>
            {% endif %}
          {% endfor %}
        </tr>
        <tr>
          {% for module_data in grouped_modules %}
            {% if module_data.normal_exam %}
              {% for type_note in module_data.normal_exam.pv.exam_types_notes.all %}
          <th style="vertical-align: middle; height: 40px;">{{ type_note.libelle }}</th>
              {% endfor %}
            {% endif %}
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for student_data in results_data %}
        <tr style="height: 50px;">
          <td style="vertical-align: middle;">{{ student_data.student.nom }} {{ student_data.student.prenom }}</td>
          <td style="vertical-align: middle;">{{ student_data.student.matricule }}</td>
          {% for result in student_data.results %}
            {% if result.normal_result %}
              {% for structured_note in result.normal_result.structured_notes %}
          <td style="vertical-align: middle;">{{ structured_note.valeur }}</td>
              {% endfor %}
            {% endif %}
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Table for Rachat de Crédit -->
  {% if has_rachat %}
  <div class="table-responsive mt-4">
    <h5 class="p-3 bg-light m-0">Rachat de crédit</h5>
    <table class="table table-hover table-bordered m-0" style="font-size: 0.9rem;">
      <thead class="table-light">
        <tr>
          <th rowspan="2" class="align-middle" style="vertical-align: middle; height: 60px;">Étudiant</th>
          <th rowspan="2" class="align-middle" style="vertical-align: middle; height: 60px;">Matricule</th>
          {% for module_data in grouped_modules %}
            {% if module_data.rattrapage_exam %}
            <th colspan="{{ module_data.rattrapage_note_count }}" class="text-center" style="vertical-align: middle; height: 60px;">{{ module_data.module.label }}</th>
            {% endif %}
          {% endfor %}
        </tr>
        <tr>
          {% for module_data in grouped_modules %}
            {% if module_data.rattrapage_exam %}
              {% for type_note in module_data.rattrapage_exam.pv.exam_types_notes.all %}
          <th style="vertical-align: middle; height: 40px;">{{ type_note.libelle }}</th>
              {% endfor %}
            {% endif %}
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for student_data in results_data %}
        <tr style="height: 50px;">
          <td style="vertical-align: middle;">{{ student_data.student.nom }} {{ student_data.student.prenom }}</td>
          <td style="vertical-align: middle;">{{ student_data.student.matricule }}</td>
          {% for result in student_data.results %}
            {% if result.rattrapage_result %}
              {% for structured_note in result.rattrapage_result.structured_notes %}
          <td style="vertical-align: middle;">{{ structured_note.valeur }}</td>
              {% endfor %}
            {% endif %}
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% endif %}
</div>
<div class="modal-footer">
  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
  <button type="button" class="btn btn-primary">Imprimer</button>
</div>