{% extends 'tenant_folder/base.html' %}
{% load static %}
{% block title %} Formations - Liste des spécialitées {% endblock title %}

{% block content %}
        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">

            <div class="page-content">
                <div class="container-fluid">

                    <!-- start page title -->
                    <div class="row">
                        <div class="col-12">
                            <div class="page-title-box d-sm-flex align-items-center justify-content-between">
                                <h4 class="mb-sm-0">Détails de la spécialitée</h4>

                                <div class="page-title-right">
                                    <ol class="breadcrumb m-0">
                                        <li class="breadcrumb-item"><a href="javascript: void(0);">Formations</a></li>
                                        <li class="breadcrumb-item active">Détails de la spécialitée</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- end page title -->
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="card">
                                <div class="card-header">
                                    <input type="hidden" id="_specialite" value="{{object.id}}" disabled />
                                    <h5 class="card-title mb-0">{{object.label}}</i></h5>
                                </div>
                                <div class="card-body">
                                  
                                </div>
                                <div class="card-footer">
                                    <div class="row">
                                        <div class="col-lg-6">
                                            <div class="text-lg-start">
                                                <a href="#" class="btn btn-primary waves-effect waves-light me-1"><i class="mdi mdi-pencil me-1"></i> Modifier</a>
                                                <a href="#" class="btn btn-danger waves-effect waves-light"><i class="mdi mdi-trash-can me-1"></i> Supprimer</a>
                                            </div>
                                        </div>
                                        <div class="col-lg-6">
                                            <div class="text-lg-end mt-3 mt-lg-0">
                                                <button id="_addModuleBtn" class="btn btn-success waves-effect waves-light me-1"><i class="mdi mdi-plus me-1"></i> Ajouter un module</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title">Liste des modules</h5>

                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-centered table-nowrap table-hover mb-0">
                                            <thead>
                                                <tr>
                                                    <th scope="col">Label</th>
                                                    <th scope="col">Description</th>
                                                    <th scope="col">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="table-modules">
                                               
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                            
                </div>
                <!-- container-fluid -->
            </div>
            <!-- End Page-content -->
        </div>


<div id="addModule" class="modal fade" tabindex="-1" aria-labelledby="addModuleLabel" aria-hidden="true" style="display: none;">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addModuleLabel">Ajout d'un nouveau module</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
               <div class="row">
                    <div class="col-lg-4">
                        <label for="_label">Nom du module :</label>
                        <input type="text" class="form-control" id="_label" />
                    </div>
                    <div class="col-lg-4">
                        <label for="_coef">Coéfficiant du module :</label>
                        <input type="text" class="form-control" id="_coef" />
                    </div>
                    <div class="col-lg-4">
                        <label for="_duree">Volume Horraire :</label>
                        <input type="number" class="form-control" id="_duree" />
                    </div>
               </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="addBtn">Ajouter</button>
            </div>

        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<script>

    $(document).ready(function(){
        var id = document.getElementById('_specialite').value;
        

        loadModule();

        function loadModule(){

            $.ajax({
                url : "{% url 't_formations:ApiGeSpecialitetModules' %}",
                type : "GET",
                data : {
                    'id' : id,
                },
                dataType: 'JSON',
                success : function(data){
                    var row = "";
                    if(data.length > 0){
                        $.each(data, function(index, p){
                            row += "<tr>";
                            row += "<td>"+p.label+"</td>";
                            row += "<td>"+p.code+"</td>";
                            row += "</tr>";

                        });
                        
                    }else{
                            row = "<tr><td class='text-muted text-center' colspan='3'>Aucune donnée trouvé</td></tr>";
                    }

                    $('#table-modules').html(row);
                   
                }
            });
        }

        $(document).on('click', '#_addModuleBtn', function(){
            $('#addModule').modal("show");
        });

        $(document).on('click', '#addBtn', function(){
            var label = document.getElementById('_label').value;
            var coef = document.getElementById('_coef').value;
            var duree = document.getElementById('_duree').value;

            $.ajax({
                url : "{% url 't_formations:ApiAddModule' %}",
                type : "POST",
                dataType : "JSON",
                data : {'id',id,'label' : label, 'coef' : coef, 'duree', duree,'csrfmiddlewaretoken': '{{ csrf_token }}',},

                success : function(response){
                    if(response.success){
                        alertify.success("Le module à été ajouter avec succès")
                        loadModule();
                    }
                }
            });


        });

    });

</script>

{% endblock content %}
           



    