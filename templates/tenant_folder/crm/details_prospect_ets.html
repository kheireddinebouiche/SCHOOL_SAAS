{% extends "tenant_folder/base.html" %}

{% load static %}

{% block title %}Détails du prospect - entreprise {% endblock title %}

{% block content %}

<div class="main-content">
    <div class="page-content">
        <div class="container-fluid">                                                    

            <!-- start page title -->
            <div class="row mb-3">
                <div class="col-12">
                    <div class="d-sm-flex align-items-center justify-content-between bg-white rounded-lg shadow-sm p-3">
                        <div class="d-flex align-items-center">
                            <div class="bg-primary bg-opacity-10 rounded-circle p-2 me-2">
                                <i class="ri-user-line text-primary"></i>
                            </div>
                            <h4 class="mb-0 text-primary">Détails du prospect</h4>
                        </div>
                        <div class="d-flex align-items-center gap-3">
                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb m-0 bg-transparent">
                                    <li class="breadcrumb-item">
                                        <a href="javascript: void(0);">CRM</a>
                                    </li>
                                    <li class="breadcrumb-item active">Détails du prospect</li>
                                </ol>
                            </nav>
                            <div class="btn-group">
                                <button type="button" class="btn btn-success px-4 py-2" data-bs-toggle="modal" id="validateProspectBtn">
                                    <i class="ri-check-line me-2"></i>Valider le prospect
                                </button>
                                
                                <a href="/crm/liste-des-prospects/" class="btn btn-light px-4 py-2">
                                    <i class="ri-arrow-left-line me-2"></i>Retour à la liste
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- end page title -->
            <!-- Première rangée : Informations personnelles et Fiche de Voeux -->
            <div class="row mb-4">
                <!-- Informations personnelles -->
                <div class="col-lg-4">
                    <div class="card border-0 shadow-sm rounded-4 h-100">
                        <div class="card-header border-0 bg-primary bg-opacity-10 px-4 py-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="d-flex align-items-center">
                                    <div class="modal-icon bg-primary bg-opacity-10 rounded-3 p-3 me-3">
                                        <i class="ri-user-line text-primary"></i>
                                    </div>
                                    <div>
                                        <h5 class="card-title fw-semibold text-primary mb-1">Informations du contact</h5>
                                        <p class="text-muted small mb-0">Détails du contact</p>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-primary px-3 py-2" id="udapteProspectDetailsBtn">
                                    <i class="ri-edit-line"></i>
                                </button>
                            </div>
                        </div>
                        <div class="card-body p-4">
                            <div class="mb-4 d-flex align-items-start">
                                <div class="icon-circle bg-primary bg-opacity-10 rounded-circle p-2 me-3">
                                    <i class="ri-user-line text-primary"></i>
                                </div>
                                <div>
                                    <small class="text-muted d-block mb-1">Nom et Prénom</small>
                                    <span class="fw-semibold" id="nom_prenom"></span>
                                </div>
                            </div>
                            <div class="mb-4 d-flex align-items-start">
                                <div class="icon-circle bg-secondary bg-opacity-10 rounded-circle p-2 me-3">
                                    <i class="ri-flag-line text-secondary"></i>
                                </div>
                                <div>
                                    <small class="text-muted d-block mb-1">Statut</small>
                                    <span class="fw-semibold" id="statut_prospect"></span>
                                </div>
                            </div>
                            <div class="mb-4 d-flex align-items-start">
                                <div class="icon-circle bg-info bg-opacity-10 rounded-circle p-2 me-3">
                                    <i class="ri-mail-line text-info"></i>
                                </div>
                                <div>
                                    <small class="text-muted d-block mb-1">Email</small>
                                    <span class="fw-semibold" id="email"></span>
                                </div>
                            </div>
                            <div class="mb-4 d-flex align-items-start">
                                <div class="icon-circle bg-success bg-opacity-10 rounded-circle p-2 me-3">
                                    <i class="ri-phone-line text-success"></i>
                                </div>
                                <div>
                                    <small class="text-muted d-block mb-1">Téléphone</small>
                                    <span class="fw-semibold" id="phone"></span>
                                </div>
                            </div>
                            <div class="d-flex align-items-start">
                                <div class="icon-circle bg-warning bg-opacity-10 rounded-circle p-2 me-3">
                                    <i class="ri-calendar-line text-warning"></i>
                                </div>
                                <div>
                                    <small class="text-muted d-block mb-1">Créé le</small>
                                    <span class="fw-semibold" id="created_at"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section Informations Entreprise -->
                <div class="col-lg-8">
                    <div class="card border-0 shadow-sm rounded-4 h-100">
                        <div class="card-header border-0 bg-info bg-opacity-10 px-4 py-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="d-flex align-items-center">
                                    <div class="modal-icon bg-info bg-opacity-10 rounded-3 p-3 me-3">
                                        <i class="ri-building-line text-info fs-4"></i>
                                    </div>
                                    <div>
                                        <h5 class="card-title fw-semibold text-info mb-1">Informations Entreprise</h5>
                                        <p class="text-muted small mb-0">Détails de l'entreprise du prospect</p>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-info px-4 py-2" data-bs-toggle="modal" id="updateEtsDetails">
                                    <i class="ri-edit-line me-2"></i>Modifier les informations
                                </button>
                            </div>
                        </div>
                        <div class="card-body p-4">
                            <div class="row w-100" id="prospectEntrepriseDetails">
                                <div class="col-12 mb-4">
                                    <div class="d-flex flex-column align-items-center justify-content-center bg-light rounded-3 p-4 mb-3">
                                        <div class="icon-circle bg-info bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                                            <i class="ri-building-line text-info fs-2"></i>
                                        </div>
                                        <div class="text-center">
                                            <small class="text-muted d-block mb-1">Nom de l'entreprise</small>
                                            <h5 class="fw-semibold mb-0" id="entreprise_nom">-</h5>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="d-flex flex-column bg-light rounded-3 p-3">
                                        <div class="d-flex align-items-center mb-2">
                                            <div class="icon-circle bg-warning bg-opacity-10 rounded-circle p-2 me-3">
                                                <i class="ri-file-text-line text-warning fs-5"></i>
                                            </div>
                                            <div class="flex-grow-1">
                                                <small class="text-muted d-block mb-1">Observations</small>
                                            </div>
                                        </div>
                                        <div class="mt-2">
                                            <p class="fw-normal mb-0 text-muted" id="entreprise_observation" style="white-space: pre-line;">-</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Fin section informations entreprise -->
             
            </div>

            <!-- Deuxième rangée : Rappels -->
            <div class="row">
                <!-- Colonne Prise de rendez vous -->
                <div class="col-12">
                    <div class="card border-0 shadow-sm rounded-4 w-100">
                        <div class="card-header border-0 bg-success bg-opacity-10 px-4 py-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="d-flex align-items-center">
                                    <div class="modal-icon bg-success bg-opacity-10 rounded-3 p-3 me-3">
                                        <i class="ri-calendar-check-line text-success fs-4"></i>
                                    </div>
                                    <div>
                                        <h5 class="card-title fw-semibold text-success mb-1">Rappels & Rendez-vous</h5>
                                        <p class="text-muted small mb-0">Gestion des tâches et rendez-vous</p>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-success px-4 py-2" id="addReminderBtn">
                                    <i class="ri-add-line me-2"></i>Nouveau rappel
                                </button>
                            </div>
                        </div>
                        <div class="card-body p-4">
                            <div class="table-responsive">
                                <table class="table table-hover align-middle">
                                    <thead class="bg-light">
                                        <tr>
                                            <th class="border-0 rounded-start">Type</th>
                                            <th class="border-0">Date & Heure</th>
                                            <th class="border-0">Objet</th>
                                            <th class="border-0">Statut</th>
                                            <th class="border-0 rounded-end text-end">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="listeDesRendezVous">
                                        <!-- Liste des rendez vous -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                    </div>
                </div>
                <!-- Fin Colonne de prise de rendez vous-->
            </div>
            <!--Fin Row notes-->


            <!-- Section Notes -->
            <div class="row">
                <div class="col-lg-12">
                    <div class="card border-0 shadow-sm rounded-4">
                        <!-- Header -->
                        <div class="card-header border-0 bg-warning bg-opacity-10 px-4 py-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="d-flex align-items-center">
                                    <div class="modal-icon bg-warning bg-opacity-10 rounded-3 p-3 me-3">
                                        <i class="ri-sticky-note-line text-warning fs-4"></i>
                                    </div>
                                    <div>
                                        <h5 class="card-title fw-semibold text-warning mb-1">Notes</h5>
                                        <p class="text-muted small mb-0">Commentaires et observations</p>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-warning px-4 py-2" id="addNoteModalBtn">
                                    <i class="ri-add-line me-2"></i>Nouvelle note
                                </button>
                            </div>
                        </div>

                        <!-- Body -->
                        <div class="card-body p-4">
                            <!-- Liste des notes -->
                            <div class="vstack gap-4" id="ListeDesNotes">
                               

                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Fin Section Notes-->

            <!-- Modal Nouveau Rappel -->
            <div class="modal fade" id="addReminderModal" tabindex="-1" aria-labelledby="addReminderModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content rounded-4 shadow-lg border-0">
                        <div class="modal-header border-0 bg-success bg-opacity-10 px-4 py-3">
                            <div class="d-flex align-items-center">
                                <div class="modal-icon bg-success bg-opacity-10 rounded-3 p-3 me-3">
                                    <i class="ri-calendar-check-line text-success fs-4"></i>
                                </div>
                                <div>
                                    <h5 class="modal-title fw-semibold text-success mb-1" id="addReminderModalLabel">
                                        Nouveau rappel
                                    </h5>
                                    <p class="text-muted small mb-0">Créer un nouveau rappel ou rendez-vous</p>
                                </div>
                            </div>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body p-4">
                            <div class="row g-3">
                                <div class="col-12">
                                    <label class="form-label fw-medium">Type de rappel</label>
                                    <select id="reminderType" class="form-select border-0 bg-light py-2">
                                        <option value="appel">Appel</option>
                                        <option value="rendez_vous">Rendez-vous</option>
                                        <option value="email">Email</option>
                                        <option value="autre">Autre</option>
                                    </select>
                                </div>
                                <div class="col-12">
                                    <label class="form-label fw-medium">Objet</label>
                                    <input id="reminderSubject" type="text" class="form-control border-0 bg-light py-2" placeholder="Entrez l'objet du rappel">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-medium">Date</label>
                                    <input id="reminderDate" type="date" class="form-control border-0 bg-light py-2">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-medium">Heure</label>
                                    <input id="reminderTime" type="time" class="form-control border-0 bg-light py-2">
                                </div>
                                <div class="col-12">
                                    <label class="form-label fw-medium">Description</label>
                                    <textarea id="reminderDescription" class="form-control border-0 bg-light" rows="3" placeholder="Entrez une description..."></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer border-0 bg-light px-4 py-3">
                            <button type="button" class="btn btn-light px-4 py-2" data-bs-dismiss="modal">
                                <i class="ri-close-line me-2"></i>Annuler
                            </button>
                            <button type="button" class="btn btn-success px-4 py-2" id="saveReminderBtn">
                                <i class="ri-save-line me-2"></i>Enregistrer
                            </button>
                        </div>
                    </div>
                </div>
            </div>
   
            <!-- Modal de validation du prospect -->
            <div class="modal fade" id="validateProspectModal" tabindex="-1" aria-labelledby="validateProspectModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content rounded-4 shadow-lg border-0">
                        <div class="modal-header border-0 bg-success bg-opacity-10 px-4 py-3">
                            <div class="d-flex align-items-center">
                                <div class="modal-icon bg-success bg-opacity-10 rounded-3 p-3 me-3">
                                    <i class="ri-check-double-line text-success fs-4"></i>
                                </div>
                                <div>
                                    <h5 class="modal-title fw-semibold text-success mb-1" id="validateProspectModalLabel">
                                        Validation du prospect
                                    </h5>
                                    <p class="text-muted small mb-0">Confirmation de la validation du prospect</p>
                                </div>
                            </div>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body p-4">
                            <div class="text-center mb-4">
                                <div class="avatar-lg mx-auto mb-3">
                                    <div class="avatar-title bg-success bg-opacity-10 text-success display-5 rounded-circle">
                                        <i class="ri-user-follow-line"></i>
                                    </div>
                                </div>
                                <h5 class="mb-3">Êtes-vous sûr de vouloir valider ce prospect ?</h5>
                                <p class="text-muted mb-0">
                                    La validation du prospect permettra de le convertir en client et de commencer le processus d'inscription.
                                </p>
                            </div>
                            <div class="row g-3">
                                <div class="col-12">
                                    <label class="form-label fw-medium">Commentaire de validation (optionnel)</label>
                                    <textarea class="form-control border-0 bg-light" rows="3" placeholder="Ajoutez un commentaire..."></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer border-0 bg-light px-4 py-3">
                            <button type="button" class="btn btn-light px-4 py-2" data-bs-dismiss="modal">
                                <i class="ri-close-line me-2"></i>Annuler
                            </button>
                            <button type="button" id="confirmeValidationBtn" class="btn btn-success px-4 py-2">
                                <i class="ri-check-line me-2"></i>Valider le prospect
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal de modification du prospect -->
            <div class="modal fade" id="editProspectModal" tabindex="-1" aria-labelledby="editProspectModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-lg">
                    <div class="modal-content rounded-4 shadow-lg border-0">
                        <div class="modal-header border-0 bg-primary bg-opacity-10 px-4 py-3">
                            <div class="d-flex align-items-center">
                                <div class="modal-icon bg-primary bg-opacity-10 rounded-3 p-3 me-3">
                                    <i class="ri-edit-line text-primary fs-4"></i>
                                </div>
                                <div>
                                    <h5 class="modal-title fw-semibold text-primary mb-1" id="editProspectModalLabel">
                                        Modifier les informations
                                    </h5>
                                    <p class="text-muted small mb-0">Modification des informations du contact</p>
                                </div>
                            </div>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body p-4">
                            <div class="text-center mb-4">
                                <div class="avatar-lg mx-auto mb-3">
                                    <div class="avatar-title bg-primary bg-opacity-10 text-primary display-5 rounded-circle">
                                        <i class="ri-user-settings-line"></i>
                                    </div>
                                </div>
                                <h4 class="text-primary mb-3">Modification du prospect</h4>
                                <p class="text-muted mb-4">
                                    Veuillez remplir les informations ci-dessous pour mettre à jour les détails du prospect.
                                </p>
                            </div>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label fw-medium">Nom</label>
                                        <div class="input-group">
                                            <span class="input-group-text border-0 bg-light">
                                                <i class="ri-user-line text-muted"></i>
                                            </span>
                                            <input type="text" class="form-control border-0 bg-light py-2" id="nomInputUpdate">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label fw-medium">Prénom</label>
                                        <div class="input-group">
                                            <span class="input-group-text border-0 bg-light">
                                                <i class="ri-user-line text-muted"></i>
                                            </span>
                                            <input type="text" class="form-control border-0 bg-light py-2" id="prenomInputUpdate">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label fw-medium">Email</label>
                                        <div class="input-group">
                                            <span class="input-group-text border-0 bg-light">
                                                <i class="ri-mail-line text-muted"></i>
                                            </span>
                                            <input type="email" class="form-control border-0 bg-light py-2" id="emailInputUpdate">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label fw-medium">Téléphone</label>
                                        <div class="input-group">
                                            <span class="input-group-text border-0 bg-light">
                                                <i class="ri-phone-line text-muted"></i>
                                            </span>
                                            <input type="tel" class="form-control border-0 bg-light py-2" id="telephoneInputUpdate">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer border-0 bg-light px-4 py-3">
                            <div class="hstack gap-2 justify-content-center w-100">
                                <button type="button" class="btn btn-light px-4 py-2 w-100" data-bs-dismiss="modal">
                                    <i class="ri-close-line me-2"></i>Annuler
                                </button>
                                <button type="button" id="validateUpdateProspectDetailsBtn" class="btn btn-primary px-4 py-2 w-100">
                                    <i class="ri-save-line me-2"></i>Enregistrer
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Nouvelle Note -->
            <div class="modal fade" id="addNoteModal" tabindex="-1" aria-labelledby="addNoteModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content rounded-4 shadow-lg border-0">
                        <div class="modal-header border-0 bg-warning bg-opacity-10 px-4 py-3">
                            <div class="d-flex align-items-center">
                                <div class="modal-icon bg-warning bg-opacity-10 rounded-3 p-3 me-3">
                                    <i class="ri-sticky-note-line text-warning fs-4"></i>
                                </div>
                                <div>
                                    <h5 class="modal-title fw-semibold text-warning mb-1" id="addNoteModalLabel">
                                        Nouvelle note
                                    </h5>
                                    <p class="text-muted small mb-0">Ajouter une nouvelle note ou observation</p>
                                </div>
                            </div>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body p-4">
                            <div class="row g-3">
                                <div class="col-12">
                                    <textarea id="content_note" class="form-control border-0 bg-light" rows="4" placeholder="Saisissez votre note ici..."></textarea>
                                </div>
                                <div class="col-12">
                                    <label class="form-label fw-medium">Étiquettes</label>
                                    <select id="note_tags" class="form-select border-0 bg-light py-2">
                                        <option value="important">Important</option>
                                        <option value="a_revoir">A revoir</option>
                                        <option value="a_contacte">A contacter</option>
                                        <option value="a_relancer">A relancer</option>

                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer border-0 bg-light px-4 py-3">
                            <button type="button" class="btn btn-light px-4 py-2" data-bs-dismiss="modal">
                                <i class="ri-close-line me-2"></i>Annuler
                            </button>
                            <button type="button" class="btn btn-warning px-4 py-2" id="saveNoteBtn">
                                <i class="ri-save-line me-2"></i>Enregistrer
                            </button>
                        </div>
                    </div>
                </div>
            </div>

             <!-- Modal Modification d'une note -->
            <div class="modal fade" id="editNoteModal" tabindex="-1" aria-labelledby="editNoteModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content rounded-4 shadow-lg border-0">
                        <div class="modal-header border-0 bg-warning bg-opacity-10 px-4 py-3">
                            <div class="d-flex align-items-center">
                                <div class="modal-icon bg-warning bg-opacity-10 rounded-3 p-3 me-3">
                                    <i class="ri-edit-line text-warning fs-4"></i>
                                </div>
                                <div>
                                    <h5 class="modal-title fw-semibold text-warning mb-1" id="editNoteModalLabel">
                                        Modifier le profil
                                    </h5>
                                    <p class="text-muted small mb-0">Modification des informations de Jean Martin</p>
                                </div>
                            </div>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body p-4">
                            <div class="row g-3">
                                <div class="col-12">
                                    <label class="form-label fw-medium">Nom et Prénom</label>
                                    <input type="text" class="form-control border-0 bg-light" value="Jean Martin">
                                </div>
                                <div class="col-12">
                                    <label class="form-label fw-medium">Date</label>
                                    <input type="date" class="form-control border-0 bg-light" value="2024-01-20">
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer border-0 bg-light px-4 py-3">
                            <button type="button" class="btn btn-light px-4 py-2" data-bs-dismiss="modal">
                                <i class="ri-close-line me-2"></i>Annuler
                            </button>
                            <button type="button" class="btn btn-warning px-4 py-2">
                                <i class="ri-save-line me-2"></i>Enregistrer
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Suppression d'une note -->
            <div class="modal fade" id="deleteNoteModal" tabindex="-1" aria-labelledby="deleteNoteModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content rounded-4 shadow-lg border-0">
                        <div class="modal-header border-0 bg-danger bg-opacity-10 px-4 py-3">
                            <div class="d-flex align-items-center">
                                <div class="modal-icon bg-danger bg-opacity-10 rounded-3 p-3 me-3">
                                    <i class="ri-delete-bin-line text-danger fs-4"></i>
                                </div>
                                <div>
                                    <h5 class="modal-title fw-semibold text-danger mb-1" id="deleteNoteModal">
                                        Supprimer le profil
                                    </h5>
                                    <p class="text-muted small mb-0">Suppression du profil de Jean Martin</p>
                                </div>
                            </div>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body p-4">
                            <div class="text-center">
                                <div class="avatar-lg mx-auto mb-4">
                                    <div class="avatar-title bg-danger bg-opacity-10 text-danger display-5 rounded-circle">
                                        <i class="ri-error-warning-line"></i>
                                    </div>
                                </div>
                                <h5 class="mb-3">Êtes-vous sûr de vouloir supprimer ce profil ?</h5>
                                <p class="text-muted">
                                    La suppression du profil de Jean Martin est définitive et ne pourra pas être annulée.
                                </p>
                            </div>
                        </div>
                        <div class="modal-footer border-0 bg-light px-4 py-3">
                            <button type="button" class="btn btn-light px-4 py-2" data-bs-dismiss="modal">
                                <i class="ri-close-line me-2"></i>Annuler
                            </button>
                            <button type="button" id='ConfirmDeleteNoteBtn' class="btn btn-danger px-4 py-2">
                                <i class="ri-delete-bin-line me-2"></i>Supprimer
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Modification d'un rappel -->
            <div class="modal fade" id="editReminderModal" tabindex="-1" aria-labelledby="editReminderModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content rounded-4 shadow-lg border-0">
                        <div class="modal-header border-0 bg-primary bg-opacity-10 px-4 py-3">
                            <div class="d-flex align-items-center">
                                <div class="modal-icon bg-primary bg-opacity-10 rounded-3 p-3 me-3">
                                    <i class="ri-calendar-check-line text-primary fs-4"></i>
                                </div>
                                <div>
                                    <h5 class="modal-title fw-semibold text-primary mb-1" id="editReminderModalLabel">
                                        Modifier le rappel
                                    </h5>
                                    <p class="text-muted small mb-0">Modification des informations du rappel</p>
                                </div>
                            </div>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body p-4">
                            <div class="row g-3">
                                <div class="col-12">
                                    <label class="form-label fw-medium">Type de rappel</label>
                                    <select id="editTypeReminder" class="form-select border-0 bg-light py-2">
                                        <option value="appel">Appel</option>
                                        <option value="rendez_vous">Rendez-vous</option>
                                        <option value="email">Email</option>
                                        <option value="autre">Autre</option>
                                    </select>
                                </div>
                                <div class="col-12">
                                    <label class="form-label fw-medium">Objet</label>
                                    <input type="text" id="editObjectReminder" class="form-control border-0 bg-light py-2" placeholder="Entrez l'objet du rappel">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-medium">Date</label>
                                    <input id="editDateReminder" type="date" class="form-control border-0 bg-light py-2">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-medium">Heure</label>
                                    <input id="editTimeReminer" type="time" class="form-control border-0 bg-light py-2">
                                </div>
                                <div class="col-12">
                                    <label class="form-label fw-medium">Description</label>
                                    <textarea id="editDescriptionRemider" class="form-control border-0 bg-light" rows="3" placeholder="Entrez une description..."></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer border-0 bg-light px-4 py-3">
                            <button type="button" class="btn btn-light px-4 py-2" data-bs-dismiss="modal">
                                <i class="ri-close-line me-2"></i>Annuler
                            </button>
                            <button type="button" id="editReminderBtnSave" class="btn btn-primary px-4 py-2">
                                <i class="ri-save-line me-2"></i>Enregistrer
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Détails d'un rappel -->
            <div class="modal fade" id="detailsReminderModal" tabindex="-1" aria-labelledby="detailsReminderModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content rounded-4 shadow-lg border-0">
                        <div class="modal-header border-0 bg-info bg-opacity-10 px-4 py-3">
                            <div class="d-flex align-items-center">
                                <div class="modal-icon bg-info bg-opacity-10 rounded-3 p-3 me-3">
                                    <i class="ri-calendar-check-line text-info fs-4"></i>
                                </div>
                                <div>
                                    <h5 class="modal-title fw-semibold text-info mb-1" id="detailsReminderModalLabel">
                                        Détails du rappel
                                    </h5>
                                    <p class="text-muted small mb-0">Informations détaillées sur le rappel</p>
                                </div>
                            </div>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body p-4">
                            <div class="row g-3">
                                <div class="col-12">
                                    <div class="d-flex align-items-center mb-3">
                                        <div class="icon-circle bg-primary bg-opacity-10 rounded-circle p-2 me-3">
                                            <i class="ri-phone-line text-primary"></i>
                                        </div>
                                        <div>
                                            <small class="text-muted d-block mb-1">Type</small>
                                            <span class="fw-semibold" id="reminder-type"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="d-flex align-items-center mb-3">
                                        <div class="icon-circle bg-info bg-opacity-10 rounded-circle p-2 me-3">
                                            <i class="ri-time-line text-info"></i>
                                        </div>
                                        <div>
                                            <small class="text-muted d-block mb-1">Date & Heure</small>
                                            <span class="fw-semibold" id="reminder-date-time"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="d-flex align-items-center mb-3">
                                        <div class="icon-circle bg-success bg-opacity-10 rounded-circle p-2 me-3">
                                            <i class="ri-file-text-line text-success"></i>
                                        </div>
                                        <div>
                                            <small class="text-muted d-block mb-1">Objet</small>
                                            <span class="fw-semibold" id="reminder-object"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="d-flex align-items-center mb-3">
                                        <div class="icon-circle bg-warning bg-opacity-10 rounded-circle p-2 me-3">
                                            <i class="ri-list-check-2 text-warning"></i>
                                        </div>
                                        <div>
                                            <small class="text-muted d-block mb-1">Statut</small>
                                            <span class="badge bg-warning-subtle text-warning px-2 py-1" id="reminder-status">
                                                <i class="ri-time-line me-1" ></i>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="d-flex">
                                        <div class="icon-circle bg-secondary bg-opacity-10 rounded-circle p-2 me-3">
                                            <i class="ri-file-list-line text-secondary"></i>
                                        </div>
                                        <div>
                                            <small class="text-muted d-block mb-1">Description</small>
                                            <span class="fw-semibold" id="reminder-description"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer border-0 bg-light px-4 py-3">
                            <button type="button" class="btn btn-light px-4 py-2" data-bs-dismiss="modal">
                                <i class="ri-close-line me-2"></i>Fermer
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Suppression d'un rappel -->
            <div class="modal fade" id="deleteReminderModal" tabindex="-1" aria-labelledby="deleteReminderModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content rounded-4 shadow-lg border-0">
                        <div class="modal-header border-0 bg-danger bg-opacity-10 px-4 py-3">
                            <div class="d-flex align-items-center">
                                <div class="modal-icon bg-danger bg-opacity-10 rounded-3 p-3 me-3">
                                    <i class="ri-delete-bin-line text-danger fs-4"></i>
                                </div>
                                <div>
                                    <h5 class="modal-title fw-semibold text-danger mb-1" id="deleteReminderModalLabel">
                                        Supprimer le rappel
                                    </h5>
                                    <p class="text-muted small mb-0">Suppression du rappel/rendez-vous</p>
                                </div>
                            </div>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body p-4">
                            <div class="text-center">
                                <div class="avatar-lg mx-auto mb-4">
                                    <div class="avatar-title bg-danger bg-opacity-10 text-danger display-5 rounded-circle">
                                        <i class="ri-error-warning-line"></i>
                                    </div>
                                </div>
                                <h5 class="mb-3">Êtes-vous sûr de vouloir supprimer ce rappel ?</h5>
                                <p class="text-muted">
                                    La suppression de ce rappel est définitive et ne pourra pas être annulée.
                                </p>
                            </div>
                        </div>
                        <div class="modal-footer border-0 bg-light px-4 py-3">
                            <button type="button" class="btn btn-light px-4 py-2" data-bs-dismiss="modal">
                                <i class="ri-close-line me-2"></i>Annuler
                            </button>
                            <button type="button" id="ConfirmDeleteReminderBtn" class="btn btn-danger px-4 py-2">
                                <i class="ri-delete-bin-line me-2"></i>Supprimer
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Modification Informations Entreprise -->
            <div class="modal fade" id="entrepriseModal" tabindex="-1" aria-labelledby="entrepriseModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content rounded-4 shadow-lg border-0">
                        <div class="modal-header border-0 bg-info bg-opacity-10 px-4 py-3">
                            <div class="d-flex align-items-center">
                                <div class="modal-icon bg-info bg-opacity-10 rounded-3 p-3 me-3">
                                    <i class="ri-building-line text-info fs-4"></i>
                                </div>
                                <div>
                                    <h5 class="modal-title fw-semibold text-info mb-1" id="entrepriseModalLabel">
                                        Modifier l'entreprise
                                    </h5>
                                    <p class="text-muted small mb-0">Mise à jour des informations de l'entreprise</p>
                                </div>
                            </div>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body p-4">
                            <div class="row g-3">
                                <div class="col-12">
                                    <label class="form-label fw-medium">Nom de l'entreprise</label>
                                    <input type="text" id="entreprise_nom_input" class="form-control border-0 bg-light py-2" placeholder="Entrez le nom de l'entreprise">
                                </div>
                                <div class="col-12">
                                    <label class="form-label fw-medium">Observations</label>
                                    <textarea id="entreprise_observation_input" class="form-control border-0 bg-light" rows="4" placeholder="Entrez vos observations..."></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer border-0 bg-light px-4 py-3">
                            <button type="button" class="btn btn-light px-4 py-2" data-bs-dismiss="modal">
                                <i class="ri-close-line me-2"></i>Annuler
                            </button>
                            <button type="button" class="btn btn-info px-4 py-2" id="saveEntrepriseBtn">
                                <i class="ri-save-line me-2"></i>Enregistrer
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Validation Rappel -->
            <div class="modal fade" id="validateReminderModal" tabindex="-1" aria-labelledby="validateReminderModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content rounded-4 shadow-lg border-0">
                        <div class="modal-header border-0 bg-success bg-opacity-10 px-4 py-3">
                            <div class="d-flex align-items-center">
                                <div class="modal-icon bg-success bg-opacity-10 rounded-3 p-3 me-3">
                                    <i class="ri-check-line text-success fs-4"></i>
                                </div>
                                <div>
                                    <h5 class="modal-title fw-semibold text-success mb-1" id="validateReminderModalLabel">
                                        Valider le rappel
                                    </h5>
                                    <p class="text-muted small mb-0">Confirmer l'exécution du rappel</p>
                                </div>
                            </div>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body p-4">
                            <div class="row g-3">
                                <div class="col-12">
                                    <label class="form-label fw-medium">Statut</label>
                                    <select id="validate_statut_reminder" class="form-select border-0 bg-light py-2">
                                        <option value="">Selectionnez une option</option>
                                        <option value="annule">Annuler</option>
                                        <option value="termine">Terminer</option>
                                        <option value="abouti">Abouti</option>
                                        <option value="nabouti">Non abouti</option>
                                    </select>
                                </div>
                                <div class="col-12">
                                    <label class="form-label fw-medium">Observations</label>
                                    <textarea id="observation_rappel" class="form-control border-0 bg-light" rows="4" placeholder="Entrez vos observations..."></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer border-0 bg-light px-4 py-3">
                            <button type="button" class="btn btn-light px-4 py-2" data-bs-dismiss="modal">
                                <i class="ri-close-line me-2"></i>Annuler
                            </button>
                            <button type="button" class="btn btn-success px-4 py-2" id="confirmValidateReminderBtn">
                                <i class="ri-check-line me-2"></i>Valider
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- container-fluid -->
    </div>
    <!-- End Page-content -->
</div>

<script>

    $(document).ready(function(){
        let id  = "{{ pk }}";

        function loadNotes(){
            $.ajax({
                url :"{% url 't_crm:ApiLoadNote' %}",
                dataType: "JSON",
                type : 'GET',
                data:{'id_prospect' : id},
                success: function(data){
                    var html = "";

                    if (data.length > 0){
                        $.each(data, function(index, item){
                            html +='<div class="border-start border-4 border-warning ps-4 py-2 bg-white rounded-end">';
                            html +='<div class="d-flex justify-content-between align-items-start mb-2">';
                            html +='<div class="d-flex align-items-center">';
                            html +='<div class="avatar-sm me-3"><div class="avatar-title bg-warning bg-opacity-10 text-warning rounded-circle fs-5">JM</div></div>';
                            html +='<div><h6 class="mb-0 fw-semibold">'+item.created_by__username+'</h6><small class="text-muted">'+item.created_at+'</small></div>';
                            html +='</div>';
                            html +='<div class="dropdown">';
                            html +='<button class="btn btn-icon btn-sm btn-ghost-secondary" data-bs-toggle="dropdown"><i class="ri-more-2-fill"></i></button>';
                            html +='<ul class="dropdown-menu dropdown-menu-end border-0 shadow-sm">';
                            html +='<li><button class="dropdown-item d-flex align-items-center" type="button" data-bs-toggle="modal" data-bs-target="#editNoteModal"><i class="ri-edit-line me-2"></i>Modifier</button></li>';
                            html +='<li><button class="dropdown-item d-flex align-items-center" type="button" data-bs-toggle="modal" data-id="'+item.id+'" id="deleteNoteBtn"><i class="ri-delete-bin-line me-2"></i>Supprimer</button></li>';
                            html +='</ul>';
                            html +='</div>';
                            html +='</div>';
                            html +='<p class="mb-3">'+item.note+'</p>';
                            html +='<div class="d-flex gap-2">';
                            html +='<span class="badge bg-warning-subtle text-warning">'+item.tage+'</span>';
                            html +='</div>';
                            html +='</div>';
                        });
                    }else{
                            html +='<button type="button" class="border-start border-4 border-dashed border-warning ps-4 py-4 bg-white rounded-end text-start w-100" data-bs-toggle="modal" data-bs-target="#addNoteModal">';
                            html +='<div class="d-flex align-items-center">';
                            html +='<div class="avatar-sm me-3">';
                            html +='<div class="avatar-title bg-warning bg-opacity-10 text-warning rounded-circle fs-5">';
                            html +='<i class="ri-add-line"></i>';
                            html +='</div>';
                            html +='</div>';
                            html +='<div>';
                            html +='<h6 class="fw-medium text-warning mb-0">Ajouter une note</h6>';
                            html +='<small class="text-muted">Cliquez pour ajouter une nouvelle note</small>';
                            html +='</div>';
                            html +='</div>';
                            html +='</button>';
                    }

                    $('#ListeDesNotes').html(html);
                }
            });
        }

        function loadFicheVoeux(){
            $.ajax({
                url : "{% url 't_crm:ApiLoadFicheVoeuxProspect' %}",
                dataType : 'JSON',
                type : 'GET',
                data : {'id_prospect' : id},
                success : function(data){
                    var html="";
                    if (data.fiche_voeux.length > 0){
                        $.each(data.fiche_voeux, function(index, item){
                            html += '<div class="col-12 col-md-4 text-center mb-4 mb-md-0">';
                                    html += '<div class="avatar-lg mx-auto mb-4">';
                                        html += '<div class="avatar-title bg-info bg-opacity-10 text-info display-5 rounded-circle">';
                                            html += '<i class="ri-school-line"></i>';
                                        html += '</div>';
                                    html += '</div>';
                                    html += '<h6 class="fw-semibold mb-2">Spécialité</h6>';
                                    html += '<p class="text-muted mb-0">'+item.specialite_label+'</p>';
                                html += '</div>';
                                html += '<div class="col-12 col-md-8 d-flex align-items-center">';
                                    html += '<div class="vstack gap-4 w-100">';
                                        html += '<div class="d-flex align-items-center justify-content-center">';
                                            html += '<div class="d-flex align-items-center bg-light rounded-3 p-3 w-100">';
                                                html += '<div class="flex-shrink-0">';
                                                    html += '<div class="avatar-sm">';
                                                        html += '<div class="avatar-title bg-info bg-opacity-10 text-info rounded-circle">';
                                                            html += '<i class="ri-calendar-line fs-5"></i>';
                                                        html += '</div>';
                                                    html += '</div>';
                                                html += '</div>';
                                                html += '<div class="flex-grow-1 ms-3 text-center">';
                                                    html += '<h6 class="mb-1">Date de création</h6>';
                                                    html += '<small class="text-muted">'+item.created_at+'</small>';
                                                html += '</div>';
                                            html += '</div>';
                                        html += '</div>';

                                        html += '<div class="d-flex align-items-center justify-content-center">';
                                            html += '<div class="d-flex align-items-center bg-light rounded-3 p-3 w-100">';
                                                html += '<div class="flex-shrink-0">';
                                                    html += '<div class="avatar-sm">';
                                                        html += '<div class="avatar-title bg-info bg-opacity-10 text-info rounded-circle"><i class="ri-time-line fs-5"></i></div>';
                                                    html += '</div>';
                                                html += '</div>';
                                                html += '<div class="flex-grow-1 ms-3 text-center"><h6 class="mb-1">Dernière mise à jour</h6><small class="text-muted">'+item.updated_at+'</small></div>';
                                            html += '</div>';
                                        html += '</div>';
                                        
                                    html += '</div>';
                                html += '</div>';
                        });
                    }else{
                        html += '<div class="col-12 text-center">';
                            html += '<div class="alert alert-info mb-0" role="alert">';
                                html += 'Aucune fiche de vœux disponible pour ce prospect.';
                            html += '</div>';
                        html += '</div>';
                    }

                    $('#procespectVoeuxDetails').html(html);

                }
            });
        }

        function loadPersonalInfos(){
            $.ajax({
                url : "{% url 't_crm:ApiLoadEntrepriseProspectInfo' %}",
                dataType : 'JSON',
                type : 'GET',
                data : {'id_prospect' : id},
                success : function(data){
                    $('#nom_prenom').text(data.nom + ' ' + data.prenom);
                    $('#email').text(data.email);
                    $('#phone').text(data.telephone);
                    $('#created_at').text(data.created_at);
                    $('#statut_prospect').text(data.statut_label);
                    $('#entreprise_nom').text(data.entreprise);
                    $('#entreprise_observation').text(data.observation || '-') ;

                    $('#entreprise_nom_input').val(data.entreprise);
                    $('#entreprise_observation_input').val(data.observation);

                    $('#nomInputUpdate').val(data.nom)
                    $('#prenomInputUpdate').val(data.prenom)
                    $('#emailInputUpdate').val(data.email)
                    $('#telephoneInputUpdate').val(data.telephone)
                    
                }
            });
        }

        function loadRappelRendezVous(){
            $.ajax({
                url : "{% url 't_crm:ApiLoadProspectRendezVous' %}",
                dataType: "JSON",
                type : "GET",
                data : {"id_prospect" : id},
                success : function(data){
                    var row = "";
                    if (data.length > 0){
                        $.each(data, function(index, item){
                            var statutBreak = "";
                            switch(item.statut){
                                case "nabouti":
                                    statutBreak = '<span class="badge bg-primary-subtle text-primary px-2 py-1"><i class="ri-time-line me-1"></i>' + item.status_label + '</span>';
                                break;

                                case "abouti":
                                    statutBreak = '<span class="badge bg-success-subtle text-success px-2 py-1"><i class="ri-time-line me-1"></i>' + item.status_label + '</span>';
                                break;

                                case "termine":
                                    statutBreak = '<span class="badge bg-danger-subtle text-danger px-2 py-1"><i class="ri-time-line me-1"></i>' + item.status_label + '</span>';
                                break;

                                case "nabouti":
                                    statutBreak = '<span class="badge bg-dark-subtle text-dark px-2 py-1"><i class="ri-time-line me-1"></i>' + item.status_label + '</span>';
                                break;

                                case "en_attente":
                                    statutBreak = '<span class="badge bg-warning-subtle text-warning px-2 py-1"><i class="ri-time-line me-1"></i>' + item.status_label + '</span>';
                                break;

                                case "annule":
                                    statutBreak = '<span class="badge bg-danger-subtle text-danger px-2 py-1"><i class="ri-time-line me-1"></i>' + item.status_label + '</span>';
                                break;

                            }
                            row += '<tr>';
                                row += '<td>';
                                    row += '<div class="d-flex align-items-center">';
                                        row += '<div class="icon-circle bg-primary bg-opacity-10 rounded-circle p-2 me-2">';
                                            row += (item.type =="appel") ? '<i class="ri-phone-line text-primary"></i>' : '<i class="ri-calendar-line text-primary"></i>';
                                        row += '</div>';
                                        row += '<span>' + item.type_label + '</span>';
                                    row += '</div>';
                                row += '</td>';
                                row += '<td>';
                                    row += '<div class="text-body">';
                                        row += '<i class="ri-time-line text-muted me-2"></i>' + item.created_at + '';
                                    row += '</div>';
                                row += '</td>';
                                row += '<td>';
                                    row += '<div class="text-wrap" style="max-width: 200px;">';
                                        row += '' + item.object + '';
                                    row += '</div>';
                                row += '</td>';
                                row += '<td>';
                                    row += ''+statutBreak+'';
                                row += '</td>';
                                row += '<td class="text-end">';
                                    row += '<div class="d-flex justify-content-end gap-2">';
                                        row += '<button class="btn btn-soft-primary btn-sm" data-bs-toggle="modal" id="editReminderBtn" data-id=' + item.id + '  title="Modifier">';
                                            row += '<i class="ri-edit-line"></i>';
                                        row += '</button>';
                                        row += '<button class="btn btn-soft-info btn-sm" data-bs-toggle="modal" id="detailsReminderBtn" data-id=' + item.id + '  title="Détails">';
                                            row += '<i class="ri-eye-line"></i>';
                                        row += '</button>';
                                        row += '<button class="btn btn-soft-success btn-sm" data-bs-toggle="modal" id="validateReminderBtn" data-id=' + item.id + '  title="Valider">';
                                            row += '<i class="ri-check-line"></i>';
                                        row += '</button>';
                                        row += '<button class="btn btn-soft-danger btn-sm" data-bs-toggle="modal" id="deleteReminderBtn" data-id=' + item.id + '  title="Supprimer">';
                                            row += '<i class="ri-delete-bin-line"></i>';
                                        row += '</button>';
                                    row += '</div>';
                                row += '</td>';
                            row += '</tr>';
                        });
                    }else{
                        
                        row += "<tr><td colspan='5' class='text-muted text-center'>Aucun rendez vous planiffier</td></tr>";
                    }

                    $('#listeDesRendezVous').html(row);
                }
            });
        }

        function loadDetailsRendezVous(id_rendez_vous){
            $.ajax({
                url : "{% url 't_crm:ApiLoadRendezVousDetails' %}",
                dataType: "JSON",
                type : "GET",
                data : {"id_rendez_vous" : id_rendez_vous},
                success : function(data){

                    $('#reminder-type').text(data[0].type_label);
                    $('#reminder-date-time').text(data[0].date_rendez_vous + ' ' + data[0].heure_rendez_vous);
                    $('#reminder-object').text(data[0].object);
                    $('#reminder-status').text(data[0].statut_label);
                    $('#reminder-description').text(data[0].description);
                    $('#detailsRendezVousModal').modal('show');
                        
                }
            });
        }

        function loadRemiderDetailsForUpdate(id_rendez_vous){
            $.ajax({
                url : "{% url 't_crm:ApiLoadRendezVousDetails' %}",
                dataType: "JSON",
                type: "GET",
                data : {'id_rendez_vous' : id_rendez_vous},
                success: function(data){
                    $('#editDescriptionRemider').val(data[0].description);
                    $('#editDateReminder').val(data[0].date_rendez_vous);
                    $('#editTimeReminer').val(data[0].heure_rendez_vous);
                    $('#editObjectReminder').val(data[0].object);
                    $('#editTypeReminder').val(data[0].type);
                    
                }
            });
        }

        loadNotes();
        loadFicheVoeux();
        loadPersonalInfos();
        loadRappelRendezVous();


        $(document).on('click', '#addNoteModalBtn', function(){

            $('#addNoteModal').modal('show');
        });

        
        $(document).on('click', '#addReminderBtn', function(){
            $('#addReminderModal').modal('show');
        });

        $(document).on('click', '#saveReminderBtn', function(){
            var type = $('#reminderType').val();
            var subject = $('#reminderSubject').val();
            var date = $('#reminderDate').val();
            var time = $('#reminderTime').val();
            var description = $('#reminderDescription').val();

            $.ajax({
                url: "{% url 't_crm:ApiStoreRappel' %}",
                dataType: 'JSON',
                type: 'POST',
                data: {
                    'type': type,
                    'subject': subject,
                    'date': date,
                    'time': time,
                    'description': description,
                    'id_prospect' : id,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function(data) {
                    if (data.status === 'success') {
                        $('#addReminderModal').modal('hide');
                        loadRappelRendezVous();
                        alertify.success(data.message);
                    } else {
                        alertify.error(data.message);
                    }
                }
            });
        });

        $(document).on('click', '#saveNoteBtn', function(){
            var content = $('#content_note').val();
            var tags  = $('#note_tags').val();
            if (content === ""){
                alert("Le contenu de la note ne peut pas être vide.");
                return;
            }
            $.ajax({
                url : "{% url 't_crm:ApiStoreNote' %}",
                dataType : 'JSON',
                type : 'POST',
                data : {
                    'id_prospect' : id,
                    'content' : content,
                    'tags' : tags,
                    'csrfmiddlewaretoken' : '{{ csrf_token }}'
                },
                success : function(data){
                    if (data.status === 'success'){
                        $('#addNoteModal').modal('hide');
                        loadNotes();
                        $('#content_note').val('');
                        alertify.success(data.message);
                    }else{
                        alert("Erreur lors de l'enregistrement de la note. Veuillez réessayer.");
                        alertify.error(data.message);
                    }
                }
            });
        });

        $(document).on('click', '#deleteNoteBtn', function(){
            var id_note = $(this).data('id');

            $('#deleteNoteModal').modal('show');
            $('#ConfirmDeleteNoteBtn').data('id', id_note);
        });

        $(document).on('click', '#ConfirmDeleteNoteBtn', function(){
            var id_note = $(this).data('id');
            $.ajax({
                url : "{% url 't_crm:ApiDeleteNote' %}",
                dataType : 'JSON',
                type : 'POST',
                data : {
                    'id_note' : id_note,
                    'csrfmiddlewaretoken' : '{{ csrf_token }}'
                },
                success : function(data){
                    if (data.status === 'success'){
                        $('#deleteNoteModal').modal('hide');
                        loadNotes();
                        alertify.success(data.message);
                    }else{
                        alertify.error(data.message);
                    }
                }
            });
        });

        $(document).on('click', '#editReminderBtn', function(){
            var id_rappel = $(this).data('id');
            // Load the reminder details and show the edit modal
            loadRemiderDetailsForUpdate(id_rappel);
            $('#editReminderBtnSave').data('id', id_rappel);
            $('#editReminderModal').modal('show');
                       
        });

        $(document).on('click','#editReminderBtnSave', function(){
            var editedDescription = $('#editDescriptionRemider').val();
            var editedType = $('#editTypeReminder').val();
            var editedDate = $('#editDateReminder').val();
            var editedTime = $('#editTimeReminer').val();
            var editedObject = $('#editObjectReminder').val();
            var id_rappel = $(this).data('id');
            $.ajax({
                url : "{% url 't_crm:ApiUpdateRappel' %}",
                dataType : 'JSON',
                type: 'POST',
                data : {
                    'id_rappel' : id_rappel,
                    'type' : editedType,
                    'subject' : editedObject,
                    'date' : editedDate,
                    'time' : editedTime,
                    'description' : editedDescription,
                    'csrfmiddlewaretoken' : '{{ csrf_token }}'
                },

                success : function(response){
                    if(response.status == "success"){
                        alertify.success(response.message);
                        loadRappelRendezVous();
                        $('#editReminderModal').modal('hide');
                        
                    }else{
                        alertify.error(response.message);
                    }
                }
            })
        });

        $(document).on('click', '#detailsReminderBtn', function(){
            var id_rappel = $(this).data('id');
            loadDetailsRendezVous(id_rappel);
            
            $('#detailsReminderModal').modal('show');
        });

        $(document).on('click', '#deleteReminderBtn', function(){
            var id_rappel = $(this).data('id');
            // Load the reminder details and show the delete modal
            $('#deleteReminderModal').modal('show');
            $('#ConfirmDeleteReminderBtn').data('id', id_rappel);
        });

        $(document).on('click', '#ConfirmDeleteReminderBtn', function(){
            var id_reminder = $(this).data('id');
            $.ajax({
                url :"{% url 't_crm:ApiArchiveReminder' %}",
                dataType : "JSON",
                type: "GET",
                data : {
                    'id_reminder' :  id_reminder,
                },
                success : function(response){
                    if (response.status === "success"){
                        alertify.success("Suppression effectué avec succès");   
                        loadRappelRendezVous();
                        $('#deleteReminderModal').modal('hide');
                    }else{  
                        alertify.error("Une erreur c'est produite lors du traitement de la requete !");
                    }
                }
            });
        });

        $(document).on('click', '#validateReminderBtn', function(){
            var id_rappel = $(this).data('id');
            $('#observation_rappel').val('');
            $('#validateReminderModal').modal('show');
            $('#confirmValidateReminderBtn').data('id', id_rappel);
        });

        $(document).on('click', '#confirmValidateReminderBtn', function(){
            var id_rappel = $(this).data('id');
            var observation = $('#observation_rappel').val();
            var statut_reminder = $('#validate_statut_reminder').val();

            $.ajax({
                url : "{% url 't_crm:ApiValidateRemider' %}",
                dataType : "JSON",
                type: 'POST',
                data : {
                    'id_reminder' : id_rappel,
                    'description' : observation,
                    'statut_reminder' : statut_reminder,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success : function(response){
                    if(response.status === "success"){
                        alertify.success("La validation du rappel a été effecuter avec succès");
                        loadRappelRendezVous();
                        $('#validateReminderModal').modal('hide');
                    }else{
                        alertify.error("Une erreur c'est produite lors du traitement de la requete !");
                    }
                }
            })
            
        });

        $(document).on('click', '#validateProspectBtn', function(){
            var id_prospect = $(this).data('id');
            // Load the prospect details and show the validate modal
            $('#validateProspectModal').modal('show');
            $('#confirmeValidationBtn').data('id', id_prospect);
        });

        $(document).on('click', '#confirmeValidationBtn', function(){
            var id_prospect = $(this).data('id');
            $.ajax({
                url : "{% url 't_crm:ApiValidateProspect' %}",
                dataType : 'JSON',
                type : 'POST',
                data : {
                    'id_prospect' : id_prospect,
                    'csrfmiddlewaretoken' : '{{ csrf_token }}'
                },
                success : function(data){
                    if (data.status === 'success'){
                        $('#validateProspectModal').modal('hide');
                        alertify.success(data.message);
                        
                    }else{
                        alertify.error(data.message);
                    }
                }
            });
        });

        $(document).on('click', '#udapteProspectDetailsBtn', function(){
            var id_prospect = $(this).data('id');
            // Load the prospect details and show the edit modal
            $('#editProspectModal').modal('show');
        });

        $(document).on('click','#validateUpdateProspectDetailsBtn', function(){
            
            var prenomUpdate = $('#prenomInputUpdate').val();
            var emailUpdate = $('#emailInputUpdate').val();
            var telephoneUpdate = $('#telephoneInputUpdate').val();
            var nomUpdate = $('#nomInputUpdate').val();

            $.ajax({
                url : "{% url 't_crm:ApiUpdateContactInfo' %}",
                dataType: 'JSON',
                type : "POST",
                data : {
                    'prenomUpdate' : prenomUpdate,
                    'emailUpdate' : emailUpdate,
                    'telephoneUpdate' : telephoneUpdate,
                    'nomUpdate' : nomUpdate,
                    'id_prospect' : id,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'

                },
                success : function(response){
                    if (response.status === "success"){
                        alertify.success("Les informations ont été mis à jours avec succès");
                        loadPersonalInfos();
                        $('#editProspectModal').modal('hide');

                    }else{  
                        alertify.error("Une erreur c'est produite lors du traitement de la requete");
                    }
                }
            });
                    
        });

        $(document).on('click', '#updateEtsDetails', function(){
            $('#entrepriseModal').modal('show');
        });

        $(document).on('click', '#saveEntrepriseBtn', function(){
            var entreprise_input = $('#entreprise_nom_input').val();
            var entreprise_observation_input = $('#entreprise_observation_input').val();

            $.ajax({
                url :'{% url "t_crm:ApiUpdateEntrepriseData" %}',
                dataType : "JSON",
                type : 'POST',
                data : {
                    'id_prospect' : id,
                    'designation' : entreprise_input,
                    'observation' : entreprise_observation_input,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function(response){
                    if (response.status ==="success"){
                        alertify.success("Les informations ont été mis à jours");
                        loadPersonalInfos();
                        $('#entrepriseModal').modal('hide');

                    }else{
                        alertify.error("Une erreur c'est produite lors du traitement de la requete");
                    }
                }
            });
        });

        
    });
</script>

{% endblock content %}