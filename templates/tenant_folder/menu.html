{% load static %}
{% load permissions_tags %}
<style>
    /* Modern Menu Design Variables */
    :root {
        --menu-width: 280px;
        --menu-bg: #ffffff;
        --menu-item-color: #545a6d;
        --menu-item-hover-color: #3b7ddd;
        --menu-item-active-bg: rgba(59, 125, 221, 0.1);
        --menu-item-active-color: #3b7ddd;
        --submenu-bg: rgba(248, 249, 250, 0.5);
        --border-color: #eff2f7;
    }

    /* General Menu Container */
    .app-menu {
        width: var(--menu-width) !important;
        min-width: var(--menu-width) !important;
        max-width: var(--menu-width) !important;
        background: var(--menu-bg);
        border-right: 1px solid var(--border-color);
        font-family: 'Inter', sans-serif; /* Ensuring modern font if available */
    }

    .app-menu .container-fluid {
        padding: 0 0.5rem !important;
    }

    /* Menu Titles (Sections) */
    .app-menu .menu-title {
        padding: 1rem 0.5rem 0.4rem;
        letter-spacing: 0.05em;
        text-transform: uppercase;
        color: #919da9;
        font-weight: 600;
        font-size: 0.75rem !important;
        opacity: 0.9;
    }

    /* Main Navigation Items */
    .app-menu .nav-item {
        margin-bottom: 0.2rem !important;
        border-bottom: 1px solid transparent !important; /* Cleaner separation */
    }

    .app-menu .nav-link {
        color: var(--menu-item-color) !important;
        padding: 0.5rem 0.75rem !important;
        font-size: 0.9rem !important;
        font-weight: 500;
        border-radius: 8px;
        transition: all 0.25s ease-in-out;
        display: flex;
        align-items: center;
        letter-spacing: 0.01em;
        white-space: nowrap;
        overflow: hidden; /* Flex container fix */
    }

    /* Handle text truncation inside nav link */
    .app-menu .nav-link span {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        flex: 1; 
        min-width: 0;
    }

    .app-menu .nav-link i {
        font-size: 1.15rem !important;
        min-width: 1.7rem; /* Fixed width for icon alignment */
        transition: transform 0.2s ease;
        opacity: 0.8;
    }

    /* Hover State - Modern Card Style */
    .app-menu .nav-link:hover:not(.active) {
        color: var(--menu-item-hover-color) !important;
        background-color: var(--submenu-bg) !important;
        transform: translateX(3px);
    }

    .app-menu .nav-link:hover i {
        opacity: 1;
        color: var(--menu-item-hover-color);
        transform: scale(1.05); /* Subtle grow */
    }

    /* Active State - Highlighted */
    .app-menu .nav-link.active {
        color: var(--menu-item-active-color) !important;
        background-color: var(--menu-item-active-bg) !important;
        font-weight: 600 !important;
        box-shadow: 0 2px 4px rgba(59, 125, 221, 0.05);
    }

    .app-menu .nav-link.active i {
        opacity: 1;
        color: var(--menu-item-active-color);
    }

    /* Submenu Header (Group Parents) */
    .app-menu .submenu-header {
        padding: 0.5rem 0.75rem !important;
        border-radius: 8px;
        margin-bottom: 0.3rem !important;
        transition: background-color 0.2s;
        cursor: pointer;
        display: flex;
        align-items: center;
        white-space: nowrap;
        overflow: hidden;
    }

    /* Wrap text content for proper truncation */
    .app-menu .submenu-header > div {
        flex: 1;
        min-width: 0;
        overflow: hidden;
    }

    .app-menu .submenu-header h6,
    .app-menu .submenu-header small {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .app-menu .submenu-header:hover {
        background-color: var(--submenu-bg) !important;
    }

    .app-menu .submenu-header h6 {
        font-size: 0.85rem !important;
        color: #495057;
        margin-left: 0.4rem;
        font-weight: 600;
        margin-bottom: 0px !important;
    }
    
    .app-menu .submenu-header small {
        font-size: 0.75rem !important;
        color: #74788d;
        margin-left: 0.4rem;
        display: block;
        opacity: 0.8;
    }

    /* Submenu Icons (Circle Backgrounds) */
    .submenu-icon {
        width: 34px; 
        height: 34px;
        min-width: 34px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%; /* Perfect circle */
        background-color: rgba(59, 125, 221, 0.08) !important;
        transition: all 0.3s ease;
    }

    .app-menu .submenu-header:hover .submenu-icon {
        background-color: rgba(59, 125, 221, 0.15) !important;
        transform: scale(1.05);
    }
    
    .app-menu .submenu-content .submenu-header .submenu-icon i {
         font-size: 1rem !important; 
    }

    /* Submenu Content Tree */
    .submenu-content {
        padding-left: 0;
        margin-left: 1.2rem; /* Align with icon center */
        border-left: 2px solid var(--border-color);
        margin-top: 0.4rem !important;
        margin-bottom: 0.8rem !important;
        padding-top: 0.2rem;
    }

    /* Submenu Items */
    .app-menu .submenu-item a {
        padding: 0.5rem 0.8rem !important;
        font-size: 0.85rem !important;
        color: #6a7187 !important;
        border-radius: 6px;
        margin-bottom: 3px !important;
        margin-left: 0.3rem; /* Spacing from border line */
        display: flex;
        align-items: center;
        transition: all 0.2s;
        background: transparent !important;
    }
    
    .app-menu .submenu-content .submenu-item a i {
        font-size: 0.9rem !important; /* Slightly smaller icons for children */
    }

    .app-menu .submenu-item.bg-light, 
    .app-menu .submenu-item.bg-opacity-50 {
        background-color: transparent !important; /* Override bootstrap utils */
    }

    .app-menu .submenu-item a:hover {
        color: var(--menu-item-hover-color) !important;
        background-color: rgba(59, 125, 221, 0.06) !important;
        transform: translateX(4px);
    }

    .app-menu .submenu-item a.active {
        color: var(--menu-item-active-color) !important;
        background-color: rgba(59, 125, 221, 0.1) !important;
        font-weight: 600;
    }

    .app-menu .submenu-item a i {
        margin-right: 8px;
        opacity: 0.7;
        transition: opacity 0.2s;
    }

    .app-menu .submenu-item a:hover i,
    .app-menu .submenu-item a.active i {
        opacity: 1;
        color: var(--menu-item-active-color);
    }
    
    /* Chevron Arrow */
    .submenu-arrow {
        margin-left: auto;
        font-size: 1rem;
        transition: transform 0.3s;
        opacity: 0.5;
    }
    
    .submenu-header[aria-expanded="true"] .submenu-arrow {
        transform: rotate(180deg);
        opacity: 1;
        color: var(--menu-item-active-color);
    }

    /* Scrollbar Styling */
    #scrollbar {
        height: calc(100vh - 70px);
        overflow-y: auto;
        padding-bottom: 3rem;
    }
    
    #scrollbar::-webkit-scrollbar {
        width: 5px;
    }
    
    #scrollbar::-webkit-scrollbar-thumb {
        background-color: #dbe0e6;
        border-radius: 10px;
    }
    
    #scrollbar::-webkit-scrollbar-track {
        background: transparent;
    }

    /* Status Badges */
    .badge {
        padding: 0.4em 0.7em;
        font-size: 0.7em;
        font-weight: 600;
        border-radius: 6px;
        letter-spacing: 0.3px;
    }
    /* Layout Synchronization */
    @media (min-width: 768px) {
        .main-content, .footer {
            margin-left: var(--menu-width) !important;
        }
        
        #page-topbar {
            left: var(--menu-width) !important;
            width: calc(100% - var(--menu-width)) !important;
        }
    }
</style>

<!-- ========== App Menu ========== -->
<div class="app-menu navbar-menu">
    <!-- LOGO -->
    <div class="navbar-brand-box">
        <!-- Dark Logo-->
        <a href="{% url 'institut_app:index' %}" class="logo logo-dark">
            <span class="logo-sm">
                <img src="{% static 'images/insim-logo.png' %}" alt="" height="50">
            </span>
            <span class="logo-lg">
                <img src="{% static 'images/insim-logo.png' %}" alt="" height="70">
            </span>
        </a>
        <!-- Light Logo-->
        <a href="{% url 'institut_app:index' %}" class="logo logo-light">
            <span class="logo-sm">
                <img src="{% static 'images/insim-logo.png' %}" alt="" height="50">
            </span>
            <span class="logo-lg">
                <img src="{% static 'images/insim-logo.png' %}" alt="" height="70">
            </span>
        </a>
        <button type="button" class="btn btn-sm p-0 fs-20 header-item float-end btn-vertical-sm-hover" id="vertical-hover">
            <i class="ri-record-circle-line"></i>
        </button>
    </div>

    <div id="scrollbar">
        <div class="container-fluid px-0">

            <div id="two-column-menu">
            </div>
            <ul class="navbar-nav" id="navbar-nav">
                <li class="menu-title"><span data-key="t-menu">Menu Principal</span></li> 
                {% user_can_access 'ger' 'view' as can_view_tab_gerant %}
                {% if can_view_tab_gerant or request.user.is_superuser %}
                <li class="nav-item">
                    <a href="{% url 'institut_app:directeur_dashboard' %}" class="nav-link menu-link rounded-2 mx-2 mb-1 {% if request.resolver_match.url_name in 'directeur_dashboard' %}active{% endif %}">
                        <i class="bx bx-tachometer fs-5"></i> <span class="ms-1">Tableau de bord</span>
                    </a>
                </li>
                {% endif %}
                  <!-- Communication -->
                <li class="nav-item {% if request.resolver_match.url_name in 'tenant_comm_hub tenant_comm_detail calendar messages conversation index' %}active{% endif %}">
                    <a class="nav-link menu-link rounded-2 mx-2 mb-1" href="#sidebarCommunication" data-bs-toggle="collapse" role="button"
                    aria-expanded="{% if request.resolver_match.url_name in 'tenant_comm_hub tenant_comm_detail calendar messages conversation index' %}true{% else %}false{% endif %}" aria-controls="sidebarCommunication">
                        <i class="ri-chat-3-line fs-5"></i> <span class="ms-1">Communication</span>
                    </a>
                    <div class="collapse menu-dropdown {% if request.resolver_match.url_name in 'tenant_comm_hub tenant_comm_detail calendar messages conversation index' %}show{% endif %}" id="sidebarCommunication">
                        <div class="submenu-container">
                            <div class="row g-1">
                                <div class="col-12">
                                    <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                        <a href="{% url 't_communication:calendar' %}" class="nav-link {% if request.resolver_match.url_name in 'calendar index' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                            <i class="ri-calendar-line me-1"></i>
                                            <span>Mon Calendrier</span>
                                        </a>
                                    </div>
                                    <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                        <a href="{% url 't_communication:messages' %}" class="nav-link {% if request.resolver_match.url_name in 'messages conversation' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                            <i class="ri-message-3-line me-1"></i>
                                            <span>Mes Messages</span>
                                        </a>
                                    </div>
                                     {% user_can_access 'com' 'view' as can_view_communication %}
                                    {% if can_view_communication or request.user.is_superuser %}
                                    <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                        <a href="{% url 'tenant_comm_hub' %}" class="nav-link {% if request.resolver_match.url_name in 'tenant_comm_hub tenant_comm_detail' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                            <i class="ri-git-repository-private-line me-1"></i>
                                            <span>Flux Inter-Etablissements</span>
                                        </a>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </li>
                

                {% user_can_access 'crm' 'view' as can_view_crm %}
                {% if can_view_crm or request.user.is_superuser %}
                    <!-- CRM -->
                    <li class="nav-item {% if request.resolver_match.url_name in 'crm_dashboard crm_reporting prospects_incomplets_view DetailsProspect liste_derogations DetailsPrinscrit ListeDesPrinscrits  ListeDesProspects inscription_entreprise inscription_particulier ListeDemandeInscription updateVisiteur nouveau_visiteur liste_visiteurs details_visiteur' %}active{% endif %}">
                        <a class="nav-link menu-link rounded-2 mx-2 mb-1" href="#sidebarCRM" data-bs-toggle="collapse" role="button"
                        aria-expanded="{% if request.resolver_match.url_name in 'crm_dashboard crm_reporting prospects_incomplets_view  DetailsProspect liste_derogations DetailsPrinscrit ListeDesPrinscrits  ListeDesProspects inscription_entreprise inscription_particulier ListeDemandeInscription updateVisiteur nouveau_visiteur liste_visiteurs details_visiteur' %}true{% else %}false{% endif %}" aria-controls="sidebarCRM">
                            <i class="bx bx-user-check fs-5"></i> <span class="ms-1">Relation Client</span>
                        </a>
                        <div class="collapse menu-dropdown {% if request.resolver_match.url_name in 'crm_dashboard crm_reporting DetailsProspect liste_derogations prospects_incomplets_view DetailsPrinscrit ListeDesPrinscrits ListeDesProspects inscription_entreprise inscription_particulier ListeDemandeInscription updateVisiteur nouveau_visiteur liste_visiteurs details_visiteur' %}show{% endif %}" id="sidebarCRM">
                            <div class="submenu-container">
                                <div class="row g-1">
                                    <div class="col-12">
                                        <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                            <a href="{% url 'institut_app:crm_dashboard' %}" class="nav-link {% if request.resolver_match.url_name in 'crm_dashboard' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                <i class="bx bx-tachometer me-1"></i>
                                                <span>Tableau de bord</span>
                                            </a>
                                        </div>
                                        <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                            <a href="{% url 't_crm:crm_reporting' %}" class="nav-link {% if request.resolver_match.url_name == 'crm_reporting' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                <i class="bx bx-bar-chart-alt-2 me-1"></i>
                                                <span>Reporting</span>
                                            </a>
                                        </div>
                                        <a href="#sidebarProspects" class="submenu-header d-flex align-items-center justify-content-between rounded-2" data-bs-toggle="collapse">
                                            
                                            <div class="d-flex align-items-center py-2 px-2">
                                                <div class="submenu-icon bg-primary bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-user-plus text-primary"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Gestion des Prospects</h6>
                                                    <small class="text-muted">Création et suivi</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow me-2"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1 {% if request.resolver_match.url_name in 'ListeDesProspects inscription_particulier inscription_entreprise' %}show{% endif %}" id="sidebarProspects">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_crm:inscription_particulier' %}" class="nav-link {% if request.resolver_match.url_name == 'inscription_particulier' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-user me-1"></i>
                                                    <span>Particulier</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_crm:inscription_entreprise' %}" class="nav-link {% if request.resolver_match.url_name == 'inscription_entreprise' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-building me-1"></i>
                                                    <span>Entreprise</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_crm:ListeDesProspects' %}" class="nav-link {% if request.resolver_match.url_name in 'ListeDesProspects DetailsProspect' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-list-ul me-1"></i>
                                                    <span>Liste des prospects</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-12">
                                        <a href="#sidebarPrinscrit" class="submenu-header d-flex align-items-center justify-content-between rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center py-2 px-2">
                                                <div class="submenu-icon bg-primary bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-user-plus text-primary"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Gestion des Préinscrits</h6>
                                                    <small class="text-muted">Suivi</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow me-2"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1 {% if request.resolver_match.url_name in 'liste_derogations DetailsPrinscrit ListeDesPrinscrits prospects_incomplets_view' %}show{% endif %}" id="sidebarPrinscrit">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_crm:ListeDesPrinscrits' %}" class="nav-link {% if request.resolver_match.url_name in 'DetailsPrinscrit ListeDesPrinscrits' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-user me-1"></i>
                                                    <span>Liste des préinscrits</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_crm:prospects_incomplets_view' %}" class="nav-link {% if request.resolver_match.url_name == 'prospects_incomplets_view' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-folder me-1"></i>
                                                    <span>Dossiers incomplets</span>
                                                </a>
                                            </div>
                                            {% user_can_access 'crm' 'approuv' as cas_validate_crm %}
                                            {% if cas_validate_crm or request.user.is_superuser %}
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_crm:liste_derogations' %}" class="nav-link {% if request.resolver_match.url_name == 'liste_derogations' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-error me-1"></i>
                                                    <span>Dérogations d'inscription</span>
                                                </a>
                                            </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    
                                 
                                </div>
                            </div>
                        </div>
                    </li>
                    <!-- CRM -->
                {% endif %}

                {% user_can_access 'ped' 'view' as can_view_pedagogie %}
                {% if can_view_pedagogie or request.user.is_superuser %}
                    <!-- Formation -->
                    <li class="nav-item {% if request.resolver_match.url_name in 'UpdatePartenaire updateFormation updateSpecialite PageAssociation detailsPartenaire PageListeModules listPromos AddPromo archiveModule listFormations addFormation listPartenaires addPartenaire detailFormation addSpecialite detailSpecialite listSpecialites updateSpecialite' %}active{% endif %}">
                        <a class="nav-link menu-link rounded-2 mx-2 mb-1" href="#sidebarFormation" data-bs-toggle="collapse" role="button" 
                        aria-expanded="{% if request.resolver_match.url_name in 'UpdatePartenaire updateFormation PageAssociation detailsPartenaire PageListeModules listPromos AddPromo archiveModule listFormations addFormation listPartenaires addPartenaire addSpecialite detailFormation detailSpecialite listSpecialites updateSpecialite' %}true{% else %}false{% endif %}" 
                        aria-controls="sidebarFormation">
                        <i class='bx bxs-graduation fs-5'></i> <span data-key="t-authentication" class="ms-1">Formation</span>
                        </a>
                        <div class="collapse menu-dropdown {% if request.resolver_match.url_name in 'UpdatePartenaire updateFormation PageAssociation detailsPartenaire PageListeModules listPromos AddPromo archiveModule listFormations addFormation listPartenaires addPartenaire addSpecialite detailFormation detailSpecialite listSpecialites updateSpecialite' %}show{% endif %}" id="sidebarFormation">
                            <div class="submenu-container">
                                <div class="row g-1">
                                    <div class="col-12">
                                        <a href="#sidebarPartenaire" class="submenu-header d-flex align-items-center justify-content-between rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center py-2 px-2">
                                                <div class="submenu-icon bg-info bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-buildings text-info"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Partenaires</h6>
                                                    <small class="text-muted">Gestion des partenariats</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow me-2"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1 {% if request.resolver_match.url_name in 'detailsPartenaire listPartenaires addPartenaire' %}show{% endif %}" id="sidebarPartenaire">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_formations:listPartenaires' %}" class="nav-link {% if request.resolver_match.url_name in 'detailsPartenaire listPartenaires' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-list-ul me-1"></i>
                                                    <span>Liste des partenaires</span>
                                                </a>
                                            </div>
                                            
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-2">
                                                <a href="{% url 't_formations:addPartenaire' %}" class="nav-link {% if request.resolver_match.url_name == 'addPartenaire' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-plus-circle me-1"></i>
                                                    <span>Nouveau partenaire</span>
                                                </a>
                                            </div>
                                            
                                        </div>
                                    </div>

                                    <div class="col-12 mt-2">
                                        <a href="#sidebarePromos" class="submenu-header d-flex align-items-center justify-content-between rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center py-2 px-2">
                                                <div class="submenu-icon bg-info bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-calendar text-info"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Promotions</h6>
                                                    <small class="text-muted">Gestion des sessions</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow me-2"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1 {% if request.resolver_match.url_name in 'listPromos AddPromo' %}show{% endif %}" id="sidebarePromos">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_formations:listPromos' %}" class="nav-link {% if request.resolver_match.url_name == 'listPromos' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-list-ul me-1"></i>
                                                    <span>Liste des promotions</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_formations:AddPromo' %}" class="nav-link {% if request.resolver_match.url_name == 'AddPromo' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-plus-circle me-1"></i>
                                                    <span>Nouvelle promotion</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-12 mt-2">
                                        <a href="#sidebarFormationList" class="submenu-header d-flex align-items-center justify-content-between rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center py-2 px-2">
                                                <div class="submenu-icon bg-success bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-book text-success"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Formations</h6>
                                                    <small class="text-muted">Catalogue de formations</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow me-2"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1 {% if request.resolver_match.url_name in 'listFormations addFormation detailFormation updateFormation' %}show{% endif %}" id="sidebarFormationList">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_formations:listFormations' %}" class="nav-link {% if request.resolver_match.url_name in 'listFormations updateFormation' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-list-ul me-1"></i>
                                                    <span>Catalogue</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_formations:addFormation' %}" class="nav-link {% if request.resolver_match.url_name == 'addFormation' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-plus-circle me-1"></i>
                                                    <span>Nouvelle formation</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-12 mt-2">
                                        <a href="#sidebarSpecialite" class="submenu-header d-flex align-items-center justify-content-between rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center py-2 px-2">
                                                <div class="submenu-icon bg-warning bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-tag-alt text-warning"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Spécialités</h6>
                                                    <small class="text-muted">Domaines d'expertise</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow me-2"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1 {% if request.resolver_match.url_name in 'detailSpecialite listSpecialites addSpecialite' %}show{% endif %}" id="sidebarSpecialite">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_formations:listSpecialites' %}" class="nav-link {% if request.resolver_match.url_name == 'listSpecialites' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-list-ul me-1"></i>
                                                    <span>Liste des spécialités</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_formations:addSpecialite' %}" class="nav-link {% if request.resolver_match.url_name == 'addSpecialite' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-plus-circle me-1"></i>
                                                    <span>Nouvelle spécialité</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-12 mt-2">
                                        <a href="#sidebarDoubleDiplomation" class="submenu-header d-flex align-items-center justify-content-between rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center py-2 px-2">
                                                <div class="submenu-icon bg-info bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-link text-info"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Double diplomation</h6>
                                                    <small class="text-muted">Associations de spécialités</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow me-2"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1" id="sidebarDoubleDiplomation">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_formations:PageAssociation' %}" class="nav-link {% if request.resolver_match.url_name in 'PageAssociation' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-link me-1"></i>
                                                    <span>Associations</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-12 mt-2">
                                        <a href="#sideBarModules" class="submenu-header d-flex align-items-center justify-content-between rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center py-2 px-2">
                                                <div class="submenu-icon bg-secondary bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-cube text-secondary"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Modules</h6>
                                                    <small class="text-muted">Composants pédagogiques</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow me-2"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1 {% if request.resolver_match.url_name in ' PageListeModules ' %}show{% endif %}" id="sideBarModules">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_formations:PageListeModules' %}" class="nav-link {% if request.resolver_match.url_name == 'PageListeModules' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-list-ul me-1"></i>
                                                    <span>Liste des modules</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1 mx-2">
                                                <a href="{% url 't_formations:archiveModule' %}" class="nav-link {% if request.resolver_match.url_name == 'archiveModule' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-archive me-1"></i>
                                                    <span>Archives</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-12 mt-2">
                                        <a href="#sidebarArchive" class="submenu-header d-flex align-items-center justify-content-between rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center py-2 px-2">
                                                <div class="submenu-icon bg-danger bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-archive text-danger"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Archives</h6>
                                                    <small class="text-muted">Contenu archivé</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow me-2"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1 {% if request.resolver_match.url_name in ' archiveModule archiveFormation' %}show{% endif %}" id="sidebarArchive">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1 mx-2">
                                                <a href="{% url 't_formations:archiveModule' %}" class="nav-link {% if request.resolver_match.url_name == 'archiveModule' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-cube me-1"></i>
                                                    <span>Modules archivés</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2">
                                                <a href="{% url 't_formations:archiveFormation' %}" class="nav-link {% if request.resolver_match.url_name == 'archiveFormation' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-book me-1"></i>
                                                    <span>Formations archivées</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-12 mt-2">
                                        <a href="#sidebarConfigFormation" class="submenu-header d-flex align-items-center justify-content-between rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center py-2 px-2">
                                                <div class="submenu-icon bg-secondary bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-cog text-secondary"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Configuration</h6>
                                                    <small class="text-muted">Outils et paramètres</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow me-2"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1 {% if request.resolver_match.url_name in 'import_data_view' %}show{% endif %}" id="sidebarConfigFormation">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_formations:import_data_view' %}" class="nav-link {% if request.resolver_match.url_name == 'import_data_view' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-import me-1"></i>
                                                    <span>Import des données</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>
                    <!-- Formation -->
                 {% endif %}

                {% user_can_access 'rh' 'view' as can_view_rh %}
                {% if can_view_rh or request.user.is_superuser %}
                    <!-- Ressources Humaines -->
                    <li class="nav-item {% if request.resolver_match.url_name in 'rubrique_list updatePoste ListeDesPostes detailsCategorie ListeCategorieContrat ClausesTypeContrat listeTypeContrat nouveau_employe detailsEmploye liste_employes liste_articles_contrat liste_services contrat_list contrat_create contrat_update fiche_paie_detail fiche_paie_list config_paie' %}active{% endif %}">
                        <a class="nav-link menu-link rounded-2 mx-2 mb-1" href="#sidebarRh" data-bs-toggle="collapse" role="button" 
                        aria-expanded="{% if request.resolver_match.url_name in 'rubrique_list updatePoste ListeDesPostes detailsCategorie ListeCategorieContrat ClausesTypeContrat listeTypeContrat nouveau_employe detailsEmploye liste_employes liste_articles_contrat liste_services contrat_list contrat_create contrat_update fiche_paie_detail fiche_paie_list config_paie' %}true{% else %}false{% endif %}" aria-controls="sidebarRh">
                            <i class="bx bx-user-circle fs-5"></i><span class="ms-1">Ressources Humaines</span>
                        </a>
                        <div class="collapse menu-dropdown {% if request.resolver_match.url_name in 'rubrique_list updatePoste ListeDesPostes detailsCategorie ListeCategorieContrat ClausesTypeContrat listeTypeContrat nouveau_employe detailsEmploye liste_employes liste_articles_contrat liste_services contrat_list contrat_create contrat_update fiche_paie_detail fiche_paie_list config_paie' %}show{% endif %}" id="sidebarRh">
                            <div class="submenu-container">
                                <div class="row g-1">
                                    <div class="col-12">
                                        <a href="#sidebareEmp" class="submenu-header d-flex align-items-center justify-content-between p-2 rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center">
                                                <div class="submenu-icon bg-primary bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-group text-primary"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Gestion des Employés</h6>
                                                    <small class="text-muted">Recrutement et suivi</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1 {% if request.resolver_match.url_name in 'nouveau_employe liste_employes detailsEmploye' %}show{% endif %}" id="sidebareEmp">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_rh:liste_employes' %}" class="nav-link {% if request.resolver_match.url_name == 'liste_employes' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-list-ul me-1"></i>
                                                    <span>Liste des employés</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2">
                                                <a href="{% url 't_rh:nouveau_employe' %}" class="nav-link {% if request.resolver_match.url_name == 'nouveau_employe' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-user-plus me-1"></i>
                                                    <span>Nouvel employé</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-12 mt-2">
                                        <a href="#sidebarCtr" class="submenu-header d-flex align-items-center justify-content-between p-2 rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center">
                                                <div class="submenu-icon bg-success bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-file text-success"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Gestion des Contrats</h6>
                                                    <small class="text-muted">Documents et types</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1" id="sidebarCtr">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="#" class="nav-link d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-list-ul me-1"></i>
                                                    <span>Liste des contrats</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2">
                                                <a href="#" class="nav-link d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-plus-circle me-1"></i>
                                                    <span>Nouveau contrat</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-12 mt-2">
                                        <a href="#sidebarPaieFormateur" class="submenu-header d-flex align-items-center justify-content-between p-2 rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center">
                                                <div class="submenu-icon bg-info bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-money text-info"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Paie Formateur</h6>
                                                    <small class="text-muted">Gestion des paies formateurs</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1 {% if request.resolver_match.url_name in 'contrat_list contrat_create contrat_update fiche_paie_detail fiche_paie_list config_paie' %}show{% endif %}" id="sidebarPaieFormateur">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_ressource_humaine:contrat_list' %}" class="nav-link {% if request.resolver_match.url_name in 'contrat_list contrat_create contrat_update fiche_paie_detail' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-money me-1"></i>
                                                    <span>Paie & Contrats</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_ressource_humaine:fiche_paie_list' %}" class="nav-link {% if request.resolver_match.url_name == 'fiche_paie_list' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-history me-1"></i>
                                                    <span>Historique des paies</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_ressource_humaine:rubrique_list' %}" class="nav-link {% if request.resolver_match.url_name == 'rubrique_list' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-list-check me-1"></i>
                                                    <span>Rubriques (Primes)</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_ressource_humaine:config_paie' %}" class="nav-link {% if request.resolver_match.url_name == 'config_paie' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-cog me-1"></i>
                                                    <span>Configuration</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-12 mt-2">
                                        <a href="#sidebarConfRh" class="submenu-header d-flex align-items-center justify-content-between p-2 rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center">
                                                <div class="submenu-icon bg-warning bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-cog text-warning"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Configuration RH</h6>
                                                    <small class="text-muted">Paramètres et structures</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1 {% if request.resolver_match.url_name in 'ListeDesPostes updatePoste detailsCategorie ListeCategorieContrat ClausesTypeContrat listeTypeContrat liste_articles_contrat liste_services' %}show{% endif %}" id="sidebarConfRh">
                                            <div class="submenu-section rounded-2 p-2">
                                                <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                    <a href="{% url 't_rh:ListeDesPostes' %}" class="nav-link {% if request.resolver_match.url_name in 'updatePoste ListeDesPostes' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                        <i class="bx bx-briefcase me-1"></i>
                                                        <span>Postes</span>
                                                    </a>
                                                </div>
                                                <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                    <a href="{% url 't_rh:liste_services' %}" class="nav-link {% if request.resolver_match.url_name == 'liste_services' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                        <i class="bx bx-buildings me-1"></i>
                                                        <span>Services</span>
                                                    </a>
                                                </div>
                                                <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                    <a href="{% url 't_rh:ListeCategorieContrat' %}" class="nav-link {% if request.resolver_match.url_name in 'ListeCategorieContrat detailsCategorie' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                        <i class="bx bx-category me-1"></i>
                                                        <span>Catégories de contrat</span>
                                                    </a>
                                                </div>
                                                <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                    <a href="{% url 't_rh:liste_articles_contrat' %}" class="nav-link {% if request.resolver_match.url_name == 'liste_articles_contrat' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                        <i class="bx bx-file me-1"></i>
                                                        <span>Articles de contrat</span>
                                                    </a>
                                                </div>
                                                <div class="submenu-item bg-light bg-opacity-50 rounded-2">
                                                    <a href="{% url 't_rh:listeTypeContrat' %}" class="nav-link {% if request.resolver_match.url_name in 'listeTypeContrat ClausesTypeContrat' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                        <i class="bx bx-tag me-1"></i>
                                                        <span>Types de contrat</span>
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>
                    <!-- Ressources Humaines -->              
                {% endif %}
                
                {% user_can_access 'scol' 'view' as can_view_scolarite %}
                {% if can_view_scolarite or request.user.is_superuser %}
                    <!-- Scolarité -->
                    <li class="nav-item {% if request.resolver_match.url_name in 'PageModeleContrat AffectationPage StudentDetails AffectationAuGroupe ListeStudents listegroupes nouveaugroupe detailsgroupe' %}active{% endif %}">
                        <a class="nav-link menu-link rounded-2 mx-2 mb-1" href="#sidebarScolarite" data-bs-toggle="collapse" role="button" 
                            aria-expanded="{% if request.resolver_match.url_name in 'PageModeleContrat ListeStudents StudentDetails AffectationAuGroupe listegroupes nouveaugroupe detailsgroupe' %}true{% else %}false{% endif %}" 
                            aria-controls="sidebarScolarite">
                            <i class="bx bx-book-content fs-5"></i><span class="ms-1">Scolarité</span>
                        </a>
                        <div class="collapse menu-dropdown {% if request.resolver_match.url_name in 'PageModeleContrat AffectationPage StudentDetails AffectationAuGroupe ListeStudents listegroupes nouveaugroupe detailsgroupe' %}show{% endif %}" 
                            id="sidebarScolarite">
                            <div class="submenu-container">
                                <div class="row g-1">
                                    <div class="col-12">
                                        <a href="#sidbareGroupe" class="submenu-header d-flex align-items-center justify-content-between p-2 rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center">
                                                <div class="submenu-icon bg-primary bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-group text-primary"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Gestion des Groupes</h6>
                                                    <small class="text-muted">Classes et affectations</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1 {% if request.resolver_match.url_name in 'listegroupes nouveaugroupe detailsgroupe' %}show{% endif %}" id="sidbareGroupe">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_groupe:listegroupes' %}" class="nav-link {% if request.resolver_match.url_name in 'listegroupes detailsgroupe' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-list-ul me-1"></i>
                                                    <span>Liste des groupes</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2">
                                                <a href="{% url 't_groupe:nouveaugroupe' %}" class="nav-link {% if request.resolver_match.url_name == 'nouveaugroupe' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-plus-circle me-1"></i>
                                                    <span>Nouveau groupe</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-12 mt-2">
                                        <a href="#sidebaraffectation" class="submenu-header d-flex align-items-center justify-content-between p-2 rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center">
                                                <div class="submenu-icon bg-info bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-transfer text-info"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Affectations</h6>
                                                    <small class="text-muted">Répartition des étudiants</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1" id="sidebaraffectation">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2">
                                                <a href="{% url 't_groupe:AffectationPage' %}" class="nav-link {% if request.resolver_match.url_name in 'AffectationPage AffectationAuGroupe' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-time me-1"></i>
                                                    <span>En attente d'affectation</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>

                                

                                    <div class="col-12 mt-2">
                                        <a href="#sidebarStudent" class="submenu-header d-flex align-items-center justify-content-between p-2 rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center">
                                                <div class="submenu-icon bg-success bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-user text-success"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Gestion des Étudiants</h6>
                                                    <small class="text-muted">Inscriptions et dossiers</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1 {% if request.resolver_match.url_name in 'ListeStudents' %}show{% endif %}" id="sidebarStudent">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2">
                                                <a href="{% url 't_etudiants:ListeStudents' %}" class="nav-link {% if request.resolver_match.url_name in 'ListeStudents StudentDetails' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-list-ul me-1"></i>
                                                    <span>Liste des étudiants</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>
                    <!-- Scolarité -->
                {% endif %}

                {% user_can_access 'ped' 'view' as can_view_interface %}
                {% if can_view_interface or request.user.is_superuser %}
                    <!-- Chargé de formation -->
                    <li class="nav-item {% if request.resolver_match.url_name in 'pedago_dashboard timetable_view PageSuivieCours model_creneau_detail PageAffectation CreateTimeTable PageFormateurs ListeDesEmploie timetable_edit ListeDesSalles ListeModelCrenau timetable_configure model_creneau_edit RegistrePage DetailsRegistrePresence DetailsListePresence' %}active{% endif %}">
                        <a class="nav-link menu-link rounded-2 mx-2 mb-1" href="#sidebarChargedeFormation" data-bs-toggle="collapse" role="button" 
                        aria-expanded="{% if request.resolver_match.url_name in 'pedago_dashboard timetable_view PageSuivieCours model_creneau_detail PageAffectation CreateTimeTable PageFormateurs ListeDesEmploie timetable_edit ListeDesSalles ListeModelCrenau timetable_configure model_creneau_edit RegistrePage DetailsRegistrePresence DetailsListePresence' %}true{% else %}false{% endif %}"
                        aria-controls="sidebarChargedeFormation">
                            <i class="bx bx-calendar-edit fs-5"></i><span class="ms-1">Interface pédagogique</span>
                        </a>
                        <div class="collapse menu-dropdown {% if request.resolver_match.url_name in 'pedago_dashboard timetable_view PageSuivieCours model_creneau_detail PageAffectation CreateTimeTable PageFormateurs ListeDesEmploie timetable_edit ListeDesSalles ListeModelCrenau timetable_configure model_creneau_edit RegistrePage DetailsRegistrePresence DetailsListePresence' %}show{% endif %}" 
                            id="sidebarChargedeFormation">
                            <div class="submenu-container">
                                <div class="row g-1">
                                    <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                        <a href="{% url 'institut_app:pedago_dashboard' %}" class="nav-link {% if request.resolver_match.url_name in 'pedago_dashboard' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                            <i class="bx bx-tachometer me-1"></i>
                                            <span>Tableau de bord</span>
                                        </a>
                                    </div>
                                    <!-- Emploi du temps submenu -->
                                    <div class="col-12">
                                        <a href="#sidebarEmploiTemps" class="submenu-header d-flex align-items-center justify-content-between p-2 rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center">
                                                <div class="submenu-icon bg-primary bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-calendar text-primary"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Emploi du temps</h6>
                                                    <small class="text-muted">Gestion des horaires</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1 {% if request.resolver_match.url_name in 'model_creneau_detail ListeDesEmploie timetable_edit ListeDesSalles ListeModelCrenau timetable_configure model_creneau_edit' %}show{% endif %}" 
                                            id="sidebarEmploiTemps">
                                            <div class="row g-1">
                                                
                                                <div class="col-12">
                                                    <div class="submenu-section rounded-2 p-2 mb-2">
                                                        <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                            <a href="{% url 't_timetable:ListeDesEmploie' %}" class="nav-link {% if request.resolver_match.url_name in 'timetable_view ListeDesEmploie timetable_configure timetable_edit' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                                <i class="bx bx-list-ul me-1"></i>
                                                                <span>Emplois du temps</span>
                                                            </a>
                                                        </div>
                                                        <div class="submenu-item bg-light bg-opacity-50 rounded-2">
                                                            <a href="{% url 't_timetable:CreateTimeTable' %}" class="nav-link {% if request.resolver_match.url_name == 'CreateTimeTable' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                                <i class="bx bx-plus-circle me-1"></i>
                                                                <span>Nouvel emploi du temps</span>
                                                            </a>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Formateurs submenu -->
                                    <div class="col-12 mt-2">
                                        <a href="#sidebarFormateurs" class="submenu-header d-flex align-items-center justify-content-between p-2 rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center">
                                                <div class="submenu-icon bg-warning bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-chalkboard text-warning"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Formateurs</h6>
                                                    <small class="text-muted">Gestion des formateurs</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1" id="sidebarFormateurs">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_formations:PageFormateurs' %}" class="nav-link {% if request.resolver_match.url_name in 'PageFormateurs' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-list-ul me-1"></i>
                                                    <span>Liste des formateurs</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="#" class="nav-link d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-plus-circle me-1"></i>
                                                    <span>Nouveau formateur</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2">
                                                <a href="{% url 't_timetable:PageAffectation' %}" class="nav-link {% if request.resolver_match.url_name in 'PageAffectation' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-transfer me-1"></i>
                                                    <span>Affectation module</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Avancement Cours submenu -->
                                    <div class="col-12 mt-2">
                                        <a href="#sidebarAvancementCours" class="submenu-header d-flex align-items-center justify-content-between p-2 rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center">
                                                <div class="submenu-icon bg-info bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-bar-chart text-info"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Avancement Cours</h6>
                                                    <small class="text-muted">Suivi de progression</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1" 
                                            id="sidebarAvancementCours">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_timetable:PageSuivieCours' %}" class="nav-link {% if request.resolver_match.url_name in 'PageSuivieCours' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-list-ul me-1"></i>
                                                    <span>Rapport d'avancement</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Suivi des présences submenu -->
                                    <div class="col-12 mt-2">
                                        <a href="#sidebarSuiviPresence" class="submenu-header d-flex align-items-center justify-content-between p-2 rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center">
                                                <div class="submenu-icon bg-success bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-calendar-check text-success"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Suivi des présences</h6>
                                                    <small class="text-muted">Gestion des présences</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1 {% if request.resolver_match.url_name in 'DetailsRegistrePresence RegistrePage DetailsListePresence' %}show{% endif %}" 
                                            id="sidebarSuiviPresence">
                                            <div class="row g-1">
                                                <div class="col-12">
                                                    <a href="#sidebarRegistrePresence" class="submenu-header d-flex align-items-center justify-content-between p-2 rounded-2" data-bs-toggle="collapse">
                                                        <div class="d-flex align-items-center">
                                                            <div class="submenu-icon bg-primary bg-opacity-10 rounded-circle p-1 me-2">
                                                                <i class="bx bx-book text-primary"></i>
                                                            </div>
                                                            <div>
                                                                <h6 class="mb-0 fw-semibold">Registre</h6>
                                                                <small class="text-muted">Gestion des registres</small>
                                                            </div>
                                                        </div>
                                                        <i class="bx bx-chevron-down submenu-arrow"></i>
                                                    </a>
                                                    <div class="collapse submenu-content mt-1" id="sidebarRegistrePresence">
                                                        <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                            <a href="{% url 't_etudiants:RegistrePage' %}" class="nav-link {% if request.resolver_match.url_name in 'RegistrePage DetailsRegistrePresence DetailsListePresence' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                                <i class="bx bx-list-ul me-1"></i>
                                                                <span>Liste des registres</span>
                                                            </a>
                                                        </div>
                                                        <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                            <a href="{% url 't_etudiants:ListeStudents' %}" class="nav-link {% if request.resolver_match.url_name in '' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                                <i class="bx bx-user me-1"></i>
                                                                <span>Liste des étudiants</span>
                                                            </a>
                                                        </div>
                                                        <div class="submenu-item bg-light bg-opacity-50 rounded-2">
                                                            <a href="#" class="nav-link d-flex align-items-center py-1 px-2 rounded-2">
                                                                <i class="bx bx-file me-1"></i>
                                                                <span>Rapport de présence</span>
                                                            </a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Configuration -->
                                    <div class="col-12 mt-2">
                                        <a href="#sidebarConfigurationInterface" class="submenu-header d-flex align-items-center justify-content-between p-2 rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center">
                                                <div class="submenu-icon bg-info bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-bar-chart text-info"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Configuration</h6>
                                                    <small class="text-muted">Parametres de gestion</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1 {% if request.resolver_match.url_name in 'ListeDesSalles ListeModelCrenau' %}show{% endif %}" id="sidebarConfigurationInterface" >
                                            <div class="col-12">
                                                    <a href="#sidebarSalle" class="submenu-header d-flex align-items-center justify-content-between p-2 rounded-2" data-bs-toggle="collapse">
                                                        <div class="d-flex align-items-center">
                                                            <div class="submenu-icon bg-primary bg-opacity-10 rounded-circle p-1 me-2">
                                                                <i class="bx bx-door-open text-primary"></i>
                                                            </div>
                                                            <div>
                                                                <h6 class="mb-0 fw-semibold">Gestion des Salles</h6>
                                                                <small class="text-muted">Salles de cours</small>
                                                            </div>
                                                        </div>
                                                        <i class="bx bx-chevron-down submenu-arrow"></i>
                                                    </a>
                                                    <div class="collapse submenu-content mt-1" id="sidebarSalle">
                                                        <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                            <a href="{% url 't_timetable:ListeDesSalles' %}" class="nav-link {% if request.resolver_match.url_name in 'ListeDesSalles' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                                <i class="bx bx-list-ul me-1"></i>
                                                                <span>Liste des salles</span>
                                                            </a>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div class="col-12 mt-2">
                                                    <a href="#sidebarModeleCreneau" class="submenu-header d-flex align-items-center justify-content-between p-2 rounded-2" data-bs-toggle="collapse">
                                                        <div class="d-flex align-items-center">
                                                            <div class="submenu-icon bg-warning bg-opacity-10 rounded-circle p-1 me-2">
                                                                <i class="bx bx-time text-warning"></i>
                                                            </div>
                                                            <div>
                                                                <h6 class="mb-0 fw-semibold">Modèles de créneau</h6>
                                                                <small class="text-muted">Modèles d'horaires</small>
                                                            </div>
                                                        </div>
                                                        <i class="bx bx-chevron-down submenu-arrow"></i>
                                                    </a>
                                                    <div class="collapse submenu-content mt-1" id="sidebarModeleCreneau">
                                                        <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                            <a href="{% url 't_timetable:ListeModelCrenau' %}" class="nav-link {% if request.resolver_match.url_name in 'ListeModelCrenau model_creneau_edit model_creneau_detail' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                                <i class="bx bx-list-ul me-1"></i>
                                                                <span>Modèles disponibles</span>
                                                            </a>
                                                        </div>
                                                    </div>
                                                </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>
                    <!-- Chargé de formation -->
                {% endif %}

                {% user_can_access 'exa' 'view' as cas_view_exam %}
                {% if can_view_exam or request.user.is_superuser %}
                    <!-- Examens -->
                    <li class="nav-item {% if request.resolver_match.url_name in 'PageListeSessionExam PageDetailsSessionExamPlan PageDeliberationResult PagePvDeliberation ShowPv exams_results DetailsCommission UpdateCommission PageCommission NouvelleCommission ModelBuilltinPage DetailsSession ListeSession' %}active{% endif %}">
                        <a class="nav-link menu-link rounded-2 mx-2 mb-1" href="#sidebarGesExam" data-bs-toggle="collapse" role="button"
                        aria-expanded="{% if request.resolver_match.url_name in 'PageListeSessionExam PageDetailsSessionExamPlan PageDeliberationResult PagePvDeliberation ShowPv exams_results DetailsCommission UpdateCommission PageCommission NouvelleCommission ModelBuilltinPage DetailsSession ListeSession' %}true{% else %}false{% endif %}"
                        aria-controls="sidebarGesExam">
                            <i class="bx bx-file fs-5"></i><span class="ms-1">Examens</span>
                        </a>
                        <div class="collapse menu-dropdown {% if request.resolver_match.url_name in 'PageListeSessionExam PageDetailsSessionExamPlan PageDeliberationResult PagePvDeliberation ShowPv exams_results DetailsCommission UpdateCommission NouvelleCommission PageCommission ModelBuilltinPage DetailsSession ListeSession' %}show{% endif %}" id="sidebarGesExam">
                            <div class="submenu-container">
                                <div class="row g-1">
                                    <div class="col-12">
                                        <a href="#sidebarExamens" class="submenu-header d-flex align-items-center justify-content-between p-2 rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center">
                                                <div class="submenu-icon bg-primary bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-file text-primary"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Examens</h6>
                                                    <small class="text-muted">Gestion des examens</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1" id="sidebarExamens">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_exam:ListeSession' %}" class="nav-link {% if request.resolver_match.url_name in 'PageDetailsSessionExamPlan ShowPv DetailsSession ListeSession' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-history me-1"></i>
                                                    <span>Sessions d'examens</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_exam:exams_results' %}" class="nav-link {% if request.resolver_match.url_name in 'exams_results' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-line-chart me-1"></i>
                                                    <span>PV d'examens</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_exam:PagePvDeliberation' %}" class="nav-link {% if request.resolver_match.url_name in 'PagePvDeliberation PageDeliberationResult' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-line-chart me-1"></i>
                                                    <span>PV de délibération</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_exam:PageListeSessionExam' %}" class="nav-link {% if request.resolver_match.url_name in 'PageListeSessionExam liste_etudiants student_bulletin' and request.resolver_match.url_name != 'ListeSession' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-line-chart me-1"></i>
                                                    <span>Bulletins de notes</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-12">
                                        <a href="#sideBarCommission" class="submenu-header d-flex align-items-center justify-content-between p-2 rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center">
                                                <div class="submenu-icon bg-warning bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="ri-folder-shared-line"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Commission pédagogique</h6>
                                                    <small class="text-muted">Planification des examens</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1 {% if request.resolver_match.url_name in 'PageCommission NouvelleCommission' %}show{% endif %}" id="sideBarCommission">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2">
                                                <a href="{% url 't_exam:PageCommission' %}" class="nav-link {% if request.resolver_match.url_name in 'PageCommission UpdateCommission' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-file me-1"></i>
                                                    <span>Liste des commissions</span>
                                                </a>
                                                <a href="{% url 't_exam:NouvelleCommission' %}" class="nav-link {% if request.resolver_match.url_name == 'NouvelleCommission' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-file me-1"></i>
                                                    <span>Nouvelle commission</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-12">
                                        <a href="#sideBarParamExam" class="submenu-header d-flex align-items-center justify-content-between p-2 rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center">
                                                <div class="submenu-icon bg-warning bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-cog text-warning"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Paramètres</h6>
                                                    <small class="text-muted">Configuration des examens</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1 {% if request.resolver_match.url_name in 'ModelBuilltinPage ' %}show{% endif %}" id="sideBarParamExam">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2">
                                                <a href="{% url 't_exam:ModelBuilltinPage' %}" class="nav-link {% if request.resolver_match.url_name == 'ModelBuilltinPage' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-file me-1"></i>
                                                    <span>Modèles de PV</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>
                    <!-- Examens -->
                {% endif %}

                {% user_can_access 'scol' 'view' as cas_view_stage %}
                {% if can_view_stage or request.user.is_superuser %}
                    <!-- Stages -->
                    <li class="nav-item {% if request.resolver_match.url_name in 'list_focus_groups launch_stage stage_dashboard list_stages focus_group_detail presentation_form validation_council' %}active{% endif %}">
                        <a class="nav-link menu-link rounded-2 mx-2 mb-1" href="#sidebarStages" data-bs-toggle="collapse" role="button"
                        aria-expanded="{% if request.resolver_match.url_name in 'list_focus_groups launch_stage stage_dashboard list_stages focus_group_detail presentation_form validation_council' %}true{% else %}false{% endif %}"
                        aria-controls="sidebarStages">
                            <i class="bx bxs-graduation fs-5"></i><span class="ms-1">Stages</span>
                        </a>
                        <div class="collapse menu-dropdown {% if request.resolver_match.url_name in 'list_focus_groups launch_stage stage_dashboard list_stages focus_group_detail presentation_form validation_council' %}show{% endif %}" id="sidebarStages">
                            <div class="submenu-container">
                                <div class="row g-1">
                                    <div class="col-12">
                                        <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                            <a href="{% url 't_stage:stage_dashboard' %}" class="nav-link {% if request.resolver_match.url_name == 'stage_dashboard' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                <i class="bx bx-tachometer me-1"></i>
                                                <span>Tableau de bord</span>
                                            </a>
                                        </div>
                                        <a href="#sidebarSuiviStages" class="submenu-header d-flex align-items-center justify-content-between p-2 rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center">
                                                <div class="submenu-icon bg-primary bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-list-ul text-primary"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Suivi des Stages</h6>
                                                    <small class="text-muted">Étudiants et Focus Groups</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1 {% if request.resolver_match.url_name in 'launch_stage list_stages focus_group_detail presentation_form' %}show{% endif %}" id="sidebarSuiviStages">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_stage:launch_stage' %}" class="nav-link {% if request.resolver_match.url_name == 'launch_stage' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-plus-circle me-1"></i>
                                                    <span>Lancement de stage</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_stage:list_stages' %}" class="nav-link {% if request.resolver_match.url_name == 'list_stages' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-user-voice me-1"></i>
                                                    <span>Liste des stages</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_stage:list_focus_groups' %}" class="nav-link {% if request.resolver_match.url_name == 'list_focus_groups' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-group me-1"></i>
                                                    <span>Gestion des Focus Groups</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_stage:validation_council' %}" class="nav-link {% if request.resolver_match.url_name == 'validation_council' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-check-shield me-1"></i>
                                                    <span>Conseils de Validation</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>
                    <!-- Stages -->
                {% endif %}

                {% user_can_access 'tre' 'view' as can_view_finance %}
                {% if can_view_finance or request.user.is_superuser %}
                    <!-- Finance -->
                    <li class="nav-item {% if request.resolver_match.url_name in 'PageRecouvrement ReportingDAS ListeRemise ListeRemiseApplique ListePenalite PageConfPenalite PageNouveauAutrePaiement pageautrespaiement DetailsEcheancierClientDouble PageImputationComptable PageProduits PageFacturation ImputationBancaire PageBrouillardCaisse PageBrouillardBanque DetailsRembourssement liste_types_depenses PageDetailsFournisseur PageNouveauFournisseur PageFournisseur PageNouvelleDepense PageDepenses listeDesRembourssement DetailsEcheancierClient FinanceDashboard ListeDesPaiements PageRemboursement ListeRemise PageDetailsDemandePaiement attentes_de_paiements PageConfigPaiementSeuil liste_des_remises ListeModelEcheancier CreeEcheancier ListeEcheancierSpecial ListeEcheanciersConfigures SuivieEcheancier' %}active{% endif %}">
                         <a class="nav-link menu-link rounded-2 mx-2 mb-1" href="#sidebarFinance" data-bs-toggle="collapse" role="button" 
                        aria-expanded="{% if request.resolver_match.url_name in 'PageRecouvrement ReportingDAS ListeRemise ListeRemiseAppliqueListePenalite PageConfPenalite PageNouveauAutrePaiement pageautrespaiement PageImputationComptable DetailsEcheancierClientDouble PageProduits PageFacturation ImputationBancaire PageBrouillardCaisse PageBrouillardBanque DetailsRembourssement liste_types_depenses PageDetailsFournisseur PageNouveauFournisseur PageFournisseur PageNouvelleDepense PageDepenses listeDesRembourssement DetailsEcheancierClient FinanceDashboard ListeDesPaiements PageRemboursement ListeRemise PageDetailsDemandePaiement attentes_de_paiements PageConfigPaiementSeuil liste_des_remises ListeModelEcheancier CreeEcheancier ListeEcheancierSpecial ListeEcheanciersConfigures SuivieEcheancier' %}true{% else %}false{% endif %}" 
                        aria-controls="sidebarFinance">
                            <i class='bx bx-money fs-5'></i> <span data-key="t-authentication" class="ms-1">Comptabilité/Finance</span>
                        </a>
                        <div class="collapse menu-dropdown {% if request.resolver_match.url_name in 'PageRecouvrement ReportingDAS ListeRemise ListeRemiseApplique ListePenalite PageConfPenalite pageautrespaiement PageNouveauAutrePaiement PageImputationComptable DetailsEcheancierClientDouble PageProduits PageFacturation ImputationBancaire PageBrouillardCaisse PageBrouillardBanque DetailsRembourssement liste_types_depenses PageDetailsFournisseur PageNouveauFournisseur PageFournisseur PageNouvelleDepense PageDepenses listeDesRembourssement DetailsEcheancierClient FinanceDashboard ListeDesPaiements PageRemboursement ListeRemise PageDetailsDemandePaiement PageConfigPaiementSeuil attentes_de_paiements liste_des_remises ListeModelEcheancier CreeEcheancier ListeEcheancierSpecial ListeEcheanciersConfigures SuivieEcheancier' %}show{% endif %}" id="sidebarFinance">
                            <div class="submenu-container">
                                <div class="row g-1">
                                    <div class="col-12">
                                        <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                            <a href="{% url 'institut_app:FinanceDashboard' %}" class="nav-link {% if request.resolver_match.url_name in 'FinanceDashboard' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                <i class="bx bx-tachometer me-1"></i>
                                                <span>Tableau de bord financier</span>
                                            </a>
                                        </div>
                                        <a href="#sidebarTresorerie" class="submenu-header d-flex align-items-center justify-content-between p-2 rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center">
                                                <div class="submenu-icon bg-success bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-wallet text-success"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Trésorerie</h6>
                                                    <small class="text-muted">Gestion des paiements</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1 {% if request.resolver_match.url_name in ' ListeDesPaiements PageRemboursement ListeRemise PageDetailsDemandePaiement attentes_de_paiements liste_des_remises SuivieEcheancier' %}show{% endif %}" id="sidebarTresorerie">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_tresorerie:attentes_de_paiements' %}" class="nav-link {% if request.resolver_match.url_name in ' PageDetailsDemandePaiement attentes_de_paiements' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-time me-1"></i>
                                                    <span>Inscription/Tranche</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_tresorerie:ListePenalite' %}" class="nav-link {% if request.resolver_match.url_name in ' ListePenalite' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-time me-1"></i>
                                                    <span>Autres paiements (Pénalité/rachat-autres-liste-des paiements)</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_tresorerie:PageRemboursement' %}" class="nav-link {% if request.resolver_match.url_name in 'PageRemboursement' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-undo me-1"></i>
                                                    <span>Remboursements</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2">
                                                <a href="{% url 't_tresorerie:ReportingDAS' %}" class="nav-link {% if request.resolver_match.url_name == 'ReportingDAS' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-chart me-1"></i>
                                                    <span class="fw-bold">Rapport DAS</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_tresorerie:listeDesRembourssement' %}" class="nav-link {% if request.resolver_match.url_name in 'DetailsRembourssement listeDesRembourssement' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-list-ul me-1"></i>
                                                    <span>Liste des remboursements</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_tresorerie:SuivieEcheancier' %}" class="nav-link {% if request.resolver_match.url_name in 'DetailsEcheancierClient DetailsEcheancierClientDouble SuivieEcheancier' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-calendar-check me-1"></i>
                                                    <span>Suivi des échéanciers</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2">
                                                <a href="{% url 't_tresorerie:ListeDesPaiements' %}" class="nav-link {% if request.resolver_match.url_name == 'ListeDesPaiements' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-list-ul me-1"></i>
                                                    <span>Tous les paiements</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Menu Remises dans CRM -->
                                    <div class="col-12 mt-2">
                                        <a href="#sidebarRemises" class="submenu-header d-flex align-items-center justify-content-between rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center py-2 px-2">
                                                <div class="submenu-icon bg-info  bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-gift text-info"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Remises</h6>
                                                    <small class="text-muted">Gestion des réductions</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow me-2"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1 {% if request.resolver_match.url_name in 'ListeRemiseApplique ListeRemise' %}show{% endif %}" id="sidebarRemises">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href='{% url "t_crm:ListeRemiseApplique" %}' class="nav-link {% if request.resolver_match.url_name == 'ListeRemiseApplique' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-list-check me-1"></i>
                                                    <span>Remises appliquées</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Fin Menu Remises dans CRM -->
                                    
                                    <div class="col-12 mt-2">
                                        <a href="#sidebarCaisse" class="submenu-header d-flex align-items-center justify-content-between p-2 rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center">
                                                <div class="submenu-icon bg-danger bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-wallet text-danger"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Caisse</h6>
                                                    <small class="text-muted">Gestion de caisse</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1" id="sidebarCaisse">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_tresorerie:PageBrouillardCaisse' %}" class="nav-link {% if request.resolver_match.url_name == 'PageBrouillardCaisse' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-notepad me-1"></i>
                                                    <span>Brouillard de caisse</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-12 mt-2">
                                        <a href="#sidebarBanque" class="submenu-header d-flex align-items-center justify-content-between p-2 rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center">
                                                <div class="submenu-icon bg-danger bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-wallet text-danger"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Banque</h6>
                                                    <small class="text-muted">Gestion des comptes</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow"></i>
                                        </a>
                                        
                                        <div class="collapse submenu-content mt-1 {% if request.resolver_match.url_name in 'PageBrouillardBanque ImputationBancaire PageRecouvrement' %}show{% endif %}" id="sidebarBanque">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_tresorerie:PageBrouillardBanque' %}" class="nav-link {% if request.resolver_match.url_name == 'PageBrouillardBanque' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-notepad me-1"></i>
                                                    <span>Brouillard de banque</span>
                                                </a>
                                            </div>

                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_tresorerie:ImputationBancaire' %}" class="nav-link {% if request.resolver_match.url_name == 'ImputationBancaire' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-notepad me-1"></i>
                                                    <span>Imputation bancaire</span>
                                                </a>
                                            </div>

                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_tresorerie:PageRecouvrement' %}" class="nav-link {% if request.resolver_match.url_name == 'PageRecouvrement' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-check-shield me-1"></i>
                                                    <span>Recouvrement</span>
                                                </a>
                                            </div>

                                        </div>
                                    </div>
                                    
                                    <div class="col-12 mt-2">
                                        <a href="#sidebarEcheanciers" class="submenu-header d-flex align-items-center justify-content-between p-2 rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center">
                                                <div class="submenu-icon bg-info bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-calendar text-info"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Gestion des Échéanciers</h6>
                                                    <small class="text-muted">Planification des paiements</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1 {% if request.resolver_match.url_name in 'ListeModelEcheancier CreeEcheancier ListeEcheancierSpecial ListeEcheanciersConfigures' %}show{% endif %}" id="sidebarEcheanciers">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_tresorerie:ListeModelEcheancier' %}" class="nav-link {% if request.resolver_match.url_name == 'ListeModelEcheancier' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-file me-1"></i>
                                                    <span>Modèles</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_tresorerie:CreeEcheancier' %}" class="nav-link {% if request.resolver_match.url_name == 'CreeEcheancier' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-plus-circle me-1"></i>
                                                    <span>Créer un échéancier</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_tresorerie:ListeEcheancierSpecial' %}" class="nav-link {% if request.resolver_match.url_name == 'ListeEcheancierSpecial' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-star me-1"></i>
                                                    <span>Échéancier spécial</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2">
                                                <a href="{% url 't_tresorerie:ListeEcheanciersConfigures' %}" class="nav-link {% if request.resolver_match.url_name == 'ListeEcheanciersConfigures' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-list-check me-1"></i>
                                                    <span>Échéanciers configurés</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-12 mt-2">
                                        <a href="#sidebarProduit" class="submenu-header d-flex align-items-center justify-content-between p-2 rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center">
                                                <div class="submenu-icon bg-danger bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="ri-currency-line"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Autres paiements</h6>
                                                    <small class="text-muted">Gestion des paiements</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1" id="sidebarProduit">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_tresorerie:pageautrespaiement' %}" class="nav-link {% if request.resolver_match.url_name == 'pageautrespaiement' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-list-ul me-1"></i>
                                                    <span>Liste des paiements</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2">
                                                <a href="{% url 't_tresorerie:PageNouveauAutrePaiement' %}" class="nav-link {% if request.resolver_match.url_name == 'PageNouveauAutrePaiement' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-plus-circle me-1"></i>
                                                    <span>Nouveau paiement</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-12 mt-2">
                                        <a href="#sidebarDepenses" class="submenu-header d-flex align-items-center justify-content-between p-2 rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center">
                                                <div class="submenu-icon bg-danger bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-purchase-tag text-danger"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Dépenses</h6>
                                                    <small class="text-muted">Gestion des dépenses</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1" id="sidebarDepenses">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_tresorerie:PageDepenses' %}" class="nav-link {% if request.resolver_match.url_name == 'PageDepenses' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-list-ul me-1"></i>
                                                    <span>Liste des dépenses</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2">
                                                <a href="{% url 't_tresorerie:PageNouvelleDepense' %}" class="nav-link {% if request.resolver_match.url_name == 'PageNouvelleDepense' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-plus-circle me-1"></i>
                                                    <span>Nouvelle dépense</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-12 mt-2">
                                        <a href="#sidebarFournisseurs" class="submenu-header d-flex align-items-center justify-content-between p-2 rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center">
                                                <div class="submenu-icon bg-primary bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-store text-primary"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Fournisseurs</h6>
                                                    <small class="text-muted">Gestion des fournisseurs</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1" id="sidebarFournisseurs">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_tresorerie:PageFournisseur' %}" class="nav-link {% if request.resolver_match.url_name in 'PageDetailsFournisseur PageFournisseur' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-list-ul me-1"></i>
                                                    <span>Liste des fournisseurs</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2">
                                                <a href="{% url 't_tresorerie:PageNouveauFournisseur' %}" class="nav-link {% if request.resolver_match.url_name == 'PageNouveauFournisseur' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-plus-circle me-1"></i>
                                                    <span>Nouveau fournisseur</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-12 mt-2">
                                        <a href="#sidebarFactures" class="submenu-header d-flex align-items-center justify-content-between p-2 rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center">
                                                <div class="submenu-icon bg-info bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-receipt text-info"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Factures</h6>
                                                    <small class="text-muted">Gestion de la facturation</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1" id="sidebarFactures">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_tresorerie:PageFacturation' %}" class="nav-link {% if request.resolver_match.url_name == 'PageFacturation' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-envelope me-1"></i>
                                                    <span>Factures émises</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-12 mt-2">
                                        <a href="#sidbareParam" class="submenu-header d-flex align-items-center justify-content-between p-2 rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center">
                                                <div class="submenu-icon bg-warning bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-cog text-warning"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Paramètres Financiers</h6>
                                                    <small class="text-muted">Configuration des seuils</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1 {% if request.resolver_match.url_name in 'PageConfigPaiementSeuil ListeRemise liste_types_depenses' %}show{% endif %}" id="sidbareParam">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_tresorerie:PageConfigPaiementSeuil' %}" class="nav-link {% if request.resolver_match.url_name == 'PageConfigPaiementSeuil' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-slider me-1"></i>
                                                    <span>Seuils de paiement</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_remise:ListeRemise' %}" class="nav-link {% if request.resolver_match.url_name == 'ListeRemise' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="fas fa-percent me-1"></i>
                                                    <span>Gestion des remises</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_tresorerie:PageProduits' %}" class="nav-link {% if request.resolver_match.url_name == 'PageProduits' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="ri-wallet-2-line me-1"></i>
                                                    <span>Type de produits</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_tresorerie:liste_types_depenses' %}" class="nav-link {% if request.resolver_match.url_name == 'liste_types_depenses' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-wallet me-1"></i>
                                                    <span>Type de dépenses</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_tresorerie:PageImputationComptable' %}" class="nav-link {% if request.resolver_match.url_name == 'PageImputationComptable' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-wallet me-1"></i>
                                                    <span>Liaison spécialités - comptes</span>
                                                </a>
                                            </div>

                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_tresorerie:PageConfPenalite' %}" class="nav-link {% if request.resolver_match.url_name == 'PageConfPenalite' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-wallet me-1"></i>
                                                    <span>Pénalités de retard</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>
                    <!-- Finance -->
                {% endif %}

                    
                {% user_can_access 'con' 'view' as cans_view_conseil %}
                {% if can_view_conseil or request.user.is_superuser %}
                    <!-- Conseil -->
                    <!-- Conseil -->
                    <li class="nav-item {% if request.resolver_match.url_name in 'ListeDAS PipelineConseil ConfigurationConseil configure-devis DetailsDevis ListeDesDevis prospectInstance ListeThematique AddNewDevis ArchiveThematique ListeDesFactures AddNewFacture configure-facture DetailsFacture' %}active{% endif %}">
                        <a class="nav-link menu-link rounded-2 mx-2 mb-1" href="#sidebarConseil" data-bs-toggle="collapse" role="button" 
                        aria-expanded="{% if request.resolver_match.url_name in 'ListeDAS PipelineConseil ConfigurationConseil configure-devis DetailsDevis ListeDesDevis prospectInstance ListeThematique AddNewDevis ArchiveThematique ListeDesFactures AddNewFacture configure-facture DetailsFacture' %}true{% else %}false{% endif %}" 
                        aria-controls="sidebarConseil">
                            <i class='bx bx-briefcase-alt-2 fs-5'></i> <span data-key="t-authentication" class="ms-1">Executive Education</span>
                        </a>
                        <div class="collapse menu-dropdown {% if request.resolver_match.url_name in 'ListeDAS PipelineConseil ConfigurationConseil configure-devis DetailsDevis ListeDesDevis AddNewDevis prospectInstance ListeThematique ArchiveThematique ListeDesFactures AddNewFacture configure-facture DetailsFacture' %}show{% endif %}" id="sidebarConseil">
                            <div class="submenu-container">
                                <div class="row g-1">
                                    <div class="col-12">
                                        <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-2">
                                            <a href="{% url 't_conseil:PipelineConseil' %}" class="nav-link {% if request.resolver_match.url_name == 'PipelineConseil' %}active{% endif %} d-flex align-items-center py-2 px-2 rounded-2">
                                                <i class="bx bx-grid-alt me-2 text-primary"></i>
                                                <span class="fw-bold">Pipeline Dashboard</span>
                                            </a>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <a href="#sidebarThematique" class="submenu-header d-flex align-items-center justify-content-between p-2 rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center">
                                                <div class="submenu-icon bg-primary bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-book-content text-primary"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Produits & Services</h6>
                                                    <small class="text-muted">Catalogue de formations</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1 {% if request.resolver_match.url_name in 'ListeDAS ArchiveThematique ListeThematique ' %}show{% endif %}" id="sidebarThematique">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_conseil:ListeThematique' %}" class="nav-link {% if request.resolver_match.url_name in 'ListeThematique' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-list-ul me-1"></i>
                                                    <span>Catalogue</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_conseil:ListeDAS' %}" class="nav-link {% if request.resolver_match.url_name == 'ListeDAS' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-list-ul me-1"></i>
                                                    <span>Ajouter un DAS</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2">
                                                <a href="{% url 't_conseil:ArchiveThematique' %}" class="nav-link {% if request.resolver_match.url_name in 'ArchiveThematique' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-archive me-1"></i>
                                                    <span>Archives</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-12 mt-2">
                                        <a href="#sidebarGestionClients" class="submenu-header d-flex align-items-center justify-content-between p-2 rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center">
                                                <div class="submenu-icon bg-warning bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-group text-warning"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Gestion des Clients</h6>
                                                    <small class="text-muted">Prospects et clients</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1 {% if request.resolver_match.url_name in 'prospectInstance' %}show{% endif %}" id="sidebarGestionClients">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_conseil:prospectInstance' %}" class="nav-link {% if request.resolver_match.url_name in 'prospectInstance' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-user-plus me-1"></i>
                                                    <span>Prospects</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2">
                                                <a href="#" class="nav-link d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-user-check me-1"></i>
                                                    <span>Clients</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-12 mt-2">
                                        <a href="#sidebarDevis" class="submenu-header d-flex align-items-center justify-content-between p-2 rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center">
                                                <div class="submenu-icon bg-success bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-file text-success"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Devis</h6>
                                                    <small class="text-muted">Gestion commerciale</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1 {% if request.resolver_match.url_name in 'AddNewDevis   ' %}show{% endif %}" id="sidebarDevis">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_conseil:AddNewDevis' %}" class="nav-link {% if request.resolver_match.url_name in 'AddNewDevis' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-plus-circle me-1"></i>
                                                    <span>Nouveau devis</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2">
                                                <a href="{% url 't_conseil:ListeDesDevis' %}" class="nav-link {% if request.resolver_match.url_name in 'ListeDesDevis DetailsDevis configure-devis' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-list-ul me-1"></i>
                                                    <span>Liste des devis</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-12 mt-2">
                                        <a href="#sidebarFacture" class="submenu-header d-flex align-items-center justify-content-between p-2 rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center">
                                                <div class="submenu-icon bg-info bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-receipt text-info"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Factures</h6>
                                                    <small class="text-muted">Gestion de la facturation</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1 {% if request.resolver_match.url_name in 'ListeDesFactures DetailsFacture AddNewFacture configure-facture' %}show{% endif %}" id="sidebarFacture">
                                            {# Nouvelle facture via conversion de devis pour le moment #}
                                            <!-- <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="" class="nav-link {% if request.resolver_match.url_name in ' ' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-plus-circle me-1"></i>
                                                    <span>Nouvelle facture</span>
                                                </a>
                                            </div> -->
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 't_conseil:ListeDesFactures' %}" class="nav-link {% if request.resolver_match.url_name in 'ListeDesFactures DetailsFacture configure-facture' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-list-ul me-1"></i>
                                                    <span>Liste des factures</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2">
                                                <a href="#" class="nav-link d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-list-ul me-1"></i>
                                                    <span>Tous les paiements</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-12 mt-2">
                                        <a href="#sidebarConfigConseil" class="submenu-header d-flex align-items-center justify-content-between p-2 rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center">
                                                <div class="submenu-icon bg-secondary bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-cog text-secondary"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Paramètres</h6>
                                                    <small class="text-muted">Configuration du module</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1 {% if request.resolver_match.url_name == 'ConfigurationConseil' %}show{% endif %}" id="sidebarConfigConseil">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2">
                                                <a href="{% url 't_conseil:ConfigurationConseil' %}" class="nav-link {% if request.resolver_match.url_name == 'ConfigurationConseil' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-slider-alt me-1"></i>
                                                    <span>Configuration globale</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>
                    <!-- Conseil -->
                {% endif %}
                <!-- Entreprise moved to Configuration section -->

                <!-- Administration moved to Configuration section -->
                {% user_can_access 'adm' 'view' as can_view_configuration  %}
                {% if can_view_configuration or request.user.is_superuser %}
                    <!-- Configuration -->
                    <li class="nav-item">
                        <a class="nav-link {% if request.resolver_match.url_name in 'create_template edit_template template_list details_entreprise UsersListePage Role_Attribution ModulesPages roles_page user_action_log_list active_sessions' %}active{% endif %} menu-link rounded-2 mx-2 mb-1" href="#sidebarConfiguration" data-bs-toggle="collapse" role="button"
                        aria-expanded="{% if request.resolver_match.url_name in 'create_template edit_template template_list details_entreprise UsersListePage Role_Attribution ModulesPages roles_page user_action_log_list active_sessions' %}true{% else %}false{% endif %}" aria-controls="sidebarConfiguration">
                            <i class="bx bx-cog fs-5"></i> <span class="ms-1">Configuration</span>
                        </a>
                        <div class="collapse menu-dropdown {% if request.resolver_match.url_name in 'create_template edit_template template_list details_entreprise UsersListePage Role_Attribution ModulesPages roles_page user_action_log_list active_sessions' %}show{% endif %}" id="sidebarConfiguration">
                            <div class="submenu-container">
                                <div class="row g-1">
                                    <div class="col-12">
                                        <a href="#sidebarEntreprise" class="submenu-header d-flex align-items-center justify-content-between p-2 rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center">
                                                <div class="submenu-icon bg-primary bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-building text-primary"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Entités Légales</h6>
                                                    <small class="text-muted">Structures de l'entreprise</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1 {% if request.resolver_match.url_name in 'liste_entreprise new_entreprise details_entreprise' %}show{% endif %}" id="sidebarEntreprise">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 'institut_app:liste_entreprise' %}" class="nav-link {% if request.resolver_match.url_name in 'details_entreprise liste_entreprise' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-list-ul me-1"></i>
                                                    <span>Toutes les entités</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2">
                                                <a href="{% url 'institut_app:new_entreprise' %}" class="nav-link {% if request.resolver_match.url_name == 'new_entreprise' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-plus-circle me-1"></i>
                                                    <span>Nouvelle entité</span>
                                                </a>
                                            </div>
                                        </div>

                                        <a href="#sidebarAdmin" class="submenu-header d-flex align-items-center justify-content-between p-2 mt-2 rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center">
                                                <div class="submenu-icon bg-info bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-cog text-info"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Utilisateur & Permissions</h6>
                                                    <small class="text-muted">Gestion des utilisateurs</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1 {% if request.resolver_match.url_name in 'Role_Attribution ModulesPages PageUpdateUserDetails ListGroupePage UsersListePage user_action_log_list active_sessions' %}show{% endif %}" id="sidebarAdmin">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 'institut_app:UsersListePage' %}" class="nav-link {% if request.resolver_match.url_name in 'PageUpdateUserDetails UsersListePage' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-user me-1"></i>
                                                    <span>Gestion des utilisateurs</span>
                                                </a>
                                            </div>
                                        
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2">
                                                <a href="{% url 'institut_app:ModulesPages' %}" class="nav-link {% if request.resolver_match.url_name == 'ModulesPages' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-cube me-1"></i>
                                                    <span>Modules</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2">
                                                <a href="{% url 'institut_app:roles_page' %}" class="nav-link {% if request.resolver_match.url_name == 'roles_page' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-cube me-1"></i>
                                                    <span>Rôles</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2">
                                                <a href="{% url 'institut_app:Role_Attribution' %}" class="nav-link {% if request.resolver_match.url_name == 'Role_Attribution' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-user-check me-1"></i>
                                                    <span>Attribution des rôles</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2">
                                                <a href="{% url 't_crm:user_action_log_list' %}" class="nav-link {% if request.resolver_match.url_name == 'user_action_log_list' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-history me-1"></i>
                                                    <span>Journal d'actions</span>
                                                </a>
                                            </div>
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2">
                                                <a href="{% url 'institut_app:active_sessions' %}" class="nav-link {% if request.resolver_match.url_name == 'active_sessions' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="ri-shield-user-line me-1"></i>
                                                    <span>Sessions actives</span>
                                                </a>
                                            </div>
                                        </div>

                                        <a href="#sidebarEditeur" class="submenu-header d-flex align-items-center justify-content-between p-2 mt-2 rounded-2" data-bs-toggle="collapse">
                                            <div class="d-flex align-items-center">
                                                <div class="submenu-icon bg-info bg-opacity-10 rounded-circle p-1 me-2">
                                                    <i class="bx bx-cog text-info"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-0 fw-semibold">Edition des documents</h6>
                                                    <small class="text-muted">Templates & Autres</small>
                                                </div>
                                            </div>
                                            <i class="bx bx-chevron-down submenu-arrow"></i>
                                        </a>
                                        <div class="collapse submenu-content mt-1 {% if request.resolver_match.url_name in 'Role_Attribution ModulesPages PageUpdateUserDetails ListGroupePage UsersListePage' %}show{% endif %}" id="sidebarEditeur">
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2 mb-1">
                                                <a href="{% url 'pdf_editor:template-list' %}" target="_blank" class="nav-link {% if request.resolver_match.url_name in 'template_list edit_template' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-user me-1"></i>
                                                    <span>Templates</span>
                                                </a>
                                            </div>
                                        
                                            <div class="submenu-item bg-light bg-opacity-50 rounded-2">
                                                <a href="#" class="nav-link {% if request.resolver_match.url_name == 'create_template' %}active{% endif %} d-flex align-items-center py-1 px-2 rounded-2">
                                                    <i class="bx bx-cube me-1"></i>
                                                    <span>Nouveau template</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>
                    <!-- Configuration -->
                {% endif %}
            </ul>
        </div>
        <!-- Sidebar -->
    </div>

    <div class="sidebar-background"></div>
</div>

<script>
// JavaScript to maintain active state in menu and handle submenu expansion
document.addEventListener('DOMContentLoaded', function() {
    // Get all nav-links in the menu that are not collapse toggles
    const navLinks = document.querySelectorAll('.navbar-nav .nav-link:not([data-bs-toggle])');
    
    // Add click event to each nav link to ensure active state
    navLinks.forEach(function(link) {
        link.addEventListener('click', function(e) {
            // Only handle actual navigation links, not collapse toggles
            if (!this.href || this.href.startsWith('#')) {
                return;
            }
            
            // Wait for the page to load with the new URL, then update active states based on server-side Django logic
            // The Django template will set the correct active classes on page load
        });
    });
    
    // Handle collapse events to maintain active states
    document.querySelectorAll('.navbar-nav [data-bs-toggle="collapse"]').forEach(function(collapseEl) {
        collapseEl.addEventListener('click', function() {
            // Remove active from siblings
            const siblings = Array.from(this.closest('ul').children);
            siblings.forEach(function(sibling) {
                if (sibling !== this.closest('li')) {
                    sibling.classList.remove('active');
                }
            }, this);
        });
    });
    
    // Additional JavaScript to ensure parent menus stay expanded when child items are active
    document.querySelectorAll('.navbar-nav .nav-link.active').forEach(function(activeLink) {
        // Find parent submenu and ensure it's shown
        const submenuItem = activeLink.closest('.submenu-content');
        if (submenuItem) {
            submenuItem.classList.add('show');
            // Also ensure parent collapse sections are shown
            const parentCollapse = submenuItem.closest('.collapse');
            if (parentCollapse) {
                parentCollapse.classList.add('show');
                // Add active to parent nav-item
                const parentNavItem = parentCollapse.parentElement.closest('.nav-item');
                if (parentNavItem) {
                    parentNavItem.classList.add('active');
                }
            }
        }
    });
});
</script>

<script>
// Auto-add tooltip to truncated elements
document.addEventListener('DOMContentLoaded', function() {
    function addTooltips() {
        const textElements = document.querySelectorAll('.app-menu .nav-link span, .app-menu .submenu-header h6, .app-menu .submenu-header small');
        textElements.forEach(el => {
            if (el.offsetWidth < el.scrollWidth) {
                el.setAttribute('title', el.textContent.trim());
            } else {
                el.removeAttribute('title');
            }
        });
    }
    
    // Run on load and resize
    addTooltips();
    window.addEventListener('resize', addTooltips);
    
    // Run when sidebar toggles (if applicable)
    const toggles = document.querySelectorAll('[data-bs-toggle="collapse"]');
    toggles.forEach(t => t.addEventListener('shown.bs.collapse', addTooltips));
});
</script>