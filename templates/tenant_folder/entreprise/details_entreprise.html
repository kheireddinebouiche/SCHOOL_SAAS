{% extends "tenant_folder/base.html" %}

{% load static %}

{% block title %}Détails de l'entreprise{% endblock title %}

{% block content %}

<div class="main-content">
    <div class="page-content">
        <div class="container-fluid">                                                    

            <!-- start page title -->
            <div class="row mb-3">
                <div class="col-12">
                    <div class="d-sm-flex align-items-center justify-content-between bg-white rounded-lg shadow-sm p-3">
                        <div class="d-flex align-items-center">
                            <div class="bg-primary bg-opacity-10 rounded-circle p-2 me-2">
                                <i class="ri-building-line text-primary"></i>
                            </div>
                            <h4 class="mb-0 text-primary">Détails de l'entreprise</h4>
                        </div>
                        <div class="d-flex align-items-center gap-3">
                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb m-0 bg-transparent">
                                    <li class="breadcrumb-item">
                                        <a href="javascript: void(0);">Entreprise</a>
                                    </li>
                                    <li class="breadcrumb-item active">Détails de l'entreprise</li>
                                </ol>
                            </nav>
                            <div class="btn-group">
                              
                                <button type="button" class="btn btn-primary px-4 py-2" id="updateEntrepriseDetailsBtn">
                                    <i class="ri-edit-line me-2"></i>Modifier
                                </button>
                                <a href="/entreprise/liste-des-entreprises/" class="btn btn-light px-4 py-2">
                                    <i class="ri-arrow-left-line me-2"></i>Retour à la liste
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- end page title -->

            <!-- Statistiques -->
            <div class="row mb-4">
                <div class="col-lg-12">
                    <div class="card border-0 shadow-sm rounded-4 h-100">
                        <div class="card-header border-0 bg-success bg-opacity-10 px-4 py-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="d-flex align-items-center">
                                    <div class="modal-icon bg-success bg-opacity-10 rounded-3 p-3 me-3">
                                        <i class="ri-bar-chart-line text-success fs-4"></i>
                                    </div>
                                    <div>
                                        <h5 class="card-title fw-semibold text-success mb-1">Statistiques</h5>
                                        <p class="text-muted small mb-0">Aperçu des performances de l'entreprise</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-body p-4">
                            <div class="row g-3">
                                <!-- Ressources humaines -->
                                <div class="col-md-4">
                                    <div class="d-flex align-items-center bg-light rounded-3 p-3 border-start border-4 border-primary">
                                        <div class="flex-shrink-0 me-3">
                                            <div class="avatar-sm">
                                                <div class="avatar-title bg-primary bg-opacity-10 text-primary rounded-circle fs-5">
                                                    <i class="ri-group-line"></i>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="mb-1 text-primary">Employés</h6>
                                            <h4 class="mb-0 fw-bold" id="nb_employes">0</h4>
                                            <small class="text-muted">Ressources humaines</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-4">
                                    <div class="d-flex align-items-center bg-light rounded-3 p-3 border-start border-4 border-info">
                                        <div class="flex-shrink-0 me-3">
                                            <div class="avatar-sm">
                                                <div class="avatar-title bg-info bg-opacity-10 text-info rounded-circle fs-5">
                                                    <i class="ri-building-2-line"></i>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="mb-1 text-info">Départements</h6>
                                            <h4 class="mb-0 fw-bold" id="nb_departements">0</h4>
                                            <small class="text-muted">Structure organisationnelle</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Éducation -->
                                <div class="col-md-4">
                                    <div class="d-flex align-items-center bg-light rounded-3 p-3 border-start border-4 border-success">
                                        <div class="flex-shrink-0 me-3">
                                            <div class="avatar-sm">
                                                <div class="avatar-title bg-success bg-opacity-10 text-success rounded-circle fs-5">
                                                    <i class="ri-user-star-line"></i>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="mb-1 text-success">Étudiants</h6>
                                            <h4 class="mb-0 fw-bold" id="nb_etudiants">0</h4>
                                            <small class="text-muted">Population étudiante</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Finances -->
                                <div class="col-md-4">
                                    <div class="d-flex align-items-center bg-light rounded-3 p-3 border-start border-4 border-warning">
                                        <div class="flex-shrink-0 me-3">
                                            <div class="avatar-sm">
                                                <div class="avatar-title bg-warning bg-opacity-10 text-warning rounded-circle fs-5">
                                                    <i class="ri-money-euro-circle-line"></i>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="mb-1 text-warning">CA Annuel</h6>
                                            <h4 class="mb-0 fw-bold" id="ca_annuel">€0</h4>
                                            <small class="text-muted">Revenus annuels</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-4">
                                    <div class="d-flex align-items-center bg-light rounded-3 p-3 border-start border-4 border-danger">
                                        <div class="flex-shrink-0 me-3">
                                            <div class="avatar-sm">
                                                <div class="avatar-title bg-danger bg-opacity-10 text-danger rounded-circle fs-5">
                                                    <i class="ri-file-list-2-line"></i>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="mb-1 text-danger">Contrats</h6>
                                            <h4 class="mb-0 fw-bold" id="nb_contrats">0</h4>
                                            <small class="text-muted">Accords en cours</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Temps -->
                                <div class="col-md-4">
                                    <div class="d-flex align-items-center bg-light rounded-3 p-3 border-start border-4 border-secondary">
                                        <div class="flex-shrink-0 me-3">
                                            <div class="avatar-sm">
                                                <div class="avatar-title bg-secondary bg-opacity-10 text-secondary rounded-circle fs-5">
                                                    <i class="ri-calendar-check-line"></i>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="mb-1 text-secondary">Depuis</h6>
                                            <h4 class="mb-0 fw-bold" id="date_creation">-</h4>
                                            <small class="text-muted">Date de création</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Fin Statistiques -->

            <!-- Première rangée : Informations de l'entreprise -->
            <div class="row mb-4">
                <!-- Informations principales -->
                <div class="col-lg-12">
                    <div class="card border-0 shadow-sm rounded-4 h-100">
                        <div class="card-header border-0 bg-primary bg-opacity-10 px-4 py-3">
                            <div class="d-flex align-items-center">
                                <div class="modal-icon bg-primary bg-opacity-10 rounded-3 p-3 me-3">
                                    <i class="ri-building-line text-primary fs-4"></i>
                                </div>
                                <div>
                                    <h5 class="card-title fw-semibold text-primary mb-1">Informations de l'entreprise</h5>
                                    <p class="text-muted small mb-0">Détails de l'entreprise</p>
                                </div>
                            </div>
                        </div>
                        <div class="card-body p-4">
                            <div class="mb-4 d-flex align-items-start">
                                <div class="icon-circle bg-primary bg-opacity-10 rounded-circle p-2 me-3">
                                    <i class="ri-building-line text-primary"></i>
                                </div>
                                <div>
                                    <small class="text-muted d-block mb-1">Désignation</small>
                                    <span class="fw-semibold" id="designation_entreprise">-</span>
                                </div>
                            </div>
                            <div class="mb-4 d-flex align-items-start">
                                <div class="icon-circle bg-secondary bg-opacity-10 rounded-circle p-2 me-3">
                                    <i class="ri-map-pin-line text-secondary"></i>
                                </div>
                                <div>
                                    <small class="text-muted d-block mb-1">Adresse</small>
                                    <span class="fw-semibold" id="adresse_entreprise">-</span>
                                </div>
                            </div>
                            <div class="mb-4 d-flex align-items-start">
                                <div class="icon-circle bg-info bg-opacity-10 rounded-circle p-2 me-3">
                                    <i class="ri-mail-line text-info"></i>
                                </div>
                                <div>
                                    <small class="text-muted d-block mb-1">Email</small>
                                    <span class="fw-semibold" id="email_entreprise">-</span>
                                </div>
                            </div>
                            <div class="mb-4 d-flex align-items-start">
                                <div class="icon-circle bg-success bg-opacity-10 rounded-circle p-2 me-3">
                                    <i class="ri-phone-line text-success"></i>
                                </div>
                                <div>
                                    <small class="text-muted d-block mb-1">Téléphone</small>
                                    <span class="fw-semibold" id="telephone_entreprise">-</span>
                                </div>
                            </div>
                            <div class="d-flex align-items-start">
                                <div class="icon-circle bg-warning bg-opacity-10 rounded-circle p-2 me-3">
                                    <i class="ri-global-line text-warning"></i>
                                </div>
                                <div>
                                    <small class="text-muted d-block mb-1">Site web</small>
                                    <span class="fw-semibold" id="site_web_entreprise">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Deuxième rangée : Informations de facturation et Comptes bancaires -->
            <div class="row mb-4">
                <!-- Informations de facturation -->
              <div class="col-lg-6">
                    <div class="card border-0 shadow-sm rounded-4 h-100">
                        <div class="card-header border-0 bg-info bg-opacity-10 px-4 py-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="d-flex align-items-center">
                                    <div class="modal-icon bg-info bg-opacity-10 rounded-3 p-3 me-3">
                                        <i class="ri-file-text-line text-info fs-4"></i>
                                    </div>
                                    <div>
                                        <h5 class="card-title fw-semibold text-info mb-1">Informations de facturation</h5>
                                        <p class="text-muted small mb-0">Détails fiscaux</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-body p-4">
                            <div class="mb-4 d-flex align-items-start">
                                <div class="icon-circle bg-primary bg-opacity-10 rounded-circle p-2 me-3">
                                    <i class="ri-file-line text-primary"></i>
                                </div>
                                <div>
                                    <small class="text-muted d-block mb-1">Registre de commerce</small>
                                    <span class="fw-semibold" id="rc_entreprise">-</span>
                                </div>
                            </div>
                            <div class="mb-4 d-flex align-items-start">
                                <div class="icon-circle bg-secondary bg-opacity-10 rounded-circle p-2 me-3">
                                    <i class="ri-file-line text-secondary"></i>
                                </div>
                                <div>
                                    <small class="text-muted d-block mb-1">Article</small>
                                    <span class="fw-semibold" id="art_entreprise">-</span>
                                </div>
                            </div>
                            <div class="mb-4 d-flex align-items-start">
                                <div class="icon-circle bg-info bg-opacity-10 rounded-circle p-2 me-3">
                                    <i class="ri-file-line text-info"></i>
                                </div>
                                <div>
                                    <small class="text-muted d-block mb-1">NIF</small>
                                    <span class="fw-semibold" id="nif_entreprise">-</span>
                                </div>
                            </div>
                            <div class="d-flex align-items-start">
                                <div class="icon-circle bg-success bg-opacity-10 rounded-circle p-2 me-3">
                                    <i class="ri-file-line text-success"></i>
                                </div>
                                <div>
                                    <small class="text-muted d-block mb-1">NIS</small>
                                    <span class="fw-semibold" id="nis_entreprise">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Comptes bancaires -->
                <div class="col-lg-6">
                    <div class="card border-0 shadow-sm rounded-4 h-100">
                        <div class="card-header border-0 bg-warning bg-opacity-10 px-4 py-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="d-flex align-items-center">
                                    <div class="modal-icon bg-warning bg-opacity-10 rounded-3 p-3 me-3">
                                        <i class="ri-bank-line text-warning fs-4"></i>
                                    </div>
                                    <div>
                                        <h5 class="card-title fw-semibold text-warning mb-1">Comptes bancaires</h5>
                                        <p class="text-muted small mb-0">Gestion des comptes bancaires</p>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-warning btn-sm" id="addBankAccountBtn">
                                    <i class="ri-add-line me-1"></i>Ajouter
                                </button>
                            </div>
                        </div>
                        <div class="card-body p-4">
                            <div class="table-responsive">
                                <table class="table table-hover align-middle mb-0">
                                    <thead class="bg-light">
                                        <tr>
                                            <th class="border-0 rounded-start">Banque</th>
                                            <th class="border-0">IBAN</th>
                                            <th class="border-0">Devise</th>
                                            <th class="border-0 rounded-end text-end">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="bankAccountsList">
                                        <!-- Comptes bancaires seront chargés ici -->
                                        <tr>
                                            <td colspan="4" class="text-center text-muted py-3">
                                                <i class="ri-bank-line fs-3 d-block mb-2"></i>
                                                Aucun compte bancaire enregistré
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            

            <!-- Quatrième rangée : Historique des interactions -->
            <div class="row">
                <div class="col-12">
                    <div class="card border-0 shadow-sm rounded-4 w-100">
                        <div class="card-header border-0 bg-success bg-opacity-10 px-4 py-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="d-flex align-items-center">
                                    <div class="modal-icon bg-success bg-opacity-10 rounded-3 p-3 me-3">
                                        <i class="ri-history-line text-success fs-4"></i>
                                    </div>
                                    <div>
                                        <h5 class="card-title fw-semibold text-success mb-1">Historique des interactions</h5>
                                        <p class="text-muted small mb-0">Suivi des communications</p>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-success px-4 py-2" id="addInteractionBtn">
                                    <i class="ri-add-line me-2"></i>Nouvelle interaction
                                </button>
                            </div>
                        </div>
                        <div class="card-body p-4">
                            <div class="table-responsive">
                                <table class="table table-hover align-middle">
                                    <thead class="bg-light">
                                        <tr>
                                            <th class="border-0 rounded-start">Date</th>
                                            <th class="border-0">Type</th>
                                            <th class="border-0">Sujet</th>
                                            <th class="border-0">Responsable</th>
                                            <th class="border-0 rounded-end text-end">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="historiqueInteractions">
                                        <!-- Historique des interactions -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Ajout de compte bancaire -->
            <div class="modal fade" id="addBankAccountModal" tabindex="-1" aria-labelledby="addBankAccountModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content rounded-4 shadow-lg border-0">
                        <div class="modal-header border-0 bg-warning bg-opacity-10 px-4 py-3">
                            <div class="d-flex align-items-center">
                                <div class="modal-icon bg-warning bg-opacity-10 rounded-3 p-3 me-3">
                                    <i class="ri-bank-line text-warning fs-4"></i>
                                </div>
                                <div>
                                    <h5 class="modal-title fw-semibold text-warning mb-1" id="addBankAccountModalLabel">
                                        Nouveau compte bancaire
                                    </h5>
                                    <p class="text-muted small mb-0">Ajouter un compte bancaire</p>
                                </div>
                            </div>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body p-4">
                            <div class="row g-3">
                                <div class="col-12">
                                    <label class="form-label fw-medium">Nom de la banque</label>
                                    <input type="text" class="form-control border-0 bg-light py-2" id="bank_name" placeholder="Nom de la banque">
                                </div>
                                <div class="col-12">
                                    <label class="form-label fw-medium">IBAN</label>
                                    <input type="text" class="form-control border-0 bg-light py-2" id="bank_iban" placeholder="Numéro IBAN">
                                </div>
                                <div class="col-12">
                                    <label class="form-label fw-medium">Devise</label>
                                    <select class="form-select border-0 bg-light py-2" id="bank_currency">
                                        <option value="EUR">Euro (€)</option>
                                        <option value="USD">Dollar ($)</option>
                                        <option value="DZD">Dinar algérien (DA)</option>
                                        <!-- Ajouter d'autres devises selon les besoins -->
                                    </select>
                                </div>
                                <div class="col-12">
                                    <label class="form-label fw-medium">Observations</label>
                                    <textarea class="form-control border-0 bg-light" id="bank_observations" rows="3" placeholder="Informations supplémentaires..."></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer border-0 bg-light px-4 py-3">
                            <button type="button" class="btn btn-light px-4 py-2" data-bs-dismiss="modal">
                                <i class="ri-close-line me-2"></i>Annuler
                            </button>
                            <button type="button" class="btn btn-warning px-4 py-2" id="saveBankAccountBtn">
                                <i class="ri-save-line me-2"></i>Enregistrer
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Édition de compte bancaire -->
            <div class="modal fade" id="editBankAccountModal" tabindex="-1" aria-labelledby="editBankAccountModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content rounded-4 shadow-lg border-0">
                        <div class="modal-header border-0 bg-warning bg-opacity-10 px-4 py-3">
                            <div class="d-flex align-items-center">
                                <div class="modal-icon bg-warning bg-opacity-10 rounded-3 p-3 me-3">
                                    <i class="ri-bank-line text-warning fs-4"></i>
                                </div>
                                <div>
                                    <h5 class="modal-title fw-semibold text-warning mb-1" id="editBankAccountModalLabel">
                                        Éditer le compte bancaire
                                    </h5>
                                    <p class="text-muted small mb-0">Modifier un compte bancaire</p>
                                </div>
                            </div>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body p-4">
                            <input type="hidden" id="edit_bank_account_id">
                            <div class="row g-3">
                                <div class="col-12">
                                    <label class="form-label fw-medium">Nom de la banque</label>
                                    <input type="text" class="form-control border-0 bg-light py-2" id="edit_bank_name" placeholder="Nom de la banque">
                                </div>
                                <div class="col-12">
                                    <label class="form-label fw-medium">IBAN</label>
                                    <input type="text" class="form-control border-0 bg-light py-2" id="edit_bank_iban" placeholder="Numéro IBAN">
                                </div>
                                <div class="col-12">
                                    <label class="form-label fw-medium">Devise</label>
                                    <select class="form-select border-0 bg-light py-2" id="edit_bank_currency">
                                        <option value="EUR">Euro (€)</option>
                                        <option value="USD">Dollar ($)</option>
                                        <option value="DZD">Dinar algérien (DA)</option>
                                        <!-- Ajouter d'autres devises selon les besoins -->
                                    </select>
                                </div>
                                <div class="col-12">
                                    <label class="form-label fw-medium">Observations</label>
                                    <textarea class="form-control border-0 bg-light" id="edit_bank_observations" rows="3" placeholder="Informations supplémentaires..."></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer border-0 bg-light px-4 py-3">
                            <button type="button" class="btn btn-light px-4 py-2" data-bs-dismiss="modal">
                                <i class="ri-close-line me-2"></i>Annuler
                            </button>
                            <button type="button" class="btn btn-warning px-4 py-2" id="updateBankAccountBtn">
                                <i class="ri-save-line me-2"></i>Mettre à jour
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal de validation de l'entreprise -->
            <div class="modal fade" id="validateEntrepriseModal" tabindex="-1" aria-labelledby="validateEntrepriseModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content rounded-4 shadow-lg border-0">
                        <div class="modal-header border-0 bg-success bg-opacity-10 px-4 py-3">
                            <div class="d-flex align-items-center">
                                <div class="modal-icon bg-success bg-opacity-10 rounded-3 p-3 me-3">
                                    <i class="ri-check-double-line text-success fs-4"></i>
                                </div>
                                <div>
                                    <h5 class="modal-title fw-semibold text-success mb-1" id="validateEntrepriseModalLabel">
                                        Validation de l'entreprise
                                    </h5>
                                    <p class="text-muted small mb-0">Confirmation de la validation de l'entreprise</p>
                                </div>
                            </div>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body p-4">
                            <div class="text-center mb-4">
                                <div class="avatar-lg mx-auto mb-3">
                                    <div class="avatar-title bg-success bg-opacity-10 text-success display-5 rounded-circle">
                                        <i class="ri-building-line"></i>
                                    </div>
                                </div>
                                <h5 class="mb-3">Êtes-vous sûr de vouloir valider cette entreprise ?</h5>
                                <p class="text-muted mb-0">
                                    La validation de l'entreprise permettra de commencer le processus de collaboration.
                                </p>
                            </div>
                            <div class="row g-3">
                                <div class="col-12">
                                    <label class="form-label fw-medium">Commentaire de validation (optionnel)</label>
                                    <textarea class="form-control border-0 bg-light" rows="3" placeholder="Ajoutez un commentaire..."></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer border-0 bg-light px-4 py-3">
                            <button type="button" class="btn btn-light px-4 py-2" data-bs-dismiss="modal">
                                <i class="ri-close-line me-2"></i>Annuler
                            </button>
                            <button type="button" id="confirmeValidationBtn" class="btn btn-success px-4 py-2">
                                <i class="ri-check-line me-2"></i>Valider l'entreprise
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal de modification de l'entreprise -->
            <div class="modal fade" id="editEntrepriseModal" tabindex="-1" aria-labelledby="editEntrepriseModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-xl">
                    <div class="modal-content rounded-4 shadow-lg border-0">
                        <div class="modal-header border-0 bg-primary bg-opacity-10 px-4 py-3">
                            <div class="d-flex align-items-center">
                                <div class="modal-icon bg-primary bg-opacity-10 rounded-3 p-3 me-3">
                                    <i class="ri-edit-line text-primary fs-4"></i>
                                </div>
                                <div>
                                    <h5 class="modal-title fw-semibold text-primary mb-1" id="editEntrepriseModalLabel">
                                        Modifier les informations
                                    </h5>
                                    <p class="text-muted small mb-0">Modification des informations de l'entreprise</p>
                                </div>
                            </div>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body p-4">
                            <div class="text-center mb-4">
                                <div class="avatar-lg mx-auto mb-3">
                                    <div class="avatar-title bg-primary bg-opacity-10 text-primary display-5 rounded-circle">
                                        <i class="ri-building-line"></i>
                                    </div>
                                </div>
                                <h4 class="text-primary mb-3">Modification de l'entreprise</h4>
                                <p class="text-muted mb-4">
                                    Veuillez remplir les informations ci-dessous pour mettre à jour les détails de l'entreprise.
                                </p>
                            </div>
                            <div class="row g-3">
                                <div class="col-12">
                                    <h5 class="text-primary mb-3">Informations générales</h5>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="form-label fw-medium">Désignation</label>
                                        <div class="input-group">
                                            <span class="input-group-text border-0 bg-light">
                                                <i class="ri-building-line text-muted"></i>
                                            </span>
                                            <input type="text" class="form-control border-0 bg-light py-2" id="edit_designation" placeholder="Dénomination de l'entreprise">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="form-label fw-medium">Adresse</label>
                                        <div class="input-group">
                                            <span class="input-group-text border-0 bg-light">
                                                <i class="ri-map-pin-line text-muted"></i>
                                            </span>
                                            <input type="text" class="form-control border-0 bg-light py-2" id="edit_adresse" placeholder="Adresse complète">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label fw-medium">Wilaya</label>
                                        <div class="input-group">
                                            <span class="input-group-text border-0 bg-light">
                                                <i class="ri-map-pin-line text-muted"></i>
                                            </span>
                                            <input type="text" class="form-control border-0 bg-light py-2" id="edit_wilaya" placeholder="Wilaya">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label fw-medium">Pays</label>
                                        <div class="input-group">
                                            <span class="input-group-text border-0 bg-light">
                                                <i class="ri-global-line text-muted"></i>
                                            </span>
                                            <input type="text" class="form-control border-0 bg-light py-2" id="edit_pays" placeholder="Pays">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label fw-medium">Code Postal</label>
                                        <div class="input-group">
                                            <span class="input-group-text border-0 bg-light">
                                                <i class="ri-mail-line text-muted"></i>
                                            </span>
                                            <input type="text" class="form-control border-0 bg-light py-2" id="edit_code_postal" placeholder="Code postal">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label fw-medium">Email</label>
                                        <div class="input-group">
                                            <span class="input-group-text border-0 bg-light">
                                                <i class="ri-mail-line text-muted"></i>
                                            </span>
                                            <input type="email" class="form-control border-0 bg-light py-2" id="edit_email" placeholder="Email">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label fw-medium">Téléphone</label>
                                        <div class="input-group">
                                            <span class="input-group-text border-0 bg-light">
                                                <i class="ri-phone-line text-muted"></i>
                                            </span>
                                            <input type="tel" class="form-control border-0 bg-light py-2" id="edit_telephone" placeholder="Téléphone">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="form-label fw-medium">Site web</label>
                                        <div class="input-group">
                                            <span class="input-group-text border-0 bg-light">
                                                <i class="ri-global-line text-muted"></i>
                                            </span>
                                            <input type="url" class="form-control border-0 bg-light py-2" id="edit_site_web" placeholder="Site web">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 mt-4">
                                    <h5 class="text-info mb-3">Informations de facturation</h5>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="form-label fw-medium">RC</label>
                                        <div class="input-group">
                                            <span class="input-group-text border-0 bg-light">
                                                <i class="ri-file-text-line text-muted"></i>
                                            </span>
                                            <input type="text" class="form-control border-0 bg-light py-2" id="edit_rc" placeholder="Registre de commerce">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="form-label fw-medium">Article</label>
                                        <div class="input-group">
                                            <span class="input-group-text border-0 bg-light">
                                                <i class="ri-file-text-line text-muted"></i>
                                            </span>
                                            <input type="text" class="form-control border-0 bg-light py-2" id="edit_art" placeholder="Article">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="form-label fw-medium">NIF</label>
                                        <div class="input-group">
                                            <span class="input-group-text border-0 bg-light">
                                                <i class="ri-file-text-line text-muted"></i>
                                            </span>
                                            <input type="text" class="form-control border-0 bg-light py-2" id="edit_nif" placeholder="Numéro d'identification fiscal">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="form-label fw-medium">NIS</label>
                                        <div class="input-group">
                                            <span class="input-group-text border-0 bg-light">
                                                <i class="ri-file-text-line text-muted"></i>
                                            </span>
                                            <input type="text" class="form-control border-0 bg-light py-2" id="edit_nis" placeholder="Numéro d'identification statistique">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer border-0 bg-light px-4 py-3">
                            <div class="hstack gap-2 justify-content-center w-100">
                                <button type="button" class="btn btn-light px-4 py-2 w-100" data-bs-dismiss="modal">
                                    <i class="ri-close-line me-2"></i>Annuler
                                </button>
                                <button type="button" id="validateUpdateEntrepriseDetailsBtn" class="btn btn-primary px-4 py-2 w-100">
                                    <i class="ri-save-line me-2"></i>Enregistrer
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Ajout de contact -->
            <div class="modal fade" id="addContactModal" tabindex="-1" aria-labelledby="addContactModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content rounded-4 shadow-lg border-0">
                        <div class="modal-header border-0 bg-warning bg-opacity-10 px-4 py-3">
                            <div class="d-flex align-items-center">
                                <div class="modal-icon bg-warning bg-opacity-10 rounded-3 p-3 me-3">
                                    <i class="ri-user-add-line text-warning fs-4"></i>
                                </div>
                                <div>
                                    <h5 class="modal-title fw-semibold text-warning mb-1" id="addContactModalLabel">
                                        Nouveau contact
                                    </h5>
                                    <p class="text-muted small mb-0">Ajouter un contact principal</p>
                                </div>
                            </div>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body p-4">
                            <div class="row g-3">
                                <div class="col-12">
                                    <label class="form-label fw-medium">Nom</label>
                                    <input type="text" class="form-control border-0 bg-light py-2" placeholder="Nom du contact">
                                </div>
                                <div class="col-12">
                                    <label class="form-label fw-medium">Prénom</label>
                                    <input type="text" class="form-control border-0 bg-light py-2" placeholder="Prénom du contact">
                                </div>
                                <div class="col-12">
                                    <label class="form-label fw-medium">Fonction</label>
                                    <input type="text" class="form-control border-0 bg-light py-2" placeholder="Fonction du contact">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-medium">Email</label>
                                    <input type="email" class="form-control border-0 bg-light py-2" placeholder="Email du contact">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-medium">Téléphone</label>
                                    <input type="tel" class="form-control border-0 bg-light py-2" placeholder="Téléphone du contact">
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer border-0 bg-light px-4 py-3">
                            <button type="button" class="btn btn-light px-4 py-2" data-bs-dismiss="modal">
                                <i class="ri-close-line me-2"></i>Annuler
                            </button>
                            <button type="button" class="btn btn-warning px-4 py-2" id="saveContactBtn">
                                <i class="ri-save-line me-2"></i>Enregistrer
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Ajout d'interaction -->
            <div class="modal fade" id="addInteractionModal" tabindex="-1" aria-labelledby="addInteractionModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content rounded-4 shadow-lg border-0">
                        <div class="modal-header border-0 bg-success bg-opacity-10 px-4 py-3">
                            <div class="d-flex align-items-center">
                                <div class="modal-icon bg-success bg-opacity-10 rounded-3 p-3 me-3">
                                    <i class="ri-chat-new-line text-success fs-4"></i>
                                </div>
                                <div>
                                    <h5 class="modal-title fw-semibold text-success mb-1" id="addInteractionModalLabel">
                                        Nouvelle interaction
                                    </h5>
                                    <p class="text-muted small mb-0">Enregistrer une interaction</p>
                                </div>
                            </div>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body p-4">
                            <div class="row g-3">
                                <div class="col-12">
                                    <label class="form-label fw-medium">Type d'interaction</label>
                                    <select class="form-select border-0 bg-light py-2">
                                        <option value="appel">Appel téléphonique</option>
                                        <option value="email">Email</option>
                                        <option value="rendez_vous">Rendez-vous</option>
                                        <option value="visite">Visite sur site</option>
                                    </select>
                                </div>
                                <div class="col-12">
                                    <label class="form-label fw-medium">Sujet</label>
                                    <input type="text" class="form-control border-0 bg-light py-2" placeholder="Sujet de l'interaction">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-medium">Date</label>
                                    <input type="date" class="form-control border-0 bg-light py-2">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-medium">Heure</label>
                                    <input type="time" class="form-control border-0 bg-light py-2">
                                </div>
                                <div class="col-12">
                                    <label class="form-label fw-medium">Description</label>
                                    <textarea class="form-control border-0 bg-light" rows="3" placeholder="Description de l'interaction..."></textarea>
                                </div>
                                <div class="col-12">
                                    <label class="form-label fw-medium">Responsable</label>
                                    <select class="form-select border-0 bg-light py-2">
                                        <option value="">Sélectionner un responsable</option>
                                        <!-- Options à charger dynamiquement -->
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer border-0 bg-light px-4 py-3">
                            <button type="button" class="btn btn-light px-4 py-2" data-bs-dismiss="modal">
                                <i class="ri-close-line me-2"></i>Annuler
                            </button>
                            <button type="button" class="btn btn-success px-4 py-2" id="saveInteractionBtn">
                                <i class="ri-save-line me-2"></i>Enregistrer
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- container-fluid -->
    </div>
    <!-- End Page-content -->
</div>

<script>
    $(document).ready(function(){
        let id  = "{{ pk }}";
       

        function loadEntrepriseData(){
            $.ajax({
                url : "{% url 'institut_app:ApiLoadEntrepriseData' %}",
                dataType: "JSON",
                type : 'GET',
                data:{'id_entreprise' : id},
                success: function(data){
                    // Mise à jour des champs avec les données de l'entreprise
                    $('#designation_entreprise').text(data.designation || '-');
                    $('#adresse_entreprise').text(data.adresse || '-');
                    $('#email_entreprise').text(data.email || '-');
                    $('#telephone_entreprise').text(data.telephone || '-');
                    $('#site_web_entreprise').text(data.site_web || '-');
                    $('#rc_entreprise').text(data.rc || '-');
                    $('#art_entreprise').text(data.art || '-');
                    $('#nif_entreprise').text(data.nif || '-');
                    $('#nis_entreprise').text(data.nis || '-');
                    $('#nb_etudiants').text(data.nb_etudiants || '0');
                    $('#nb_employes').text(data.nb_employes || '0');
                    $('#nb_departements').text(data.nb_departements || '0');
                    $('#ca_annuel').text('€' + (data.ca_annuel || '0'));
                    $('#nb_contrats').text(data.nb_contrats || '0');
                    $('#date_creation').text(data.date_creation || '-');
                    
                    // Mise à jour des champs du formulaire d'édition
                    $('#edit_designation').val(data.designation || '');
                    $('#edit_adresse').val(data.adresse || '');
                    $('#edit_wilaya').val(data.wilaya || '');
                    $('#edit_pays').val(data.pays || '');
                    $('#edit_code_postal').val(data.code_postal || '');
                    $('#edit_email').val(data.email || '');
                    $('#edit_telephone').val(data.telephone || '');
                    $('#edit_site_web').val(data.site_web || '');
                    $('#edit_rc').val(data.rc || '');
                    $('#edit_art').val(data.art || '');
                    $('#edit_nif').val(data.nif || '');
                    $('#edit_nis').val(data.nis || '');
                    $('#edit_banque').val(data.banque || '');
                    $('#edit_iban').val(data.iban || '');
                    $('#edit_observations').val(data.observations || '');
                }
            });
        }

        // Chargement des contacts
        function loadContacts(){
            $.ajax({
                url : "#",
                dataType: "JSON",
                type : 'GET',
                data:{'id_entreprise' : id},
                success: function(data){
                    var html = "";
                    if (data.length > 0){
                        $.each(data, function(index, item){
                            html += '<tr>';
                            html += '<td>'+item.nom+' '+item.prenom+'</td>';
                            html += '<td>'+item.fonction+'</td>';
                            html += '<td class="text-end">';
                            html += '<div class="d-flex justify-content-end gap-2">';
                            html += '<button class="btn btn-soft-primary btn-sm" title="Modifier">';
                            html += '<i class="ri-edit-line"></i>';
                            html += '</button>';
                            html += '<button class="btn btn-soft-danger btn-sm" title="Supprimer">';
                            html += '<i class="ri-delete-bin-line"></i>';
                            html += '</button>';
                            html += '</div>';
                            html += '</td>';
                            html += '</tr>';
                        });
                    }else{
                        html += '<tr><td colspan="3" class="text-center text-muted">Aucun contact enregistré</td></tr>';
                    }
                    $('#listeDesContacts').html(html);
                }
            });
        }

        // Chargement des comptes bancaires
        function loadBankAccounts(){
            $.ajax({
                url : "#",
                dataType: "JSON",
                type : 'GET',
                data:{'id_entreprise' : id},
                success: function(data){
                    var html = "";
                    if (data.length > 0){
                        $.each(data, function(index, item){
                            html += '<tr>';
                            html += '<td>'+item.bank_name+'</td>';
                            html += '<td>'+item.bank_iban+'</td>';
                            html += '<td>'+item.bank_currency+'</td>';
                            html += '<td class="text-end">';
                            html += '<div class="d-flex justify-content-end gap-2">';
                            html += '<button class="btn btn-soft-primary btn-sm edit-bank-account" data-id="'+item.id+'" title="Modifier">';
                            html += '<i class="ri-edit-line"></i>';
                            html += '</button>';
                            html += '<button class="btn btn-soft-danger btn-sm delete-bank-account" data-id="'+item.id+'" title="Supprimer">';
                            html += '<i class="ri-delete-bin-line"></i>';
                            html += '</button>';
                            html += '</div>';
                            html += '</td>';
                            html += '</tr>';
                        });
                    }else{
                        html += '<tr><td colspan="4" class="text-center text-muted">Aucun compte bancaire enregistré</td></tr>';
                    }
                    $('#bankAccountsList').html(html);
                }
            });
        }

       
        // Initialisation des données
        loadEntrepriseData();
        loadBankAccounts();
       
        // Gestionnaires d'événements
        $(document).on('click', '#validateEntrepriseBtn', function(){
            $('#validateEntrepriseModal').modal('show');
        });

        $(document).on('click', '#updateEntrepriseDetailsBtn', function(){
            $('#editEntrepriseModal').modal('show');
        });

        $(document).on('click', '#addContactBtn', function(){
            $('#addContactModal').modal('show');
        });

        $(document).on('click', '#addInteractionBtn', function(){
            $('#addInteractionModal').modal('show');
        });

        $(document).on('click', '#saveContactBtn', function(){
            // Logique d'enregistrement du contact
            $('#addContactModal').modal('hide');
            alertify.success('Contact enregistré avec succès');
        });

        $(document).on('click', '#saveInteractionBtn', function(){
            // Logique d'enregistrement de l'interaction
            $('#addInteractionModal').modal('hide');
            alertify.success('Interaction enregistrée avec succès');
        });

        $(document).on('click', '#validateUpdateEntrepriseDetailsBtn', function(){
            // Récupération des valeurs des champs
            var designation = $('#edit_designation').val();
            var adresse = $('#edit_adresse').val();
            var wilaya = $('#edit_wilaya').val();
            var pays = $('#edit_pays').val();
            var code_postal = $('#edit_code_postal').val();
            var email = $('#edit_email').val();
            var telephone = $('#edit_telephone').val();
            var site_web = $('#edit_site_web').val();
            var rc = $('#edit_rc').val();
            var art = $('#edit_art').val();
            var nif = $('#edit_nif').val();
            var nis = $('#edit_nis').val();
            var banque = $('#edit_banque').val();
            var iban = $('#edit_iban').val();
            var observations = $('#edit_observations').val();
            
            // Envoi des données via AJAX
            $.ajax({
                url : "{% url 'institut_app:ApiUpdateEntrepriseData' %}",
                dataType: "JSON",
                type : 'POST',
                data:{
                    'id_entreprise' : id,
                    'designation': designation,
                    'adresse': adresse,
                    'wilaya': wilaya,
                    'pays': pays,
                    'code_postal': code_postal,
                    'email': email,
                    'telephone': telephone,
                    'site_web': site_web,
                    'rc': rc,
                    'art': art,
                    'nif': nif,
                    'nis': nis,
                    'banque': banque,
                    'iban': iban,
                    'observations': observations,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function(data){
                    if (data.status === 'success'){
                        $('#editEntrepriseModal').modal('hide');
                        loadEntrepriseData();
                        alertify.success(data.message);
                    }else{
                        alertify.error(data.message);
                    }
                }
            });
        });

        // Gestion des comptes bancaires
        $(document).on('click', '#addBankAccountBtn', function(){
            $('#addBankAccountModal').modal('show');
        });

        $(document).on('click', '#saveBankAccountBtn', function(){
            // Récupération des valeurs des champs
            var bank_name = $('#bank_name').val();
            var bank_iban = $('#bank_iban').val();
            var bank_currency = $('#bank_currency').val();
            var bank_observations = $('#bank_observations').val();
            
            // Validation simple
            if (!bank_name || !bank_iban) {
                alertify.error('Veuillez remplir tous les champs obligatoires');
                return;
            }
            
            // Envoi des données via AJAX
            $.ajax({
                url : "#", // URL à définir pour l'API d'ajout de compte bancaire
                dataType: "JSON",
                type : 'POST',
                data:{
                    'id_entreprise' : id,
                    'bank_name': bank_name,
                    'bank_iban': bank_iban,
                    'bank_currency': bank_currency,
                    'bank_observations': bank_observations,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function(data){
                    if (data.status === 'success'){
                        $('#addBankAccountModal').modal('hide');
                        // Réinitialisation du formulaire
                        $('#bank_name').val('');
                        $('#bank_iban').val('');
                        $('#bank_currency').val('EUR');
                        $('#bank_observations').val('');
                        loadBankAccounts();
                        alertify.success(data.message);
                    }else{
                        alertify.error(data.message);
                    }
                }
            });
        });

        $(document).on('click', '.edit-bank-account', function(){
            var accountId = $(this).data('id');
            // Charger les données du compte bancaire et les afficher dans le modal d'édition
            // Pour l'instant, on affiche simplement le modal
            $('#edit_bank_account_id').val(accountId);
            $('#editBankAccountModal').modal('show');
            // TODO: Charger les données réelles du compte bancaire via AJAX
        });

        $(document).on('click', '.delete-bank-account', function(){
            var accountId = $(this).data('id');
            alertify.confirm('Suppression', 'Êtes-vous sûr de vouloir supprimer ce compte bancaire ?', 
                function(){
                    // Envoi de la requête de suppression via AJAX
                    $.ajax({
                        url : "#", // URL à définir pour l'API de suppression de compte bancaire
                        dataType: "JSON",
                        type : 'POST',
                        data:{
                            'account_id': accountId,
                            'csrfmiddlewaretoken': '{{ csrf_token }}'
                        },
                        success: function(data){
                            if (data.status === 'success'){
                                loadBankAccounts();
                                alertify.success(data.message);
                            }else{
                                alertify.error(data.message);
                            }
                        }
                    });
                },
                function(){
                    // Annulation
                }
            );
        });

        $(document).on('click', '#updateBankAccountBtn', function(){
            // Récupération des valeurs des champs
            var account_id = $('#edit_bank_account_id').val();
            var bank_name = $('#edit_bank_name').val();
            var bank_iban = $('#edit_bank_iban').val();
            var bank_currency = $('#edit_bank_currency').val();
            var bank_observations = $('#edit_bank_observations').val();
            
            // Validation simple
            if (!bank_name || !bank_iban) {
                alertify.error('Veuillez remplir tous les champs obligatoires');
                return;
            }
            
            // Envoi des données via AJAX
            $.ajax({
                url : "#", // URL à définir pour l'API de mise à jour de compte bancaire
                dataType: "JSON",
                type : 'POST',
                data:{
                    'account_id': account_id,
                    'bank_name': bank_name,
                    'bank_iban': bank_iban,
                    'bank_currency': bank_currency,
                    'bank_observations': bank_observations,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function(data){
                    if (data.status === 'success'){
                        $('#editBankAccountModal').modal('hide');
                        loadBankAccounts();
                        alertify.success(data.message);
                    }else{
                        alertify.error(data.message);
                    }
                }
            });
        });
    });
</script>

{% endblock content %}