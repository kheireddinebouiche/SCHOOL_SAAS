<form method="post" id="paieForm" action="{% url 't_ressource_humaine:generer_paie' contrat_id=contrat.id %}">
    {% load paie_tags %}
    {% csrf_token %}
    <div class="modal-body p-4">
        <div class="alert alert-soft-info border-0 d-flex align-items-center mb-4" role="alert">
            <i class="ri-information-line fs-24 me-3"></i>
            <div>
                Calcul de la paie pour <span class="fw-bold">{{ contrat.formateur }}</span><br>
                <small class="text-muted">Assurez-vous que les informations de présence sont correctes.</small>
            </div>
        </div>

        <div class="row g-4">
            {% for field in form %}
            <div class="{% if 'primes_fixe' in field.name %}col-12{% else %}col-md-6{% endif %}">
                {% if 'primes_fixe' in field.name %}
                <div class="form-check form-switch form-switch-success mt-2">
                    {{ field }}
                    <label class="form-check-label fw-medium ms-1" for="{{ field.id_for_label }}">
                        {{ field.label }}
                    </label>
                </div>
                {% else %}
                <label class="form-label fw-medium mb-1" for="{{ field.id_for_label }}">
                    {{ field.label }}
                </label>
                <div class="input-group">
                    {% if 'mois' in field.name %}
                    <span class="input-group-text bg-light border-light text-muted"><i class="ri-calendar-todo-line"></i></span>
                    {% elif 'annee' in field.name %}
                    <span class="input-group-text bg-light border-light text-muted"><i class="ri-time-line"></i></span>
                    {% elif 'jours' in field.name or 'heures' in field.name %}
                    <span class="input-group-text bg-light border-light text-muted"><i class="ri-edit-2-line"></i></span>
                    {% endif %}
                    {{ field }}
                </div>
                {% endif %}

                {% if field.errors %}
                <div class="invalid-feedback d-block mt-1">
                    {{ field.errors|first }}
                </div>
                {% endif %}
            </div>
            {% endfor %}
            
            {% if rubriques %}
            <div class="col-12">
                <hr class="my-3 border-dashed">
                <h6 class="fs-13 text-muted text-uppercase fw-semibold mb-3">Rubriques Variables</h6>
            </div>
            {% for rubrique in rubriques %}
            <div class="col-md-6">
                <label class="form-label fw-medium mb-1">{{ rubrique.libelle }}</label>
                <div class="input-group">
                    <span class="input-group-text bg-{% if rubrique.type_rubrique == 'GAIN' %}success{% else %}danger{% endif %}-subtle text-{% if rubrique.type_rubrique == 'GAIN' %}success{% else %}danger{% endif %} border-light">
                        {% if rubrique.type_rubrique == 'GAIN' %}+{% else %}-{% endif %}
                    </span>
                    <input type="number" step="0.01" class="form-control" name="rubrique_{{ rubrique.id }}" 
                           value="{% if existing_lignes %}{{ existing_lignes|get_item:rubrique.id|default:'0' }}{% else %}{{ contract_defaults|get_item:rubrique.id|default:'0' }}{% endif %}">
                    <span class="input-group-text bg-light border-light text-muted">
                        {% if rubrique.mode_calcul == 'PERCENT' %}%
                        {% elif rubrique.mode_calcul == 'HOURS' %}h
                        {% else %}DA{% endif %}
                    </span>
                </div>
            </div>
            {% endfor %}
            {% endif %}
        </div>
    </div>
    <div class="modal-footer bg-light p-3">
        <button type="button" class="btn btn-ghost-danger btn-sm" data-bs-dismiss="modal">
            <i class="ri-close-line align-bottom me-1"></i> Annuler
        </button>
        <button type="submit" class="btn btn-success btn-sm px-4">
            <i class="ri-calculator-line align-bottom me-1"></i> Calculer & Générer
        </button>
    </div>
</form>
