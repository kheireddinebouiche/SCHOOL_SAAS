{% extends 'public_folder/base.html' %}
{% load static %}
{% block title %}Engagement Réseaux Sociaux | Tableau de bord{% endblock title %}
{% block content %}
<div class="main-content">
    <div class="page-content">
        <div class="container-fluid">
            <!-- Page title -->
            <div class="row">
                <div class="col-12">
                    <div class="page-title-box d-flex align-items-center justify-content-between">
                        <h4 class="mb-0">Engagement Réseaux Sociaux</h4>
                        <div class="page-title-right">
                            <ol class="breadcrumb m-0">
                                <li class="breadcrumb-item"><a href="#">Marketing</a></li>
                                <li class="breadcrumb-item active">Engagement Réseaux Sociaux</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Date Filters -->
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-md-4">
                                    <label class="form-label">Date de début</label>
                                    <input type="date" class="form-control" value="2024-03-01">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Date de fin</label>
                                    <input type="date" class="form-control" value="2024-03-12">
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">&nbsp;</label>
                                    <div>
                                        <button class="btn btn-primary w-100">Filtrer</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- KPI Cards -->
            <div class="row">
                <div class="col-xl-3 col-md-6">
                    <div class="card card-animate">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="flex-grow-1 overflow-hidden">
                                    <p class="text-uppercase fw-medium text-muted text-truncate mb-0">Total Interactions</p>
                                </div>
                                <div class="flex-shrink-0">
                                    <div class="avatar-sm">
                                        <span class="avatar-title bg-soft-primary text-primary rounded-circle fs-20">
                                            <i class="mdi mdi-heart-multiple"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex align-items-end justify-content-between mt-4">
                                <div>
                                    <h4 class="fs-22 fw-semibold ff-secondary mb-1"><span class="counter-value" data-target="24580">0</span></h4>
                                    <p class="mb-0 text-muted"><span class="text-success fw-medium fs-12 me-1"><i class="ri-arrow-right-up-line me-1 align-middle"></i>15.3%</span>sur la période</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-xl-3 col-md-6">
                    <div class="card card-animate">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="flex-grow-1 overflow-hidden">
                                    <p class="text-uppercase fw-medium text-muted text-truncate mb-0">Total Partages</p>
                                </div>
                                <div class="flex-shrink-0">
                                    <div class="avatar-sm">
                                        <span class="avatar-title bg-soft-success text-success rounded-circle fs-20">
                                            <i class="mdi mdi-share-variant"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex align-items-end justify-content-between mt-4">
                                <div>
                                    <h4 class="fs-22 fw-semibold ff-secondary mb-1"><span class="counter-value" data-target="8760">0</span></h4>
                                    <p class="mb-0 text-muted"><span class="text-success fw-medium fs-12 me-1"><i class="ri-arrow-right-up-line me-1 align-middle"></i>12.7%</span>sur la période</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-xl-3 col-md-6">
                    <div class="card card-animate">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="flex-grow-1 overflow-hidden">
                                    <p class="text-uppercase fw-medium text-muted text-truncate mb-0">Top Canal</p>
                                </div>
                                <div class="flex-shrink-0">
                                    <div class="avatar-sm">
                                        <span class="avatar-title bg-soft-warning text-warning rounded-circle fs-20">
                                            <i class="mdi mdi-trending-up"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex align-items-end justify-content-between mt-4">
                                <div>
                                    <h4 class="fs-22 fw-semibold ff-secondary mb-1">TikTok</h4>
                                    <p class="mb-0 text-muted"><span class="text-success fw-medium fs-12 me-1"><i class="ri-arrow-right-up-line me-1 align-middle"></i>42.3%</span>des interactions</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-xl-3 col-md-6">
                    <div class="card card-animate">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="flex-grow-1 overflow-hidden">
                                    <p class="text-uppercase fw-medium text-muted text-truncate mb-0">Portée Totale</p>
                                </div>
                                <div class="flex-shrink-0">
                                    <div class="avatar-sm">
                                        <span class="avatar-title bg-soft-info text-info rounded-circle fs-20">
                                            <i class="mdi mdi-account-group"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex align-items-end justify-content-between mt-4">
                                <div>
                                    <h4 class="fs-22 fw-semibold ff-secondary mb-1"><span class="counter-value" data-target="125400">0</span></h4>
                                    <p class="mb-0 text-muted"><span class="text-success fw-medium fs-12 me-1"><i class="ri-arrow-right-up-line me-1 align-middle"></i>8.9%</span>sur la période</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Heatmap Section -->
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header border-0">
                            <div class="d-flex align-items-center">
                                <h5 class="card-title mb-0 flex-grow-1">Heatmap de Performance - Canaux vs Instituts</h5>
                                <div class="flex-shrink-0">
                                    <select class="form-select form-select-sm w-auto">
                                        <option>Leads Générés</option>
                                        <option>Interactions</option>
                                        <option>Portée</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="card-body pt-0">
                            <div class="table-responsive">
                                <table class="table table-centered table-heatmap mb-0">
                                    <thead>
                                        <tr>
                                            <th>Institut</th>
                                            <th>Facebook</th>
                                            <th>Instagram</th>
                                            <th>Twitter</th>
                                            <th>LinkedIn</th>
                                            <th>TikTok</th>
                                            <th>Moyenne</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="bg-light">Institut Béjaia</td>
                                            <td class="bg-success bg-opacity-75 text-white">24</td>
                                            <td class="bg-success bg-opacity-50">18</td>
                                            <td class="bg-warning bg-opacity-25">9</td>
                                            <td class="bg-success bg-opacity-25">15</td>
                                            <td class="bg-primary bg-opacity-25">11</td>
                                            <td class="bg-info bg-opacity-25">15.4</td>
                                        </tr>
                                        <tr>
                                            <td class="bg-light">Ecole Management Alger</td>
                                            <td class="bg-success bg-opacity-75 text-white">32</td>
                                            <td class="bg-success bg-opacity-75 text-white">28</td>
                                            <td class="bg-warning bg-opacity-25">12</td>
                                            <td class="bg-success bg-opacity-50">22</td>
                                            <td class="bg-primary bg-opacity-25">15</td>
                                            <td class="bg-info bg-opacity-50">21.8</td>
                                        </tr>
                                        <tr>
                                            <td class="bg-light">Centre Médical Oran</td>
                                            <td class="bg-success bg-opacity-50">18</td>
                                            <td class="bg-success bg-opacity-25">15</td>
                                            <td class="bg-danger bg-opacity-25">7</td>
                                            <td class="bg-warning bg-opacity-25">12</td>
                                            <td class="bg-primary bg-opacity-25">9</td>
                                            <td class="bg-info bg-opacity-25">12.2</td>
                                        </tr>
                                        <tr>
                                            <td class="bg-light">Académie des Arts</td>
                                            <td class="bg-success bg-opacity-50">28</td>
                                            <td class="bg-success bg-opacity-75 text-white">35</td>
                                            <td class="bg-success bg-opacity-25">18</td>
                                            <td class="bg-warning bg-opacity-25">8</td>
                                            <td class="bg-success bg-opacity-50">22</td>
                                            <td class="bg-info bg-opacity-50">22.2</td>
                                        </tr>
                                        <tr>
                                            <td class="bg-light">Institut de Langues</td>
                                            <td class="bg-warning bg-opacity-25">15</td>
                                            <td class="bg-success bg-opacity-50">22</td>
                                            <td class="bg-warning bg-opacity-25">11</td>
                                            <td class="bg-warning bg-opacity-25">10</td>
                                            <td class="bg-primary bg-opacity-25">8</td>
                                            <td class="bg-info bg-opacity-25">13.2</td>
                                        </tr>
                                        <tr>
                                            <td class="bg-light">Institut Blida</td>
                                            <td class="bg-success bg-opacity-50">20</td>
                                            <td class="bg-warning bg-opacity-25">16</td>
                                            <td class="bg-danger bg-opacity-25">8</td>
                                            <td class="bg-warning bg-opacity-25">14</td>
                                            <td class="bg-primary bg-opacity-25">12</td>
                                            <td class="bg-info bg-opacity-25">14.0</td>
                                        </tr>
                                        <tr>
                                            <td class="bg-light">Ecole Commerce Setif</td>
                                            <td class="bg-warning bg-opacity-25">16</td>
                                            <td class="bg-warning bg-opacity-25">19</td>
                                            <td class="bg-danger bg-opacity-25">6</td>
                                            <td class="bg-warning bg-opacity-25">11</td>
                                            <td class="bg-primary bg-opacity-25">7</td>
                                            <td class="bg-info bg-opacity-25">11.8</td>
                                        </tr>
                                        <tr>
                                            <td class="bg-light">Centre Paramédical</td>
                                            <td class="bg-warning bg-opacity-25">12</td>
                                            <td class="bg-warning bg-opacity-25">14</td>
                                            <td class="bg-danger bg-opacity-25">5</td>
                                            <td class="bg-warning bg-opacity-25">9</td>
                                            <td class="bg-primary bg-opacity-25">6</td>
                                            <td class="bg-info bg-opacity-25">9.2</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="mt-3">
                                <div class="d-flex align-items-center">
                                    <div class="me-3">
                                        <span class="badge bg-success">Élevé</span>
                                    </div>
                                    <div class="me-3">
                                        <span class="badge bg-warning">Moyen</span>
                                    </div>
                                    <div>
                                        <span class="badge bg-danger">Faible</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Comparison Table -->
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header border-0">
                            <div class="d-flex align-items-center">
                                <h5 class="card-title mb-0 flex-grow-1">Comparatif des Canaux de Communication par Institut</h5>
                                <div class="flex-shrink-0">
                                    <div class="d-flex flex-wrap gap-2">
                                        <button type="button" class="btn btn-soft-info btn-icon"><i class="ri-filter-3-line"></i></button>
                                        <button type="button" class="btn btn-soft-info btn-icon"><i class="ri-refresh-line"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-body pt-0">
                            <div class="table-responsive table-card">
                                <table class="table align-middle table-nowrap mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Institut</th>
                                            <th>Ville</th>
                                            <th>Facebook</th>
                                            <th>Instagram</th>
                                            <th>Twitter</th>
                                            <th>LinkedIn</th>
                                            <th>TikTok</th>
                                            <th>Total</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <div class="flex-shrink-0">
                                                        <img src="{% static 'design/assets/images/companies/img-1.png' %}" alt="" class="avatar-xs rounded-circle">
                                                    </div>
                                                    <div class="flex-grow-1 ms-2 fw-medium">Institut Béjaia</div>
                                                </div>
                                            </td>
                                            <td>Béjaia</td>
                                            <td>24 leads</td>
                                            <td>18 leads</td>
                                            <td>9 leads</td>
                                            <td>15 leads</td>
                                            <td class="fw-bold">11 leads</td>
                                            <td class="fw-bold">77</td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <div class="flex-shrink-0">
                                                        <img src="{% static 'design/assets/images/companies/img-2.png' %}" alt="" class="avatar-xs rounded-circle">
                                                    </div>
                                                    <div class="flex-grow-1 ms-2 fw-medium">Ecole Management Alger</div>
                                                </div>
                                            </td>
                                            <td>Alger</td>
                                            <td>32 leads</td>
                                            <td>28 leads</td>
                                            <td>12 leads</td>
                                            <td>22 leads</td>
                                            <td>15 leads</td>
                                            <td class="fw-bold">109</td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <div class="flex-shrink-0">
                                                        <img src="{% static 'design/assets/images/companies/img-3.png' %}" alt="" class="avatar-xs rounded-circle">
                                                    </div>
                                                    <div class="flex-grow-1 ms-2 fw-medium">Centre Médical Oran</div>
                                                </div>
                                            </td>
                                            <td>Oran</td>
                                            <td>18 leads</td>
                                            <td>15 leads</td>
                                            <td>7 leads</td>
                                            <td>12 leads</td>
                                            <td>9 leads</td>
                                            <td class="fw-bold">61</td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <div class="flex-shrink-0">
                                                        <img src="{% static 'design/assets/images/companies/img-4.png' %}" alt="" class="avatar-xs rounded-circle">
                                                    </div>
                                                    <div class="flex-grow-1 ms-2 fw-medium">Académie des Arts</div>
                                                </div>
                                            </td>
                                            <td>Constantine</td>
                                            <td>28 leads</td>
                                            <td>35 leads</td>
                                            <td>18 leads</td>
                                            <td>8 leads</td>
                                            <td>22 leads</td>
                                            <td class="fw-bold">111</td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <div class="flex-shrink-0">
                                                        <img src="{% static 'design/assets/images/companies/img-5.png' %}" alt="" class="avatar-xs rounded-circle">
                                                    </div>
                                                    <div class="flex-grow-1 ms-2 fw-medium">Institut de Langues</div>
                                                </div>
                                            </td>
                                            <td>Annaba</td>
                                            <td>15 leads</td>
                                            <td>22 leads</td>
                                            <td>11 leads</td>
                                            <td>10 leads</td>
                                            <td>8 leads</td>
                                            <td class="fw-bold">66</td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <div class="flex-shrink-0">
                                                        <img src="{% static 'design/assets/images/companies/img-1.png' %}" alt="" class="avatar-xs rounded-circle">
                                                    </div>
                                                    <div class="flex-grow-1 ms-2 fw-medium">Institut Blida</div>
                                                </div>
                                            </td>
                                            <td>Blida</td>
                                            <td>20 leads</td>
                                            <td>16 leads</td>
                                            <td>8 leads</td>
                                            <td>14 leads</td>
                                            <td>12 leads</td>
                                            <td class="fw-bold">70</td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <div class="flex-shrink-0">
                                                        <img src="{% static 'design/assets/images/companies/img-2.png' %}" alt="" class="avatar-xs rounded-circle">
                                                    </div>
                                                    <div class="flex-grow-1 ms-2 fw-medium">Ecole Commerce Setif</div>
                                                </div>
                                            </td>
                                            <td>Setif</td>
                                            <td>16 leads</td>
                                            <td>19 leads</td>
                                            <td>6 leads</td>
                                            <td>11 leads</td>
                                            <td>7 leads</td>
                                            <td class="fw-bold">59</td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <div class="flex-shrink-0">
                                                        <img src="{% static 'design/assets/images/companies/img-3.png' %}" alt="" class="avatar-xs rounded-circle">
                                                    </div>
                                                    <div class="flex-grow-1 ms-2 fw-medium">Centre Paramédical</div>
                                                </div>
                                            </td>
                                            <td>Batna</td>
                                            <td>12 leads</td>
                                            <td>14 leads</td>
                                            <td>5 leads</td>
                                            <td>9 leads</td>
                                            <td>6 leads</td>
                                            <td class="fw-bold">46</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="d-flex justify-content-end mt-3">
                                <div class="pagination-wrap hstack gap-2">
                                    <a class="page-item pagination-prev disabled" href="#">
                                        Précédent
                                    </a>
                                    <ul class="pagination listjs-pagination mb-0"></ul>
                                    <a class="page-item pagination-next" href="#">
                                        Suivant
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Charts -->
            <div class="row">
                <div class="col-xl-8">
                    <div class="card">
                        <div class="card-header border-0">
                            <h5 class="card-title mb-0">Performance des Canaux de Communication</h5>
                        </div>
                        <div class="card-body pt-0">
                            <div id="channel_performance_chart" data-colors='["--vz-primary", "--vz-success", "--vz-warning", "--vz-danger", "--vz-info"]' class="apex-charts" dir="ltr"></div>
                        </div>
                    </div>
                </div>
                
                <div class="col-xl-4">
                    <div class="card">
                        <div class="card-header border-0">
                            <h5 class="card-title mb-0">Répartition par Canal</h5>
                        </div>
                        <div class="card-body pt-0">
                            <div id="channel_distribution_chart" data-colors='["--vz-primary", "--vz-success", "--vz-warning", "--vz-danger", "--vz-info"]' class="apex-charts" dir="ltr"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.table-heatmap td, .table-heatmap th {
    text-align: center;
    vertical-align: middle;
    padding: 12px 8px;
}
.table-heatmap td:first-child, .table-heatmap th:first-child {
    text-align: left;
}
.bg-success.bg-opacity-75 {
    background-color: rgba(6, 214, 160, 0.75) !important;
}
.bg-success.bg-opacity-50 {
    background-color: rgba(6, 214, 160, 0.5) !important;
}
.bg-success.bg-opacity-25 {
    background-color: rgba(6, 214, 160, 0.25) !important;
}
.bg-warning.bg-opacity-25 {
    background-color: rgba(255, 209, 102, 0.25) !important;
}
.bg-danger.bg-opacity-25 {
    background-color: rgba(239, 71, 111, 0.25) !important;
}
.bg-primary.bg-opacity-25 {
    background-color: rgba(10, 132, 255, 0.25) !important;
}
.bg-info.bg-opacity-25 {
    background-color: rgba(102, 187, 255, 0.25) !important;
}
.bg-info.bg-opacity-50 {
    background-color: rgba(102, 187, 255, 0.5) !important;
}
</style>

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script>
    // Channel Performance Chart
    var channelPerformanceOptions = {
        series: [{
            name: 'Leads',
            data: [44, 55, 57, 56, 61, 58, 63, 60, 66]
        }, {
            name: 'Interactions',
            data: [76, 85, 101, 98, 87, 105, 91, 114, 94]
        }, {
            name: 'Reach',
            data: [35, 41, 36, 26, 45, 48, 52, 53, 41]
        }],
        chart: {
            type: 'bar',
            height: 350,
            stacked: true,
            toolbar: {
                show: true
            },
            zoom: {
                enabled: true
            }
        },
        responsive: [{
            breakpoint: 480,
            options: {
                legend: {
                    position: 'bottom',
                    offsetX: -10,
                    offsetY: 0
                }
            }
        }],
        plotOptions: {
            bar: {
                horizontal: false,
                borderRadius: 10,
                dataLabels: {
                    total: {
                        enabled: true,
                        style: {
                            fontSize: '13px',
                            fontWeight: 900
                        }
                    }
                }
            },
        },
        xaxis: {
            categories: ['Facebook', 'Instagram', 'Twitter', 'LinkedIn', 'TikTok', 'YouTube', 'Snapchat', 'Pinterest', 'Reddit'],
        },
        legend: {
            position: 'right',
            offsetY: 40
        },
        fill: {
            opacity: 1
        }
    };

    var channelPerformanceChart = new ApexCharts(document.querySelector("#channel_performance_chart"), channelPerformanceOptions);
    channelPerformanceChart.render();

    // Channel Distribution Chart
    var channelDistributionOptions = {
        series: [44, 55, 13, 43, 22],
        chart: {
            width: 380,
            type: 'pie',
        },
        labels: ['Facebook', 'Instagram', 'Twitter', 'LinkedIn', 'TikTok'],
        responsive: [{
            breakpoint: 480,
            options: {
                chart: {
                    width: 200
                },
                legend: {
                    position: 'bottom'
                }
            }
        }],
        legend: {
            position: 'bottom'
        }
    };

    var channelDistributionChart = new ApexCharts(document.querySelector("#channel_distribution_chart"), channelDistributionOptions);
    channelDistributionChart.render();

    // Counter animation
    document.addEventListener('DOMContentLoaded', function() {
        var counterElements = document.querySelectorAll('.counter-value');
        counterElements.forEach(function(element) {
            var target = parseInt(element.getAttribute('data-target'));
            var count = 0;
            var increment = target / 100;
            
            var timer = setInterval(function() {
                count += increment;
                if (count >= target) {
                    clearInterval(timer);
                    count = target;
                }
                element.textContent = Math.floor(count);
            }, 10);
        });
    });

    // Date filter functionality
    document.querySelector('.btn-primary').addEventListener('click', function() {
        var startDate = document.querySelector('input[type="date"]:nth-of-type(1)').value;
        var endDate = document.querySelector('input[type="date"]:nth-of-type(2)').value;
        console.log('Filtering from ' + startDate + ' to ' + endDate);
        // In a real application, this would trigger an AJAX request to update the data
        alert('Données filtrées du ' + startDate + ' au ' + endDate);
    });

    // Table sorting
    document.querySelectorAll('th').forEach(function(th) {
        th.addEventListener('click', function() {
            var table = th.closest('table');
            var tbody = table.querySelector('tbody');
            var rows = Array.from(tbody.querySelectorAll('tr'));
            
            var index = Array.from(th.parentNode.children).indexOf(th);
            var ascending = th.classList.contains('asc');
            
            rows.sort(function(a, b) {
                var aText = a.children[index].textContent.trim();
                var bText = b.children[index].textContent.trim();
                
                // Try to sort as numbers if possible
                var aNum = parseFloat(aText);
                var bNum = parseFloat(bText);
                
                if (!isNaN(aNum) && !isNaN(bNum)) {
                    return ascending ? aNum - bNum : bNum - aNum;
                }
                
                // Sort as strings
                return ascending ? 
                    aText.localeCompare(bText) : 
                    bText.localeCompare(aText);
            });
            
            // Toggle sort direction
            th.classList.toggle('asc');
            
            // Append sorted rows
            rows.forEach(function(row) {
                tbody.appendChild(row);
            });
        });
    });

    // Heatmap interactivity
    var heatmapCells = document.querySelectorAll('.table-heatmap td:not(:first-child)');
    heatmapCells.forEach(function(cell) {
        cell.addEventListener('mouseover', function() {
            this.style.opacity = '0.8';
            this.style.cursor = 'pointer';
        });
        
        cell.addEventListener('mouseout', function() {
            this.style.opacity = '1';
        });
        
        cell.addEventListener('click', function() {
            var row = this.parentNode;
            var institute = row.querySelector('td:first-child').textContent;
            var channel = this.parentNode.parentNode.querySelector('thead tr th:nth-child(' + (this.cellIndex + 1) + ')').textContent;
            var value = this.textContent;
            
            alert('Performance de ' + channel + ' pour ' + institute + ': ' + value);
        });
    });

    // Heatmap metric selector
    var heatmapSelector = document.querySelector('.card-header select');
    if (heatmapSelector) {
        heatmapSelector.addEventListener('change', function() {
            var selectedMetric = this.value;
            alert('Changement de métrique vers: ' + selectedMetric);
            // In a real application, this would update the heatmap data
        });
    }

    // Enhanced table sorting with visual indicator
    document.querySelectorAll('th').forEach(function(th) {
        th.style.cursor = 'pointer';
        th.addEventListener('click', function() {
            var table = th.closest('table');
            var tbody = table.querySelector('tbody');
            var rows = Array.from(tbody.querySelectorAll('tr'));
            
            // Remove existing sort indicators
            table.querySelectorAll('th').forEach(function(header) {
                header.classList.remove('asc', 'desc');
            });
            
            var index = Array.from(th.parentNode.children).indexOf(th);
            var ascending = !th.classList.contains('asc');
            
            rows.sort(function(a, b) {
                var aText = a.children[index].textContent.trim();
                var bText = b.children[index].textContent.trim();
                
                // Try to sort as numbers if possible
                var aNum = parseFloat(aText);
                var bNum = parseFloat(bText);
                
                if (!isNaN(aNum) && !isNaN(bNum)) {
                    return ascending ? aNum - bNum : bNum - aNum;
                }
                
                // Sort as strings
                return ascending ? 
                    aText.localeCompare(bText) : 
                    bText.localeCompare(aText);
            });
            
            // Add sort indicator
            th.classList.add(ascending ? 'asc' : 'desc');
            
            // Append sorted rows
            rows.forEach(function(row) {
                tbody.appendChild(row);
            });
        });
    });

    // Pagination functionality
    document.addEventListener('DOMContentLoaded', function() {
        var rowsPerPage = 5;
        var currentPage = 1;
        var table = document.querySelector('.table-card table');
        var rows = Array.from(table.querySelectorAll('tbody tr'));
        var totalPages = Math.ceil(rows.length / rowsPerPage);
        
        function showPage(page) {
            var startIndex = (page - 1) * rowsPerPage;
            var endIndex = startIndex + rowsPerPage;
            
            rows.forEach(function(row, index) {
                row.style.display = (index >= startIndex && index < endIndex) ? '' : 'none';
            });
            
            // Update pagination controls
            document.querySelector('.pagination-prev').className = 
                'page-item pagination-prev ' + (page === 1 ? 'disabled' : '');
            document.querySelector('.pagination-next').className = 
                'page-item pagination-next ' + (page === totalPages ? 'disabled' : '');
        }
        
        // Initialize pagination
        showPage(currentPage);
        
        // Previous button
        document.querySelector('.pagination-prev').addEventListener('click', function(e) {
            e.preventDefault();
            if (currentPage > 1) {
                currentPage--;
                showPage(currentPage);
            }
        });
        
        // Next button
        document.querySelector('.pagination-next').addEventListener('click', function(e) {
            e.preventDefault();
            if (currentPage < totalPages) {
                currentPage++;
                showPage(currentPage);
            }
        });
    });
</script>
{% endblock scripts %}
{% endblock content %}